<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <!-- AUTH GUARD: Protects this page -->
    <script src="../assets/js/auth-guard.js"></script>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Peer Dashboard | Soulamore</title>
    <link
        href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;600;700&family=Plus+Jakarta+Sans:wght@300;400;500;600&display=swap"
        rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="../assets/css/global.css">
    <link rel="stylesheet" href="../assets/css/dashboard-sidebar.css">
    <style>
        /* --- DASHBOARD V3 DARK (PEER) --- */
        :root {
            /* Palette from Screenshots */
            --bg-deep: #0f172a;
            /* Main Background */
            --bg-card: #1e293b;
            /* Card Background */
            --bg-sidebar: #0f172a;
            /* Sidebar matches body */
            --teal-accent: #F49F75;
            /* Orange for Peers to distinguish */
            /* PEACH GLOW */
            --accent-primary: #F49F75;
            /* CRITICAL: Override global accent for Sidebar */
            --teal-dim: rgba(244, 159, 117, 0.1);
            --text-main: #f8fafc;
            --text-muted: #94a3b8;
            --border-subtle: rgba(255, 255, 255, 0.08);
            --font-head: 'Outfit', sans-serif;
            --font-body: 'Plus Jakarta Sans', sans-serif;
        }

        body {
            background-color: var(--bg-deep);
            color: var(--text-main);
            font-family: var(--font-body);
            overflow-x: hidden;
        }

        /* --- LAYOUT --- */
        .dashboard-layout {
            display: flex;
            min-height: 100vh;
        }

        /* --- SIDEBAR --- */
        .sidebar {
            width: 260px;
            background: var(--bg-sidebar);
            border-right: 1px solid var(--border-subtle);
            padding: 30px 20px;
            display: flex;
            flex-direction: column;
            position: fixed;
            height: 100vh;
            z-index: 100;
            transition: transform 0.3s ease;
        }

        .sidebar-header {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-bottom: 40px;
            padding-left: 10px;
        }

        .user-avatar-lg {
            width: 48px;
            height: 48px;
            background: var(--bg-card);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--text-main);
            font-size: 1.2rem;
            border: 1px solid var(--border-subtle);
        }

        .user-info-text .name {
            font-family: var(--font-head);
            font-weight: 700;
            font-size: 1rem;
            line-height: 1.2;
        }

        .user-info-text .role {
            font-size: 0.75rem;
            color: var(--text-muted);
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .sidebar-nav {
            display: flex;
            flex-direction: column;
            gap: 5px;
            flex: 1;
        }

        .side-link {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 12px 15px;
            color: var(--text-muted);
            text-decoration: none;
            border-radius: 12px;
            transition: 0.2s;
            font-weight: 500;
            font-size: 0.95rem;
        }

        .side-link:hover {
            background: rgba(255, 255, 255, 0.03);
            color: var(--text-main);
        }

        .side-link.active {
            background: var(--teal-accent);
            color: #0f172a;
            font-weight: 600;
            box-shadow: 0 4px 12px var(--teal-dim);
        }

        .side-link i {
            width: 20px;
            text-align: center;
        }

        .sidebar-footer {
            margin-top: auto;
            border-top: 1px solid var(--border-subtle);
            padding-top: 20px;
        }

        .logout-btn {
            width: 100%;
            background: transparent;
            border: 1px solid var(--border-subtle);
            color: #ef4444;
            padding: 10px;
            border-radius: 10px;
            cursor: pointer;
            transition: 0.2s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            font-weight: 600;
        }

        .logout-btn:hover {
            background: rgba(239, 68, 68, 0.2);
        }

        /* --- MAIN CONTENT --- */
        /* --- MAIN CONTENT --- */
        .main-content {
            flex: 1;
            margin-left: 260px;
            padding: 40px;
            /* Removed max-width for centering */
            width: auto;
            overflow-y: auto;
            /* ENABLE SCROLLING */
        }

        .view-section {
            max-width: 1200px;
            margin: 0 auto;
            width: 100%;
        }

        /* --- CARDS & GRID --- */
        .dashboard-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .dash-card {
            background: var(--bg-card);
            border: 1px solid var(--border-subtle);
            border-radius: 24px;
            padding: 30px;
            transition: transform 0.2s, box-shadow 0.2s;
            position: relative;
            overflow: hidden;
        }

        .dash-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
        }

        /* --- TYPOGRAPHY --- */
        h1,
        h2,
        h3,
        h4 {
            font-family: var(--font-head);
            color: var(--text-main);
        }

        p {
            line-height: 1.6;
            color: var(--text-muted);
        }

        /* --- BUTTONS --- */
        .btn-dash-primary {
            background: var(--teal-accent);
            color: #0f172a;
            padding: 12px 24px;
            border-radius: 50px;
            text-decoration: none;
            font-weight: 700;
            display: inline-block;
            box-shadow: 0 0 15px var(--teal-dim);
            transition: 0.2s;
            border: none;
            cursor: pointer;
        }

        .btn-dash-primary:hover {
            transform: scale(1.05);
            box-shadow: 0 0 25px var(--teal-dim);
        }

        .btn-action-sm {
            background: transparent;
            border: none;
            color: var(--text-muted);
            cursor: pointer;
            font-size: 0.9rem;
            padding: 5px;
            border-radius: 4px;
            transition: 0.2s;
        }

        .btn-action-sm:hover {
            color: var(--text-main);
            background: rgba(255, 255, 255, 0.05);
        }

        /* MOBILE TOGGLE */
        .mobile-toggle {
            position: fixed;
            top: 20px;
            left: 20px;
            z-index: 200;
            background: var(--bg-card);
            border: 1px solid var(--border-subtle);
            color: var(--text-main);
            padding: 10px;
            border-radius: 8px;
            cursor: pointer;
            display: none;
        }

        @media (max-width: 1024px) {
            .mobile-toggle {
                display: block;
            }

            .sidebar {
                transform: translateX(-100%);
            }

            .sidebar.open {
                transform: translateX(0);
            }

            .main-content {
                margin-left: 0;
                padding: 20px;
            }
        }
    </style>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="icon" href="../assets/images/favicon_symbol.png" type="image/x-icon">
</head>

<body>

    <!-- TOOL MODAL CONTAINER -->
    <div id="toolModal" class="tool-modal-overlay">
        <div class="tool-modal-content">
            <div class="tool-modal-header">
                <div class="tool-modal-title" id="modalTitle">Tool</div>
                <button class="tool-close-btn" onclick="closeTool()"><i class="fas fa-times"></i></button>
            </div>
            <iframe id="toolFrame" class="tool-frame" src=""></iframe>
        </div>
    </div>

    <!-- MOBILE TOGGLE -->
    <button class="mobile-toggle" onclick="toggleSidebar()"><i class="fas fa-bars"></i></button>

    <div class="dashboard-layout">

        <!-- SIDEBAR -->
        <nav class="sidebar" id="sidebar">
            <div class="sidebar-header">
                <div class="user-avatar-lg" style="border-color:var(--teal-accent);">
                    <i class="fas fa-hands-helping" style="color:var(--teal-accent);"></i>
                </div>
                <div class="user-info-text">
                    <div class="name" id="sidebar-name">Peer Portal</div>
                    <div class="role" id="sidebar-role">Verified Peer</div>
                </div>
            </div>

            <div class="sidebar-nav">
                <a href="#" class="side-link active" onclick="switchView('overview', this)"><i class="fas fa-home"></i>
                    <span>Overview</span></a>
                <a href="#" class="side-link" onclick="switchView('profile', this)"><i class="fas fa-user-circle"></i>
                    <span>My Profile</span></a>
                <a href="#" class="side-link" onclick="switchView('sessions', this)"><i class="fas fa-video"></i>
                    <span>Sessions</span></a>
                <a href="#" class="side-link" onclick="switchView('journals', this)"><i class="fas fa-book-open"></i>
                    <span>Shared Journals</span></a>
                <a href="#" class="side-link" onclick="switchView('stories', this)"><i class="fas fa-pen-nib"></i>
                    <span>My Stories</span></a>
                <a href="#" class="side-link" onclick="switchView('availability', this)"><i
                        class="fas fa-calendar-check"></i> <span>Availability</span></a>
                <a href="#" class="side-link" onclick="switchView('testimonials', this)"><i
                        class="fas fa-comment-alt"></i> <span>Testimonials</span></a>

                <div style="height:1px; background:var(--border-subtle); margin:10px 0;"></div>

                <div
                    style="padding:10px 20px; font-size:0.75rem; opacity:0.6; text-transform:uppercase; font-weight:700;">
                    Self Care</div>

                <a href="#" onclick="openTool('../tools/journal.html', 'My Private Journal')" class="side-link"><i
                        class="fas fa-feather-alt"></i> <span>My Journal</span></a>
                <a href="#" class="side-link"><i class="fas fa-bookmark"></i> <span>Saved Blogs</span></a>
                <!-- Vent Box removed by user request -->

                <div style="height:1px; background:var(--border-subtle); margin:10px 0;"></div>
                <a href="#" class="side-link" onclick="switchView('supervision', this)"><i
                        class="fas fa-user-shield"></i> <span>Get Supervision</span></a>
                <a href="#" class="side-link" onclick="switchView('settings', this)"><i class="fas fa-cog"></i>
                    <span>Settings</span></a>
            </div>

            <div class="sidebar-footer">
                <button class="logout-btn" onclick="handleLogout()"><i class="fas fa-sign-out-alt"></i> Log Out</button>
            </div>
        </nav>

        <!-- MAIN CONTENT -->
        <main class="main-content fade-in">

            <!-- VIEW: OVERVIEW -->
            <div id="view-overview" class="view-section">
                <!-- PEER HEADER (Moved Inside Overview) -->
                <div class="peer-header"
                    style="display:flex; justify-content:space-between; align-items:center; margin-bottom:30px; border-bottom:1px solid var(--border-subtle); padding-bottom:20px;">
                    <div class="ph-title">
                        <h1 style="font-family:'Outfit'; color:var(--text-main); margin-bottom:5px;">Peer Dashboard</h1>
                        <p>Thank you for supporting our community today.</p>
                    </div>
                    <!-- Status Toggle -->
                    <div class="status-toggle"
                        style="display:flex; align-items:center; gap:10px; background:rgba(34, 197, 94, 0.1); padding:8px 16px; border-radius:30px; border:1px solid rgba(34, 197, 94, 0.2); cursor:pointer;"
                        onclick="this.classList.toggle('active')">
                        <div class="status-indicator"
                            style="width:10px; height:10px; border-radius:50%; background:#22c55e; box-shadow:0 0 5px #22c55e;">
                        </div>
                        <span style="font-weight:600; font-size:0.9rem; color:#22c55e;">Available</span>
                        <i class="fas fa-toggle-on" style="margin-left:5px; opacity:0.6; color:#22c55e;"></i>
                    </div>
                </div>
                <div class="dashboard-grid">
                    <!-- ANALYTICS CHART -->
                    <div class="dash-card">
                        <h4 style="margin-bottom:15px; opacity:0.8;">My Impact</h4>
                        <div style="position:relative; height:200px; width:100%;">
                            <canvas id="impactChart"></canvas>
                        </div>
                    </div>

                    <div style="display:flex; flex-direction:column; gap:20px;">
                        <div class="dash-card" style="text-align:center; border:1px solid var(--teal-accent);">
                            <h4 style="margin-bottom:10px; opacity:0.8;">People Helped</h4>
                            <div
                                style="font-size:3rem; font-weight:700; font-family:'Outfit'; color:var(--teal-accent);">
                                34</div>
                            <div style="color:#22c55e; font-size:0.85rem; margin-top:5px;">+5 this week</div>
                        </div>
                        <div class="dash-card">
                            <h4 style="margin-bottom:10px; opacity:0.8;">Peer Rating</h4>
                            <div
                                style="font-size:1.5rem; font-weight:700; color:#2dd4bf; text-shadow:0 0 10px rgba(45, 212, 191, 0.6);">
                                <i class="fas fa-star"></i> 4.9/5.0
                            </div>
                        </div>
                    </div>
                </div>

                <!-- ANALYTICS DATA (New) -->
                <div class="dashboard-grid"
                    style="grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap:20px; margin-top:20px;">
                    <!-- Profile Visits -->
                    <div class="dash-card link-hover" style="text-align:center; cursor:pointer;">
                        <div style="font-size:0.9rem; opacity:0.7; margin-bottom:5px;">Profile Visits</div>
                        <div style="font-size:2rem; font-weight:700; color:var(--text-main);">1,248</div>
                        <div style="font-size:0.8rem; color:#22c55e;">+12% this month</div>
                    </div>
                    <!-- Blog Reads -->
                    <div class="dash-card link-hover" style="text-align:center; cursor:pointer;">
                        <div style="font-size:0.9rem; opacity:0.7; margin-bottom:5px;">Blog Reads</div>
                        <div style="font-size:2rem; font-weight:700; color:var(--text-main);">856</div>
                        <div style="font-size:0.8rem; color:#22c55e;">+8% this month</div>
                    </div>
                    <!-- Saved Content -->
                    <div class="dash-card link-hover" style="text-align:center; cursor:pointer;">
                        <div style="font-size:0.9rem; opacity:0.7; margin-bottom:5px;">Saves</div>
                        <div style="font-size:2rem; font-weight:700; color:var(--teal-accent);">142</div>
                        <div style="font-size:0.8rem; color:#22c55e;">+24% this month</div>
                    </div>
                </div>

            </div>


            <!-- VIEW: TESTIMONIALS (New Dedicated Section) -->
            <div id="view-testimonials" class="view-section" style="display:none;">
                <div class="dash-card"
                    style="margin-bottom:30px; text-align:center; border:none; background:transparent;">
                    <h2 style="font-family:'Outfit'; font-size:2rem; margin-bottom:10px;">User Testimonials</h2>
                    <p>Feedback from the community about your support.</p>
                </div>

                <div class="dashboard-grid"
                    style="grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap:20px;">

                    <!-- TEMPLATE: Testimonial Card (Copy this structure for dynamic generation) -->
                    <!-- DYNAMIC ID: data-review-id="1" -->
                    <div class="dash-card testimonial-card" data-review-id="1"
                        style="position:relative; transition:all 0.3s ease;">
                        <!-- Decorative Quote Icon -->
                        <i class="fas fa-quote-right"
                            style="position:absolute; top:20px; right:20px; font-size:4rem; color:rgba(255,255,255,0.03); z-index:0;"></i>

                        <div style="position:relative; z-index:1;">
                            <!-- HEADER: User Info & Date -->
                            <div
                                style="display:flex; justify-content:space-between; margin-bottom:15px; align-items:flex-start;">
                                <div style="display:flex; gap:12px; align-items:center;">
                                    <!-- DYNAMIC: Avatar (Initials or Image) -->
                                    <div class="review-avatar"
                                        style="width:45px; height:45px; background:var(--bg-deep); border:1px solid var(--border-subtle); border-radius:50%; display:flex; align-items:center; justify-content:center; color:var(--text-muted); font-size:0.9rem; font-weight:600;">
                                        AU
                                    </div>
                                    <div>
                                        <!-- DYNAMIC: Name -->
                                        <div class="review-author"
                                            style="font-weight:700; font-size:1rem; color:var(--text-main);">Anonymous
                                            User
                                        </div>
                                        <!-- DYNAMIC: Date -->
                                        <div class="review-date" style="font-size:0.8rem; opacity:0.6;">2 days ago</div>
                                    </div>
                                </div>

                                <!-- DYNAMIC: Rating Stars -->
                                <div class="review-rating"
                                    style="background:rgba(251, 191, 36, 0.1); padding:5px 10px; border-radius:20px; border:1px solid rgba(251, 191, 36, 0.2);">
                                    <div style="color:#fbbf24; font-size:0.85rem; display:flex; gap:2px;">
                                        <i class="fas fa-star"></i><i class="fas fa-star"></i><i
                                            class="fas fa-star"></i><i class="fas fa-star"></i><i
                                            class="fas fa-star"></i>
                                    </div>
                                </div>
                            </div>

                            <!-- BODY: Content -->
                            <div
                                style="padding:15px; background:rgba(255,255,255,0.02); border-radius:12px; border:1px solid rgba(255,255,255,0.03);">
                                <!-- DYNAMIC: Text Body -->
                                <p class="review-text"
                                    style="font-size:0.95rem; line-height:1.7; opacity:0.95; margin:0; font-style:italic;">
                                    "I really appreciated how patient you were with me today. It felt like a weight was
                                    lifted
                                    off my shoulders just being able to talk openly without judgment. The listening
                                    skills were
                                    incredible."
                                </p>
                            </div>

                            <!-- FOOTER: Interaction (Optional) -->
                            <div
                                style="margin-top:15px; display:flex; justify-content:flex-end; gap:10px; opacity:0.5;">
                                <button class="btn-action-sm" onclick="alert('Ack')" title="Acknowledge"><i
                                        class="fas fa-check"></i></button>
                                <button class="btn-action-sm" style="color:#ef4444;" title="Report"><i
                                        class="fas fa-flag"></i></button>
                            </div>
                        </div>
                    </div>

                    <!-- TEMPLATE: Testimonial Card 2 -->
                    <div class="dash-card testimonial-card" data-review-id="2"
                        style="position:relative; transition:all 0.3s ease;">
                        <i class="fas fa-quote-right"
                            style="position:absolute; top:20px; right:20px; font-size:4rem; color:rgba(255,255,255,0.03); z-index:0;"></i>
                        <div style="position:relative; z-index:1;">
                            <div
                                style="display:flex; justify-content:space-between; margin-bottom:15px; align-items:flex-start;">
                                <div style="display:flex; gap:12px; align-items:center;">
                                    <div class="review-avatar"
                                        style="width:45px; height:45px; background:var(--teal-dim); border:1px solid var(--teal-border); border-radius:50%; display:flex; align-items:center; justify-content:center; color:var(--teal-accent); font-size:0.9rem; font-weight:600;">
                                        SK
                                    </div>
                                    <div>
                                        <div class="review-author"
                                            style="font-weight:700; font-size:1rem; color:var(--text-main);">Sarah K.
                                        </div>
                                        <div class="review-date" style="font-size:0.8rem; opacity:0.6;">5 days ago</div>
                                    </div>
                                </div>
                                <div class="review-rating"
                                    style="background:rgba(251, 191, 36, 0.1); padding:5px 10px; border-radius:20px; border:1px solid rgba(251, 191, 36, 0.2);">
                                    <div style="color:#fbbf24; font-size:0.85rem; display:flex; gap:2px;">
                                        <i class="fas fa-star"></i><i class="fas fa-star"></i><i
                                            class="fas fa-star"></i><i class="fas fa-star"></i><i
                                            class="fas fa-star"></i>
                                    </div>
                                </div>
                            </div>
                            <div
                                style="padding:15px; background:rgba(255,255,255,0.02); border-radius:12px; border:1px solid rgba(255,255,255,0.03);">
                                <p class="review-text"
                                    style="font-size:0.95rem; line-height:1.7; opacity:0.95; margin:0; font-style:italic;">
                                    "Thank you for the resources you shared. I've already started using the breathing
                                    tool and
                                    it helps so much."
                                </p>
                            </div>
                            <div
                                style="margin-top:15px; display:flex; justify-content:flex-end; gap:10px; opacity:0.5;">
                                <button class="btn-action-sm"><i class="fas fa-check"></i></button>
                            </div>
                        </div>
                    </div>

                    <!-- TEMPLATE: Testimonial Card 3 (Longer) -->
                    <div class="dash-card testimonial-card" data-review-id="3"
                        style="position:relative; transition:all 0.3s ease; opacity:0.8;">
                        <i class="fas fa-quote-right"
                            style="position:absolute; top:20px; right:20px; font-size:4rem; color:rgba(255,255,255,0.03); z-index:0;"></i>
                        <div style="position:relative; z-index:1;">
                            <div
                                style="display:flex; justify-content:space-between; margin-bottom:15px; align-items:flex-start;">
                                <div style="display:flex; gap:12px; align-items:center;">
                                    <div class="review-avatar"
                                        style="width:45px; height:45px; background:var(--bg-deep); border:1px solid var(--border-subtle); border-radius:50%; display:flex; align-items:center; justify-content:center; color:var(--text-muted); font-size:0.9rem;">
                                        <i class="fas fa-user-secret"></i>
                                    </div>
                                    <div>
                                        <div class="review-author"
                                            style="font-weight:700; font-size:1rem; color:var(--text-main);">Silent
                                            Observer
                                        </div>
                                        <div class="review-date" style="font-size:0.8rem; opacity:0.6;">1 week ago</div>
                                    </div>
                                </div>
                                <div class="review-rating"
                                    style="background:rgba(251, 191, 36, 0.1); padding:5px 10px; border-radius:20px; border:1px solid rgba(251, 191, 36, 0.2);">
                                    <div style="color:#fbbf24; font-size:0.85rem; display:flex; gap:2px;">
                                        <i class="fas fa-star"></i><i class="fas fa-star"></i><i
                                            class="fas fa-star"></i><i class="fas fa-star"></i><i
                                            class="fas fa-star-half-alt"></i>
                                    </div>
                                </div>
                            </div>
                            <div
                                style="padding:15px; background:rgba(255,255,255,0.02); border-radius:12px; border:1px solid rgba(255,255,255,0.03);">
                                <p class="review-text"
                                    style="font-size:0.95rem; line-height:1.7; opacity:0.95; margin:0; font-style:italic;">
                                    "Great listener. Helped me gain some perspective. I think the only improvement would
                                    be to
                                    have more resources ready at hand, but overall very supportive."
                                </p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- VIEW: EXTRAS (Placeholder for others) -->
            <div id="view-sessions" class="view-section" style="display:none;">
                <!-- Header -->
                <div style="margin-bottom:30px; border-bottom:1px solid var(--border-subtle); padding-bottom:20px;">
                    <h1 style="font-family:'Outfit'; color:var(--text-main); margin-bottom:5px; font-size:2rem;">
                        Sessions
                    </h1>
                    <p style="opacity:0.7;">Your upcoming and past peer support sessions.</p>
                </div>

                <!-- Upcoming Sessions Grid -->
                <h3 style="margin-bottom:20px; opacity:0.8;">Upcoming</h3>
                <div class="dashboard-grid"
                    style="grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap:25px; margin-bottom:40px;">

                    <!-- SESSION CARD 1 (Active) -->
                    <div class="dash-card"
                        style="border-left:4px solid var(--teal-accent); position:relative; overflow:hidden;">
                        <!-- Status Badge -->
                        <div
                            style="position:absolute; top:20px; right:20px; background:rgba(45, 212, 191, 0.1); color:var(--teal-accent); padding:4px 10px; border-radius:4px; font-size:0.75rem; font-weight:700; border:1px solid rgba(45, 212, 191, 0.2);">
                            STARTING SOON
                        </div>

                        <div style="margin-bottom:15px;">
                            <div style="font-size:0.85rem; opacity:0.6; margin-bottom:5px;">Today, 10:45 AM</div>
                            <h3 style="font-family:'Outfit'; font-size:1.3rem;">Weekly Check-in</h3>
                            <div style="display:flex; align-items:center; gap:8px; margin-top:8px;">
                                <div
                                    style="width:24px; height:24px; background:var(--bg-deep); border-radius:50%; display:flex; align-items:center; justify-content:center; font-size:0.7rem;">
                                    SC</div>
                                <span style="font-size:0.9rem; opacity:0.8;">with Sarah Chen</span>
                            </div>
                        </div>

                        <div style="display:flex; gap:10px;">
                            <button onclick="window.open('video-conference.html', '_blank')" class="btn-dash-primary"
                                style="flex:1; display:flex; align-items:center; justify-content:center; gap:8px;">
                                <i class="fas fa-video"></i> Join Now
                            </button>
                            <button class="btn-dash-secondary" style="padding:10px 15px;"><i
                                    class="fas fa-calendar-alt"></i></button>
                        </div>
                    </div>

                    <!-- SESSION CARD 2 -->
                    <div class="dash-card">
                        <div style="margin-bottom:15px;">
                            <div style="font-size:0.85rem; opacity:0.6; margin-bottom:5px;">Tomorrow, 2:00 PM</div>
                            <h3 style="font-family:'Outfit'; font-size:1.3rem;">Anxiety Management</h3>
                            <div style="display:flex; align-items:center; gap:8px; margin-top:8px;">
                                <div
                                    style="width:24px; height:24px; background:var(--bg-deep); border-radius:50%; display:flex; align-items:center; justify-content:center; font-size:0.7rem;">
                                    JD</div>
                                <span style="font-size:0.9rem; opacity:0.8;">with John Doe</span>
                            </div>
                        </div>
                        <button disabled
                            style="width:100%; background:rgba(255,255,255,0.05); border:1px solid rgba(255,255,255,0.1); color:var(--text-muted); padding:10px; border-radius:8px; cursor:not-allowed;">
                            Starts in 24h
                        </button>
                    </div>

                </div>
            </div>

            <div id="view-journals" class="view-section" style="display:none;">
                <div class="dash-card">
                    <h2>Shared Journals</h2>
                    <p>Community entries shared with you will appear here.</p>
                </div>
            </div>

            <div id="view-stories" class="view-section" style="display:none;">
                <div class="dash-card">
                    <h2>My Stories</h2>
                    <p>Share your journey.</p>
                </div>
            </div>

            <!-- VIEW: PROFILE (New Dedicated Management Page) -->
            <div id="view-profile" class="view-section" style="display:none;">
                <!-- Header -->
                <div
                    style="margin-bottom:30px; border-bottom:1px solid var(--border-subtle); padding-bottom:20px; display:flex; justify-content:space-between; align-items:end;">
                    <div>
                        <h1 style="font-family:'Outfit'; color:var(--text-main); margin-bottom:5px; font-size:2rem;">My
                            Profile</h1>
                        <p style="opacity:0.7;">Manage how you appear to the community.</p>
                    </div>
                    <button class="btn-dash-secondary" onclick="window.open('../our-peers/profile.html', '_blank')">
                        <i class="fas fa-external-link-alt"></i> View Public Page
                    </button>
                </div>

                <div class="dashboard-grid" style="grid-template-columns: 2fr 1fr; gap:30px;">

                    <!-- COLUMN 1: EDITABLE CONTENT -->
                    <div style="display:flex; flex-direction:column; gap:30px;">

                        <!-- 1. IDENTITY & QUOTE -->
                        <div class="dash-card">
                            <h3 style="margin-bottom:20px; color:var(--teal-accent);">Public Identity</h3>

                            <div style="display:flex; gap:20px; margin-bottom:25px; align-items:center;">
                                <!-- Clickable Avatar -->
                                <div onclick="togglePhotoModal(true)"
                                    style="width:80px; height:80px; border-radius:50%; background:var(--bg-deep); display:flex; align-items:center; justify-content:center; border:2px solid var(--teal-accent); cursor:pointer; position:relative; overflow:hidden; transition:transform 0.2s;"
                                    onmouseover="this.style.transform='scale(1.05)'"
                                    onmouseout="this.style.transform='scale(1)'" title="Change Photo">

                                    <!-- Initial Text Avatar -->
                                    <div class="profile-avatar-text" style="font-size:2rem; font-weight:700;">A</div>

                                    <!-- Hidden Image Avatar (For when uploaded) -->
                                    <img class="profile-avatar-img" src=""
                                        style="display:none; width:100%; height:100%; object-fit:cover;">

                                    <!-- Edit Overlay -->
                                    <div
                                        style="position:absolute; bottom:0; width:100%; background:rgba(0,0,0,0.6); font-size:0.6rem; text-align:center; padding:2px; color:#fff;">
                                        EDIT</div>
                                </div>

                                <div style="flex:1;">
                                    <label
                                        style="display:block; font-size:0.85rem; opacity:0.7; margin-bottom:5px;">Display
                                        Name</label>
                                    <input type="text" value="Aditya"
                                        style="width:100%; padding:12px; background:rgba(255,255,255,0.03); border:1px solid var(--border-subtle); border-radius:8px; color:var(--text-main); font-family:'Outfit'; font-size:1.1rem; font-weight:600;">
                                </div>
                            </div>

                            <div style="margin-bottom:0;">
                                <label style="display:block; font-size:0.85rem; opacity:0.7; margin-bottom:5px;">Profile
                                    Quote</label>
                                <input type="text"
                                    value="You don't have to know what to say here. We can just sit with it."
                                    style="width:100%; padding:12px; background:rgba(255,255,255,0.03); border:1px solid var(--border-subtle); border-radius:8px; color:var(--text-main); font-family:'Outfit'; font-style:italic;">
                            </div>
                        </div>

                        <!-- 2. MY STORY -->
                        <div class="dash-card">
                            <h3 style="margin-bottom:15px; color:var(--peach-accent);">A Little About Me</h3>
                            <p style="font-size:0.85rem; opacity:0.6; margin-bottom:15px;">Share your journey and why
                                you are here. Keep it authentic.</p>
                            <textarea
                                style="width:100%; height:150px; background:rgba(255,255,255,0.03); border:1px solid var(--border-subtle); border-radius:12px; padding:15px; color:var(--text-main); font-family:'Outfit'; line-height:1.6; resize:vertical;">I'm here for conversations that feel tangled, slow, or unfinished. I know what it's like when thoughts don't stop looping, and when explaining yourself feels harder than just staying quiet.

You don't need to arrive with clarity. We can find it together, or simply sit with what is. I've navigated my own path through academic pressure and burnout, and I understand the weight of expectations.</textarea>
                        </div>

                        <!-- 3. MY APPROACH (Defaults) -->
                        <div class="dash-card">
                            <h3 style="margin-bottom:20px; color:var(--teal-accent);">My Approach</h3>

                            <div style="margin-bottom:25px;">
                                <label style="display:block; font-weight:600; margin-bottom:10px;">This space may feel
                                    right if...</label>
                                <textarea
                                    style="width:100%; height:140px; background:rgba(255,255,255,0.03); border:1px solid var(--border-subtle); border-radius:12px; padding:15px; color:var(--text-main); font-family:'Outfit'; line-height:1.6; resize:vertical;">• You're overthinking small things that don't feel small.
• You feel emotionally tired but aren't sure why.
• You're carrying things you haven't said out loud yet.
• You want a calm listener, not a problem-solver.
• You aren't ready for therapy, but don't want to be alone.</textarea>
                            </div>

                            <div>
                                <label style="display:block; font-weight:600; margin-bottom:10px;">What our conversation
                                    looks like</label>
                                <textarea
                                    style="width:100%; height:120px; background:rgba(255,255,255,0.03); border:1px solid var(--border-subtle); border-radius:12px; padding:15px; color:var(--text-main); font-family:'Outfit'; line-height:1.6; resize:vertical;">• We start wherever you are (no agenda).
• You can talk, type, or take breaks.
• I won't interrupt or rush you.
• There's no "right" outcome expected.</textarea>
                            </div>
                        </div>

                        <!-- SAVE ACTION -->
                        <div style="text-align:right;">
                            <button class="btn-dash-primary" onclick="alert('Profile updated successfully!')"
                                style="padding:12px 30px; font-size:1rem;">
                                Save Changes
                            </button>
                        </div>
                    </div>

                    <!-- COLUMN 2: BASICS & TAGS -->
                    <div style="display:flex; flex-direction:column; gap:30px;">

                        <!-- DETAILS -->
                        <div class="dash-card">
                            <h3 style="margin-bottom:20px; color:var(--teal-accent);">The Basics</h3>

                            <div style="margin-bottom:20px;">
                                <label
                                    style="display:block; font-size:0.85rem; opacity:0.7; margin-bottom:5px;">Languages</label>
                                <input type="text" value="English, Hindi"
                                    style="width:100%; padding:10px; background:rgba(255,255,255,0.03); border:1px solid var(--border-subtle); border-radius:8px; color:var(--text-main); font-family:'Outfit';">
                            </div>

                            <div style="margin-bottom:0;">
                                <label style="display:block; font-size:0.85rem; opacity:0.7; margin-bottom:10px;">I am
                                    available for:</label>
                                <div style="display:flex; gap:15px;">
                                    <label style="display:flex; align-items:center; gap:8px; cursor:pointer;">
                                        <input type="checkbox" checked style="accent-color:var(--teal-accent);"> Chat
                                    </label>
                                    <label style="display:flex; align-items:center; gap:8px; cursor:pointer;">
                                        <input type="checkbox" checked style="accent-color:var(--teal-accent);"> Call
                                    </label>
                                    <label style="display:flex; align-items:center; gap:8px; cursor:pointer;">
                                        <input type="checkbox" style="accent-color:var(--teal-accent);"> Video
                                    </label>
                                </div>
                            </div>
                        </div>

                        <!-- TAGS -->
                        <div class="dash-card">
                            <h3 style="margin-bottom:15px; color:var(--teal-accent);">Lived Experience</h3>
                            <p style="font-size:0.8rem; opacity:0.6; margin-bottom:15px;">Select tags that represent
                                your journey.</p>

                            <div style="display:flex; flex-wrap:wrap; gap:10px;">
                                <!-- LIFE CHALLENGES -->
                                <button onclick="this.classList.toggle('active')" class="tag-btn active">Academic
                                    Stress</button>
                                <button onclick="this.classList.toggle('active')"
                                    class="tag-btn active">Burnout</button>
                                <button onclick="this.classList.toggle('active')" class="tag-btn">Loneliness</button>
                                <button onclick="this.classList.toggle('active')" class="tag-btn">Existential
                                    Crisis</button>
                                <button onclick="this.classList.toggle('active')" class="tag-btn">Social
                                    Anxiety</button>

                                <!-- RELATIONSHIPS & FAMILY -->
                                <button onclick="this.classList.toggle('active')" class="tag-btn">Relationships</button>
                                <button onclick="this.classList.toggle('active')" class="tag-btn">Breakups /
                                    Heartbreak</button>
                                <button onclick="this.classList.toggle('active')" class="tag-btn">Toxic Family
                                    Dynamics</button>
                                <button onclick="this.classList.toggle('active')" class="tag-btn">Divorce /
                                    Separation</button>
                                <button onclick="this.classList.toggle('active')" class="tag-btn">Parenting
                                    Challenges</button>

                                <!-- IDENTITY & SELF -->
                                <button onclick="this.classList.toggle('active')" class="tag-btn">Body Image</button>
                                <button onclick="this.classList.toggle('active')" class="tag-btn">Identity &
                                    Self-Worth</button>
                                <button onclick="this.classList.toggle('active')" class="tag-btn">LGBTQIA+
                                    Journey</button>
                                <button onclick="this.classList.toggle('active')" class="tag-btn">High Sensitivity
                                    (HSP)</button>
                                <button onclick="this.classList.toggle('active')" class="tag-btn">ADHD (Lived
                                    Experience)</button>

                                <!-- WORK & HEALTH -->
                                <button onclick="this.classList.toggle('active')" class="tag-btn">Career
                                    Anxiety</button>
                                <button onclick="this.classList.toggle('active')" class="tag-btn">Imposter
                                    Syndrome</button>
                                <button onclick="this.classList.toggle('active')" class="tag-btn">Workplace
                                    Toxicity</button>
                                <button onclick="this.classList.toggle('active')" class="tag-btn">Chronic Illness /
                                    Pain</button>
                                <button onclick="this.classList.toggle('active')" class="tag-btn">Grief & Loss</button>
                            </div>

                            <style>
                                .tag-btn {
                                    background: transparent;
                                    border: 1px solid var(--border-subtle);
                                    color: var(--text-muted);
                                    padding: 6px 14px;
                                    border-radius: 20px;
                                    cursor: pointer;
                                    font-size: 0.85rem;
                                    transition: all 0.2s;
                                }

                                .tag-btn:hover {
                                    border-color: var(--teal-accent);
                                    color: var(--text-main);
                                }

                                .tag-btn.active {
                                    background: rgba(45, 212, 191, 0.2) !important;
                                    border-color: var(--teal-accent) !important;
                                    color: var(--teal-accent) !important;
                                }
                            </style>
                        </div>
                    </div>
                </div>
            </div>

            <div id="view-availability" class="view-section" style="display:none;">
                <!-- Header -->
                <div style="margin-bottom:30px; border-bottom:1px solid var(--border-subtle); padding-bottom:20px;">
                    <h1 style="font-family:'Outfit'; color:var(--text-main); margin-bottom:5px; font-size:2rem;">
                        Availability</h1>
                    <p style="opacity:0.7;">Manage your time slots and sync with your personal calendar.</p>
                </div>

                <div class="dashboard-grid" style="grid-template-columns: 2fr 1fr; gap:30px;">

                    <!-- COLUMN 1: WEEKLY SCHEDULER -->
                    <div class="dash-card">
                        <div
                            style="display:flex; justify-content:space-between; align-items:center; margin-bottom:25px;">
                            <h3 style="color:var(--teal-accent);">Weekly Schedule</h3>
                            <div
                                style="font-size:0.8rem; background:rgba(45, 212, 191, 0.1); color:var(--teal-accent); padding:5px 10px; border-radius:20px;">
                                <i class="fas fa-globe"></i> GMT+05:30 (Your Time)
                            </div>
                        </div>

                        <!-- Days List -->
                        <div class="schedule-list">
                            <!-- MONDAY -->
                            <div class="schedule-row"
                                style="display:flex; border-bottom:1px solid var(--border-subtle); padding:15px 0; align-items:center;">
                                <div style="width:100px; font-weight:600;">Mon</div>
                                <div style="flex:1;">
                                    <div style="display:flex; align-items:center; gap:10px; margin-bottom:5px;">
                                        <input type="time" value="09:00"
                                            style="background:rgba(255,255,255,0.05); border:1px solid var(--border-subtle); color:var(--text-main); padding:8px; border-radius:6px;">
                                        <span>-</span>
                                        <input type="time" value="17:00"
                                            style="background:rgba(255,255,255,0.05); border:1px solid var(--border-subtle); color:var(--text-main); padding:8px; border-radius:6px;">
                                        <button
                                            style="background:none; border:none; color:var(--text-muted); cursor:pointer;"><i
                                                class="fas fa-trash"></i></button>
                                    </div>
                                </div>
                                <button
                                    style="background:none; border:none; color:var(--teal-accent); cursor:pointer;"><i
                                        class="fas fa-plus"></i></button>
                            </div>

                            <!-- TUESDAY -->
                            <div class="schedule-row"
                                style="display:flex; border-bottom:1px solid var(--border-subtle); padding:15px 0; align-items:center;">
                                <div style="width:100px; font-weight:600;">Tue</div>
                                <div style="flex:1;">
                                    <div style="display:flex; align-items:center; gap:10px; margin-bottom:5px;">
                                        <input type="time" value="10:00"
                                            style="background:rgba(255,255,255,0.05); border:1px solid var(--border-subtle); color:var(--text-main); padding:8px; border-radius:6px;">
                                        <span>-</span>
                                        <input type="time" value="14:00"
                                            style="background:rgba(255,255,255,0.05); border:1px solid var(--border-subtle); color:var(--text-main); padding:8px; border-radius:6px;">
                                        <button
                                            style="background:none; border:none; color:var(--text-muted); cursor:pointer;"><i
                                                class="fas fa-trash"></i></button>
                                    </div>
                                </div>
                                <button
                                    style="background:none; border:none; color:var(--teal-accent); cursor:pointer;"><i
                                        class="fas fa-plus"></i></button>
                            </div>

                            <!-- WEDNESDAY (Unavailable) -->
                            <div class="schedule-row"
                                style="display:flex; border-bottom:1px solid var(--border-subtle); padding:15px 0; align-items:center; opacity:0.5;">
                                <div style="width:100px; font-weight:600;">Wed</div>
                                <div style="flex:1; font-style:italic;">Unavailable</div>
                                <button
                                    style="background:none; border:none; color:var(--teal-accent); cursor:pointer;"><i
                                        class="fas fa-plus"></i></button>
                            </div>
                        </div>

                        <div style="margin-top:25px; text-align:right;">
                            <button class="btn-dash-primary" onclick="alert('Availability saved!')">Save
                                Schedule</button>
                        </div>
                    </div>

                    <!-- COLUMN 2: CALENDAR INTEGRATION -->
                    <div style="display:flex; flex-direction:column; gap:25px;">

                        <!-- Integration Card -->
                        <div class="dash-card"
                            style="background:linear-gradient(145deg, rgba(30,41,59,0.7), rgba(15,23,42,0.9)); border:1px solid var(--teal-dim);">
                            <h3 style="margin-bottom:15px; display:flex; align-items:center; gap:10px;">
                                <i class="fas fa-sync-alt" style="color:var(--teal-accent);"></i> Sync Calendar
                            </h3>
                            <p style="font-size:0.85rem; opacity:0.7; margin-bottom:20px;">
                                Connect your calendar to automatically block sessions and prevent double-booking.
                            </p>

                            <!-- Google -->
                            <button
                                onclick="this.innerHTML='<i class=\'fas fa-check\'></i> Connected'; this.style.borderColor='var(--success)'; this.style.color='var(--success)';"
                                style="width:100%; display:flex; align-items:center; gap:12px; padding:12px; background:rgba(255,255,255,0.05); border:1px solid var(--border-subtle); border-radius:8px; margin-bottom:10px; color:var(--text-main); cursor:pointer; font-weight:500; transition:all 0.2s;">
                                <i class="fab fa-google" style="color:#EA4335;"></i> Google Calendar
                            </button>

                            <!-- Outlook -->
                            <button onclick="alert('Outlook integration requires API setup.')"
                                style="width:100%; display:flex; align-items:center; gap:12px; padding:12px; background:rgba(255,255,255,0.05); border:1px solid var(--border-subtle); border-radius:8px; margin-bottom:10px; color:var(--text-main); cursor:pointer; font-weight:500; transition:all 0.2s;">
                                <i class="fab fa-microsoft" style="color:#0078D4;"></i> Outlook Calendar
                            </button>

                            <!-- Apple -->
                            <button onclick="alert('iCal link copied to clipboard!')"
                                style="width:100%; display:flex; align-items:center; gap:12px; padding:12px; background:rgba(255,255,255,0.05); border:1px solid var(--border-subtle); border-radius:8px; color:var(--text-main); cursor:pointer; font-weight:500; transition:all 0.2s;">
                                <i class="fab fa-apple" style="color:#fff;"></i> Apple Calendar
                            </button>
                        </div>

                        <!-- Sync Settings -->
                        <div class="dash-card">
                            <h4 style="margin-bottom:15px; color:var(--peach-accent);">Sync Settings</h4>
                            <label
                                style="display:flex; align-items:center; gap:10px; font-size:0.9rem; margin-bottom:12px; cursor:pointer;">
                                <input type="checkbox" checked style="accent-color:var(--teal-accent);">
                                <span style="opacity:0.8;">Add sessions to my calendar</span>
                            </label>
                            <label
                                style="display:flex; align-items:center; gap:10px; font-size:0.9rem; margin-bottom:0; cursor:pointer;">
                                <input type="checkbox" style="accent-color:var(--teal-accent);">
                                <span style="opacity:0.8;">Block calendar busy times</span>
                            </label>
                        </div>
                    </div>

                </div>
            </div>

            <!-- VIEW: SUPERVISION (Restored) -->
            <!-- VIEW: SUPERVISION (Restored & Enhanced) -->
            <div id="view-supervision" class="view-section" style="display:none;">
                <div class="dash-card">
                    <!-- Header -->
                    <div style="text-align:center; margin-bottom:40px;">
                        <h1 style="font-family:'Outfit'; font-size:2.5rem; color:#F49F75; margin-bottom:15px;">Peer
                            Support Guidelines</h1>
                        <p style="opacity:0.8; max-width:800px; margin:0 auto; line-height:1.6;">
                            Peer support sessions are an integral part of the Soulamore community, providing a safe and
                            supportive space for individuals to connect, share experiences, and offer mutual
                            encouragement.
                        </p>
                    </div>

                    <!-- Guidelines Grid -->
                    <div
                        style="display:grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap:25px; margin-bottom:40px;">

                        <!-- 1. Confidentiality -->
                        <div
                            style="background:rgba(244, 159, 117, 0.05); border:1px solid rgba(244, 159, 117, 0.2); border-radius:12px; padding:25px;">
                            <h3 style="color:#F49F75; font-family:'Outfit'; margin-bottom:10px; font-size:1.2rem;">1.
                                Confidentiality</h3>
                            <p style="font-size:0.95rem; opacity:0.8; line-height:1.6;">Respect the confidentiality of
                                all participants. What is shared in the session should remain confidential, unless there
                                is an immediate risk of harm. Encourage an environment of trust.</p>
                        </div>

                        <!-- 2. Active Listening -->
                        <div
                            style="background:rgba(244, 159, 117, 0.05); border:1px solid rgba(244, 159, 117, 0.2); border-radius:12px; padding:25px;">
                            <h3 style="color:#F49F75; font-family:'Outfit'; margin-bottom:10px; font-size:1.2rem;">2.
                                Active Listening</h3>
                            <p style="font-size:0.95rem; opacity:0.8; line-height:1.6;">Give your full attention without
                                interruption. Validate feelings and refrain from offering unsolicited advice. Allow each
                                participant to express themselves fully.</p>
                        </div>

                        <!-- 3. Empathy & Compassion -->
                        <div
                            style="background:rgba(244, 159, 117, 0.05); border:1px solid rgba(244, 159, 117, 0.2); border-radius:12px; padding:25px;">
                            <h3 style="color:#F49F75; font-family:'Outfit'; margin-bottom:10px; font-size:1.2rem;">3.
                                Empathy & Compassion</h3>
                            <p style="font-size:0.95rem; opacity:0.8; line-height:1.6;">Acknowledge emotions without
                                trying to fix them. Remember that everyone's journey is unique, and validation fosters
                                connection and healing.</p>
                        </div>

                        <!-- 4. Boundaries -->
                        <div
                            style="background:rgba(244, 159, 117, 0.05); border:1px solid rgba(244, 159, 117, 0.2); border-radius:12px; padding:25px;">
                            <h3 style="color:#F49F75; font-family:'Outfit'; margin-bottom:10px; font-size:1.2rem;">4.
                                Boundaries</h3>
                            <p style="font-size:0.95rem; opacity:0.8; line-height:1.6;">Maintain appropriate boundaries.
                                Avoid probing into personal details. Repect discomfort and shift conversations if needed
                                to maintain safety.</p>
                        </div>

                        <!-- 5. Non-Directive Approach -->
                        <div
                            style="background:rgba(244, 159, 117, 0.05); border:1px solid rgba(244, 159, 117, 0.2); border-radius:12px; padding:25px;">
                            <h3 style="color:#F49F75; font-family:'Outfit'; margin-bottom:10px; font-size:1.2rem;">5.
                                Non-Directive Approach</h3>
                            <p style="font-size:0.95rem; opacity:0.8; line-height:1.6;">Allow individuals to explore at
                                their own pace. Encourage self-reflection by asking open-ended questions that promote
                                insight.</p>
                        </div>

                        <!-- 6. Self-Disclosure -->
                        <div
                            style="background:rgba(244, 159, 117, 0.05); border:1px solid rgba(244, 159, 117, 0.2); border-radius:12px; padding:25px;">
                            <h3 style="color:#F49F75; font-family:'Outfit'; margin-bottom:10px; font-size:1.2rem;">6.
                                Self-Disclosure</h3>
                            <p style="font-size:0.95rem; opacity:0.8; line-height:1.6;">Exercise caution when sharing
                                personal anecdotes. Avoid monopolizing the conversation. Focus on creating a balanced
                                exchange.</p>
                        </div>

                        <!-- 7. Empowerment -->
                        <div
                            style="background:rgba(244, 159, 117, 0.05); border:1px solid rgba(244, 159, 117, 0.2); border-radius:12px; padding:25px;">
                            <h3 style="color:#F49F75; font-family:'Outfit'; margin-bottom:10px; font-size:1.2rem;">7.
                                Empowerment</h3>
                            <p style="font-size:0.95rem; opacity:0.8; line-height:1.6;">Empower participants to take
                                ownership. Respect their autonomy. Provide resources but avoid imposing solutions.</p>
                        </div>

                        <!-- 8. Cultural Sensitivity -->
                        <div
                            style="background:rgba(244, 159, 117, 0.05); border:1px solid rgba(244, 159, 117, 0.2); border-radius:12px; padding:25px;">
                            <h3 style="color:#F49F75; font-family:'Outfit'; margin-bottom:10px; font-size:1.2rem;">8.
                                Cultural Sensitivity</h3>
                            <p style="font-size:0.95rem; opacity:0.8; line-height:1.6;">Respect and celebrate individual
                                identities, backgrounds, and beliefs. create an inclusive environment free from
                                stereotypes.</p>
                        </div>

                    </div>

                    <!-- Safety Critical Section -->
                    <div
                        style="background:rgba(239, 68, 68, 0.1); border:1px solid rgba(239, 68, 68, 0.3); border-radius:12px; padding:30px; margin-bottom:40px;">
                        <h3
                            style="color:#ef4444; font-family:'Outfit'; margin-bottom:15px; font-size:1.4rem; display:flex; align-items:center; gap:10px;">
                            <i class="fas fa-exclamation-circle"></i> Safety and Crisis Management
                        </h3>
                        <p style="opacity:0.9; color:#fca5a5; line-height:1.6; margin-bottom:0;">
                            Prioritize the safety and well-being of participants at all times. If someone expresses
                            thoughts of self-harm or harm to others, take appropriate action immediately. Use the
                            <strong style="color:#fff;">SOS Protocol</strong> contacts and familiarize yourself with
                            crisis management protocols.
                        </p>
                    </div>

                    <!-- Closing Quote -->
                    <div
                        style="background:rgba(45, 212, 191, 0.05); border-left:4px solid #4ECDC4; padding:25px; border-radius:0 8px 8px 0; margin-bottom:40px;">
                        <p
                            style="font-style:italic; font-size:1.1rem; color:#e2e8f0; line-height:1.8; margin-bottom:15px;">
                            "Remember, as a peer supporter, you are not only offering valuable assistance but also
                            representing Soulamore's commitment to fostering a supportive and empathetic community. Your
                            dedication ensures that every participant feels heard, valued, and supported."
                        </p>
                        <div
                            style="font-weight:700; color:#4ECDC4; letter-spacing:1px; text-transform:uppercase; font-size:0.9rem;">
                            — Team Soulamore
                        </div>
                    </div>

                    <!-- Actions -->
                    <div style="text-align:center; padding-top:20px; border-top:1px solid var(--border-subtle);">
                        <button class="btn-dash-primary"
                            onclick="window.location.href='../our-psychologists/about.html'">Book
                            Supervision
                            Session</button>
                        <button class="btn-dash-secondary" style="margin-left:15px;"
                            onclick="window.open('../assets/docs/PeerHandbook.pdf', '_blank')">Download
                            Handbook</button>
                    </div>

                </div>
            </div>



            <!-- VIEW: SETTINGS (Adapted for Peer Dashboard) -->
            <div id="view-settings" class="view-section" style="display:none;">
                <!-- Internal Style for Settings -->
                <style>
                    /* Theme Mode Button */
                    .theme-btn {
                        background: var(--bg-card);
                        border: 1px solid var(--border-subtle);
                        color: var(--text-muted);
                        padding: 10px 20px;
                        border-radius: 8px;
                        cursor: pointer;
                        display: flex;
                        align-items: center;
                        gap: 8px;
                        transition: all 0.2s;
                    }

                    .theme-btn:hover {
                        background: rgba(255, 255, 255, 0.05);
                        color: var(--text-main);
                    }

                    .theme-btn.active {
                        background: rgba(45, 212, 191, 0.1);
                        border-color: var(--teal-accent);
                        color: var(--teal-accent);
                        font-weight: 600;
                    }

                    /* Light Mode Overrides (Applied when body has .light-mode) */
                    body.light-mode {
                        background-color: #f8fafc;
                        color: #0f172a;
                        --bg-deep: #f8fafc;
                        --bg-card: #ffffff;
                        --bg-sidebar: #f1f5f9;
                        --text-main: #0f172a;
                        --text-muted: #64748b;
                        --border-subtle: #e2e8f0;
                    }
                </style>

                <!-- Header (Matches Overview Style) -->
                <div style="margin-bottom:30px; border-bottom:1px solid var(--border-subtle); padding-bottom:20px;">
                    <h1 style="font-family:'Outfit'; color:var(--text-main); margin-bottom:5px; font-size:2rem;">
                        Settings
                    </h1>
                    <p style="opacity:0.7;">Customize your workspace</p>
                </div>

                <div class="dashboard-grid" style="grid-template-columns: 1fr; gap:25px;">
                    <!-- APPEARANCE CARD -->
                    <div class="dash-card">
                        <h3 style="margin-bottom:20px; color:var(--teal-accent);">Appearance</h3>

                        <!-- Mode Toggle -->
                        <div style="margin-bottom:20px;">
                            <label style="display:block; margin-bottom:15px; font-weight:600; opacity:0.9;">Interface
                                Theme</label>
                            <div style="display:flex; gap:15px;">
                                <button onclick="setThemeMode('dark')" class="theme-btn active" id="btn-mode-dark">
                                    <i class="fas fa-moon"></i> Dark
                                </button>
                                <button onclick="setThemeMode('light')" class="theme-btn" id="btn-mode-light">
                                    <i class="fas fa-sun"></i> Light
                                </button>
                            </div>
                        </div>
                        <p style="font-size:0.85rem; opacity:0.6; line-height:1.5;">
                            Choose the theme that best fits your environment. Dark mode is recommended for night
                            sessions.
                        </p>
                    </div>

                    <!-- PROFILE CARD -->
                    <div class="dash-card">
                        <h3 style="margin-bottom:20px; color:var(--teal-accent);">Information</h3>

                        <!-- Read Only Info -->
                        <div style="display:grid; gap:15px; margin-bottom:25px;">
                            <div>
                                <label style="display:block; font-size:0.85rem; opacity:0.7; margin-bottom:5px;">Display
                                    Name</label>
                                <div
                                    style="padding:12px; background:rgba(255,255,255,0.03); border:1px solid var(--border-subtle); border-radius:8px; font-weight:600;">
                                    Peer Portal User
                                </div>
                            </div>
                            <!-- PROFILE CARD -->
                            <div class="dash-card">
                                <h3 style="margin-bottom:20px; color:var(--teal-accent);">Personal Information</h3>

                                <!-- Personal Details -->
                                <div
                                    style="display:grid; grid-template-columns: 1fr 1fr; gap:20px; margin-bottom:20px;">
                                    <div>
                                        <label
                                            style="display:block; font-size:0.85rem; opacity:0.7; margin-bottom:8px;">Display
                                            Name</label>
                                        <input type="text" id="profile-name" value="Peer Portal User"
                                            style="width:100%; padding:12px; background:rgba(255,255,255,0.03); border:1px solid var(--border-subtle); border-radius:10px; color:var(--text-main); outline:none;">
                                    </div>
                                    <div>
                                        <label
                                            style="display:block; font-size:0.85rem; opacity:0.7; margin-bottom:8px;">Phone
                                            Number</label>
                                        <input type="tel" id="profile-phone" value="" placeholder="Add phone number"
                                            style="width:100%; padding:12px; background:rgba(255,255,255,0.03); border:1px solid var(--border-subtle); border-radius:10px; color:var(--text-main); outline:none;">
                                    </div>
                                </div>

                                <!-- Role Info (Read Only) -->
                                <div style="margin-bottom:25px;">
                                    <label
                                        style="display:block; font-size:0.85rem; opacity:0.7; margin-bottom:8px;">Role</label>
                                    <div
                                        style="display:flex; align-items:center; gap:10px; padding:12px; background:rgba(45, 212, 191, 0.05); border:1px solid rgba(45, 212, 191, 0.2); border-radius:10px;">
                                        <i class="fas fa-certificate" style="color:var(--teal-accent);"></i>
                                        <span style="flex:1; color:var(--text-main); opacity:0.9;">Verified Peer
                                            Support</span>
                                        <span
                                            style="background:var(--teal-accent); color:#0f172a; padding:2px 8px; border-radius:4px; font-size:0.7rem; font-weight:700;">ACTIVE</span>
                                    </div>
                                </div>

                                <!-- Actions -->
                                <div
                                    style="display:flex; gap:15px; border-top:1px solid var(--border-subtle); padding-top:20px;">
                                    <button class="btn-dash-primary" style="padding:10px 25px; font-size:0.95rem;">Save
                                        Changes</button>
                                    <button class="btn-dash-secondary"
                                        style="background:transparent; border:1px solid var(--border-subtle); color:var(--text-muted); padding:10px 20px; border-radius:50px; cursor:pointer;"
                                        onclick="alert('Password reset link sent.')">Change Password</button>
                                </div>
                            </div>
        </main>
    </div>
    </div>
    </div>

    <!-- SCRIPT LOGIC -->
    <script>
        function toggleSidebar() { document.getElementById('sidebar').classList.toggle('open'); }
        function handleLogout() { sessionStorage.clear(); localStorage.removeItem('soulamore_session'); window.location.href = 'login.html'; }

        function switchView(viewName, clickedLink) {
            document.querySelectorAll('.view-section').forEach(el => el.style.display = 'none');
            const target = document.getElementById('view-' + viewName);
            if (target) target.style.display = 'block';

            if (clickedLink) {
                document.querySelectorAll('.sidebar-nav .side-link').forEach(l => l.classList.remove('active'));
                clickedLink.classList.add('active');
            }
        }

        // Chart JS fixed
        const ctx = document.getElementById('impactChart');
        if (ctx) {
            const ctx2d = ctx.getContext('2d');
            new Chart(ctx2d, {
                type: 'bar',
                data: {
                    labels: ['Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat', 'Sun'],
                    datasets: [{
                        label: 'Engagement',
                        data: [5, 8, 12, 4, 6, 15, 20],
                        backgroundColor: '#F49F75', /* PEACH GLOW */
                        borderRadius: 4
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: { legend: { display: false } },
                    scales: {
                        x: { ticks: { color: 'rgba(255,255,255,0.5)' }, grid: { display: false } },
                        y: { ticks: { color: 'rgba(255,255,255,0.5)' }, grid: { color: 'rgba(255,255,255,0.05)' } }
                    }
                }
            });
        }
    </script>

    <!-- FLOATING TOOLS & SOULBOT -->
    <!-- SoulBot FAB -->
    <button onclick="window.location.href='../tools/soulbot-chat.html'"
        style="position:fixed; bottom:100px; right:30px; width:56px; height:56px; border-radius:50%; background:#2dd4bf; border:none; cursor:pointer; box-shadow:0 0 20px rgba(45, 212, 191, 0.3); display:flex; align-items:center; justify-content:center; z-index:900; transition:all 0.3s ease;">
        <i class="fas fa-robot" style="font-size:1.4rem; color:#0f172a;"></i>
    </button>

    <!-- Tools FAB -->
    <button id="tools-fab" onclick="toggleToolsMenu()"
        style="position:fixed; bottom:30px; right:30px; width:56px; height:56px; border-radius:50%; background:var(--teal-accent); border:none; cursor:pointer; box-shadow:0 0 20px var(--teal-dim); display:flex; align-items:center; justify-content:center; z-index:1000; transition:all 0.3s ease;">
        <i class="fas fa-toolbox" style="font-size:1.4rem; color:#0f172a;"></i>
    </button>

    <!-- TOOLS SLIDE-OUT MENU -->
    <div id="tools-menu"
        style="position:fixed; top:0; right:-350px; width:350px; height:100vh; background:var(--bg-card); border-left:1px solid var(--border-subtle); z-index:1001; transition:right 0.3s ease; display:flex; flex-direction:column; box-shadow:-4px 0 20px rgba(0,0,0,0.5);">
        <!-- Header -->
        <div
            style="padding:20px; border-bottom:1px solid var(--border-subtle); display:flex; justify-content:space-between; align-items:center; background:rgba(0,0,0,0.2);">
            <div>
                <h3 style="margin:0; font-family:'Outfit'; font-size:1.2rem;">Self-Help Tools</h3>
                <p style="margin:5px 0 0 0; font-size:0.8rem; opacity:0.7;">Quick access to all tools</p>
            </div>
            <button onclick="toggleToolsMenu()"
                style="background:transparent; border:none; color:var(--text-main); cursor:pointer; font-size:1.5rem; opacity:0.7; padding:5px;">
                <i class="fas fa-times"></i>
            </button>
        </div>

        <!-- Tools List -->
        <div style="flex:1; overflow-y:auto; padding:15px;">
            <!-- Vent Box -->
            <div onclick="window.open('../tools/vent-box.html', '_blank')" class="tool-item"
                style="padding:15px; background:rgba(239,68,68,0.1); border:1px solid rgba(239,68,68,0.3); border-radius:12px; margin-bottom:12px; cursor:pointer; transition:all 0.2s;">
                <div style="display:flex; align-items:center; gap:12px;">
                    <div
                        style="width:40px; height:40px; background:rgba(239,68,68,0.2); border-radius:50%; display:flex; align-items:center; justify-content:center;">
                        <i class="fas fa-fire" style="color:#ef4444; font-size:1.1rem;"></i>
                    </div>
                    <div style="flex:1;">
                        <h4 style="margin:0; font-size:1rem; color:#ef4444;">Vent Box</h4>
                        <p style="margin:3px 0 0 0; font-size:0.75rem; opacity:0.7;">Release frustration
                            safely
                        </p>
                    </div>
                    <i class="fas fa-external-link-alt" style="opacity:0.5; font-size:0.9rem;"></i>
                </div>
            </div>

            <!-- Confession Box -->
            <div onclick="window.open('../tools/confession-box/index.html', '_blank')" class="tool-item"
                style="padding:15px; background:rgba(139,92,246,0.1); border:1px solid rgba(139,92,246,0.3); border-radius:12px; margin-bottom:12px; cursor:pointer; transition:all 0.2s;">
                <div style="display:flex; align-items:center; gap:12px;">
                    <div
                        style="width:40px; height:40px; background:rgba(139,92,246,0.2); border-radius:50%; display:flex; align-items:center; justify-content:center;">
                        <i class="fas fa-ghost" style="color:#8b5cf6; font-size:1.1rem;"></i>
                    </div>
                    <div style="flex:1;">
                        <h4 style="margin:0; font-size:1rem; color:#8b5cf6;">Confession Box</h4>
                        <p style="margin:3px 0 0 0; font-size:0.75rem; opacity:0.7;">Share anonymously</p>
                    </div>
                    <i class="fas fa-external-link-alt" style="opacity:0.5; font-size:0.9rem;"></i>
                </div>
            </div>

            <!-- Drop It -->
            <div onclick="window.open('../tools/drop-it.html', '_blank')" class="tool-item"
                style="padding:15px; background:rgba(56,189,248,0.1); border:1px solid rgba(56,189,248,0.3); border-radius:12px; margin-bottom:12px; cursor:pointer; transition:all 0.2s;">
                <div style="display:flex; align-items:center; gap:12px;">
                    <div
                        style="width:40px; height:40px; background:rgba(56,189,248,0.2); border-radius:50%; display:flex; align-items:center; justify-content:center;">
                        <i class="fas fa-hand-holding-water" style="color:#38bdf8; font-size:1.1rem;"></i>
                    </div>
                    <div style="flex:1;">
                        <h4 style="margin:0; font-size:1rem; color:#38bdf8;">Drop It</h4>
                        <p style="margin:3px 0 0 0; font-size:0.75rem; opacity:0.7;">Let go of worries</p>
                    </div>
                    <i class="fas fa-external-link-alt" style="opacity:0.5; font-size:0.9rem;"></i>
                </div>
            </div>

            <!-- Playground -->
            <div onclick="window.open('../tools/playground.html', '_blank')" class="tool-item"
                style="padding:15px; background:rgba(250,176,5,0.1); border:1px solid rgba(250,176,5,0.3); border-radius:12px; margin-bottom:12px; cursor:pointer; transition:all 0.2s;">
                <div style="display:flex; align-items:center; gap:12px;">
                    <div
                        style="width:40px; height:40px; background:rgba(250,176,5,0.2); border-radius:50%; display:flex; align-items:center; justify-content:center;">
                        <i class="fas fa-shapes" style="color:#fab005; font-size:1.1rem;"></i>
                    </div>
                    <div style="flex:1;">
                        <h4 style="margin:0; font-size:1rem; color:#fab005;">Playground</h4>
                        <p style="margin:3px 0 0 0; font-size:0.75rem; opacity:0.7;">Creative relief</p>
                    </div>
                    <i class="fas fa-external-link-alt" style="opacity:0.5; font-size:0.9rem;"></i>
                </div>
            </div>

            <!-- Breathing Exercise -->
            <div onclick="window.open('../tools/breathing.html', '_blank')" class="tool-item"
                style="padding:15px; background:rgba(45,212,191,0.1); border:1px solid rgba(45,212,191,0.3); border-radius:12px; margin-bottom:12px; cursor:pointer; transition:all 0.2s;">
                <div style="display:flex; align-items:center; gap:12px;">
                    <div
                        style="width:40px; height:40px; background:rgba(45,212,191,0.2); border-radius:50%; display:flex; align-items:center; justify-content:center;">
                        <i class="fas fa-wind" style="color:#2dd4bf; font-size:1.1rem;"></i>
                        <!-- Forced Teal for Breathing -->
                    </div>
                    <div style="flex:1;">
                        <h4 style="margin:0; font-size:1rem; color:#2dd4bf;">Breathing</h4>
                        <p style="margin:3px 0 0 0; font-size:0.75rem; opacity:0.7;">Calm your mind</p>
                    </div>
                    <i class="fas fa-external-link-alt" style="opacity:0.5; font-size:0.9rem;"></i>
                </div>
            </div>

            <!-- Reset Tool -->
            <div onclick="window.open('../tools/5-step-reset.html', '_blank')" class="tool-item"
                style="padding:15px; background:rgba(255,255,255,0.05); border:1px solid var(--border-subtle); border-radius:12px; margin-bottom:12px; cursor:pointer; transition:all 0.2s;">
                <div style="display:flex; align-items:center; gap:12px;">
                    <div
                        style="width:40px; height:40px; background:rgba(255,255,255,0.1); border-radius:50%; display:flex; align-items:center; justify-content:center;">
                        <i class="fas fa-redo-alt" style="color:var(--text-main); font-size:1.1rem;"></i>
                    </div>
                    <div style="flex:1;">
                        <h4 style="margin:0; font-size:1rem;">Reset</h4>
                        <p style="margin:3px 0 0 0; font-size:0.75rem; opacity:0.7;">Start fresh</p>
                    </div>
                    <i class="fas fa-external-link-alt" style="opacity:0.5; font-size:0.9rem;"></i>
                </div>
            </div>
        </div>
    </div>

    <script>
        function toggleToolsMenu() {
            const menu = document.getElementById('tools-menu');
            const fab = document.getElementById('tools-fab');
            if (menu.style.right === '0px') {
                menu.style.right = '-350px';
                fab.style.transform = 'rotate(0deg)';
            } else {
                menu.style.right = '0px';
                fab.style.transform = 'rotate(180deg)';
            }
        }

        // --- THEME MODE LOGIC ---
        function setThemeMode(mode) {
            const body = document.body;
            const btnDark = document.getElementById('btn-mode-dark');
            const btnLight = document.getElementById('btn-mode-light');

            if (mode === 'light') {
                body.classList.add('light-mode');
                if (btnDark) btnDark.classList.remove('active');
                if (btnLight) btnLight.classList.add('active');
                localStorage.setItem('soul_theme_mode', 'light');
            } else {
                body.classList.remove('light-mode');
                if (btnLight) btnLight.classList.remove('active');
                if (btnDark) btnDark.classList.add('active');
                localStorage.setItem('soul_theme_mode', 'dark');
            }
        }
    </script>

    <!-- AUTH HYDRATION & THEME PERSISTENCE -->
    <script type="module">
        import { onAuthChange } from "../assets/js/auth-service.js";
        import { getUserProfile } from "../assets/js/profile-handler.js";

        document.addEventListener('DOMContentLoaded', () => {
            // 1. Theme Hydration (Cross-Dashboard)
            const savedMode = localStorage.getItem('soul_theme_mode');
            if (savedMode === 'light') {
                document.body.classList.add('light-mode');
                // Inject light variables dynamically if not present in CSS
                document.documentElement.style.setProperty('--bg-deep', '#f1f5f9');
                document.documentElement.style.setProperty('--bg-card', '#ffffff');
                document.documentElement.style.setProperty('--bg-sidebar', '#ffffff');
                document.documentElement.style.setProperty('--text-main', '#0f172a');
                document.documentElement.style.setProperty('--text-muted', '#64748b');
            }

            // 2. Auth
            onAuthChange(async (user) => {
                if (user) {
                    let profile = await getUserProfile(user.uid);
                    if (profile) {
                        const name = profile.displayName || user.displayName || 'Peer';
                        const sbName = document.getElementById('sidebar-name');
                        if (sbName) sbName.innerText = name;
                    }
                }
            });
        });
    </script>
    <!-- PHOTO UPLOAD MODAL -->
    <div id="photo-upload-modal"
        style="display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(15, 23, 42, 0.8); backdrop-filter:blur(8px); z-index:2000; align-items:center; justify-content:center;">
        <div class="dash-card"
            style="max-width:550px; width:90%; animation: slideUp 0.3s ease; border:1px solid var(--border-subtle);">

            <div style="text-align:center; margin-bottom:30px;">
                <h2 style="font-family:'Outfit'; margin-bottom:15px; color:var(--text-main);">Profile Photo</h2>
                <div
                    style="font-size:0.95rem; line-height:1.6; color:var(--text-muted); font-style:italic; border-left:3px solid var(--teal-accent); padding-left:20px; text-align:left; margin:0 auto; max-width:400px; padding:20px; background:rgba(255,255,255,0.02); border-radius:0 12px 12px 0;">
                    <p style="margin-bottom:10px;">Choose a photo where your face is visible and you feel like yourself.
                    </p>
                    <p style="margin-bottom:10px;">Natural light is enough.<br>A simple background is enough.<br>A quiet
                        smile, or even a calm, neutral expression, is enough.</p>
                    <p style="margin-bottom:10px;">This photo isn’t about looking perfect.<br>It’s about letting someone
                        see the person behind the name.</p>
                    <p style="margin-bottom:10px;">You don’t need filters or polished poses.<br>Just a clear moment
                        where you feel present.</p>
                    <p style="margin-bottom:0;">Take your time.<br>Upload something that feels honest and comfortable to
                        you.</p>
                </div>
            </div>

            <!-- Drag & Drop Zone -->
            <div id="drop-zone" onclick="document.getElementById('file-input').click()" ondrop="handleDrop(event)"
                ondragover="event.preventDefault()"
                style="border:2px dashed var(--border-subtle); border-radius:12px; padding:40px; text-align:center; cursor:pointer; transition:all 0.2s; background:rgba(255,255,255,0.01);">

                <input type="file" id="file-input" hidden accept="image/*" onchange="handleFileSelect(this)">

                <div style="font-size:3rem; color:var(--teal-accent); margin-bottom:15px; opacity:0.8;">
                    <i class="fas fa-cloud-upload-alt"></i>
                </div>
                <h4 style="margin-bottom:5px; font-family:'Outfit';">Click or Drag & Drop</h4>
                <p style="font-size:0.9rem; opacity:0.5;">Supports JPG, PNG (Max 5MB)</p>
            </div>

            <div style="margin-top:25px; text-align:right;">
                <button class="btn-dash-secondary" onclick="togglePhotoModal(false)"
                    style="margin-right:10px;">Cancel</button>
            </div>
        </div>
    </div>

    <!-- SCRIPTS -->
    <script>
        function togglePhotoModal(show) {
            const modal = document.getElementById('photo-upload-modal');
            modal.style.display = show ? 'flex' : 'none';
        }

        function handleFileSelect(input) {
            if (input.files && input.files[0]) {
                updateProfileImage(input.files[0]);
            }
        }

        function handleDrop(e) {
            e.preventDefault();
            if (e.dataTransfer.files && e.dataTransfer.files[0]) {
                updateProfileImage(e.dataTransfer.files[0]);
            }
        }

        function updateProfileImage(file) {
            // In a real app, upload to server here.
            // For prototype, we will just read the file and show it.
            const reader = new FileReader();
            reader.onload = function (e) {
                // Find all avatar instances and update them
                const avatars = document.querySelectorAll('.profile-avatar-img');
                avatars.forEach(img => {
                    img.src = e.target.result;
                    img.style.display = 'block'; // Ensure image is visible
                });

                // Hide any initial text avatars if replacing
                const textAvatars = document.querySelectorAll('.profile-avatar-text');
                textAvatars.forEach(el => el.style.display = 'none');

                togglePhotoModal(false);
            }
            reader.readAsDataURL(file);
        }
    </script>

    <!-- DYNAMIC DASHBOARD LOGIC -->
    <script type="module">
        import { db, auth } from "../assets/js/firebase-config.js";
        import { doc, getDoc, onSnapshot } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";
        import { onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";

        onAuthStateChanged(auth, async (user) => {
            if (user) {
                initDashboard(user.uid);
            }
        });

        async function initDashboard(uid) {
            // Fetch Professional Profile (for Reviews & Role)
            const profRef = doc(db, "professionals", uid);
            onSnapshot(profRef, (docSnap) => {
                if (docSnap.exists()) {
                    const data = docSnap.data();
                    updateProfileUI(data);
                    renderDashboardReviews(data.reviews || []);
                }
            });

            // Fetch User Profile (for Saved Items)
            const userRef = doc(db, "users", uid);
            onSnapshot(userRef, (docSnap) => {
                if (docSnap.exists()) {
                    const userData = docSnap.data();
                    updateUserStats(userData);
                }
            });
        }

        function updateProfileUI(data) {
            const nameEl = document.getElementById('sidebar-name');
            const roleEl = document.getElementById('sidebar-role');
            if (nameEl) nameEl.innerText = data.name || "Peer Portal";
            if (roleEl) roleEl.innerText = data.role || "Verified Peer";
        }

        function updateUserStats(userData) {
            // Updates stats based on User collection data (e.g. saves)
            const savedCount = userData.savedProfiles ? userData.savedProfiles.length : 0;
            const linkHoverCards = document.querySelectorAll('.link-hover');
            // Assuming the 3rd card is "Saves" based on order
            if (linkHoverCards.length >= 3) {
                const savesCard = linkHoverCards[2];
                const countDiv = savesCard.querySelector('div[style*="font-size:2rem"]');
                if (countDiv) countDiv.innerText = savedCount;

                const labelDiv = savesCard.querySelector('div[style*="font-size:0.8rem"]');
                if (labelDiv) labelDiv.innerText = "Saved Profiles";
            }
        }

        function renderDashboardReviews(reviews) {
            const container = document.querySelector('#view-testimonials .dashboard-grid');
            if (!container) return;

            if (reviews.length === 0) {
                container.innerHTML = `
                    <div class="dash-card" style="grid-column:1/-1; text-align:center; padding:50px;">
                        <i class="fas fa-comment-slash" style="font-size:3rem; opacity:0.2; margin-bottom:20px;"></i>
                        <p>No testimonials yet.</p>
                        <p style="font-size:0.85rem; opacity:0.6;">Reviews from users will appear here.</p>
                    </div>
                 `;
                return;
            }

            const sortedReviews = [...reviews].reverse();

            container.innerHTML = sortedReviews.map((r) => `
                 <div class="dash-card testimonial-card fade-in" style="position:relative; transition:all 0.3s ease;">
                        <i class="fas fa-quote-right"
                            style="position:absolute; top:20px; right:20px; font-size:4rem; color:rgba(255,255,255,0.03); z-index:0;"></i>
                        <div style="position:relative; z-index:1;">
                            <div style="display:flex; justify-content:space-between; margin-bottom:15px; align-items:flex-start;">
                                <div style="display:flex; gap:12px; align-items:center;">
                                    <div class="review-avatar"
                                        style="width:45px; height:45px; background:var(--bg-deep); border:1px solid var(--border-subtle); border-radius:50%; display:flex; align-items:center; justify-content:center; color:var(--text-muted); font-size:0.9rem; font-weight:600; text-transform:uppercase;">
                                        ${r.author ? r.author.substring(0, 2) : "AN"}
                                    </div>
                                    <div>
                                        <div class="review-author"
                                            style="font-weight:700; font-size:1rem; color:var(--text-main);">${r.author || "Anonymous"}
                                        </div>
                                        <div class="review-date" style="font-size:0.8rem; opacity:0.6;">${r.date || "Recent"}</div>
                                    </div>
                                </div>
                                <div class="review-rating"
                                    style="background:rgba(251, 191, 36, 0.1); padding:5px 10px; border-radius:20px; border:1px solid rgba(251, 191, 36, 0.2);">
                                    <div style="color:#fbbf24; font-size:0.85rem; display:flex; gap:2px;">
                                        <i class="fas fa-star"></i><i class="fas fa-star"></i><i class="fas fa-star"></i><i class="fas fa-star"></i><i class="fas fa-star"></i>
                                    </div>
                                </div>
                            </div>
                            <div style="padding:15px; background:rgba(255,255,255,0.02); border-radius:12px; border:1px solid rgba(255,255,255,0.03);">
                                <p class="review-text" style="font-size:0.95rem; line-height:1.7; opacity:0.95; margin:0; font-style:italic;">
                                    "${r.text}"
                                </p>
                            </div>
                        </div>
                    </div>
            `).join('');
        }
    </script>
</body>

</html>
```