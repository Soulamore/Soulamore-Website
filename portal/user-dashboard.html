<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <!-- AUTH GUARD: Protects this page -->
    <script src="../assets/js/auth-guard.js"></script>
    <script>
        /* --- TOOL MODAL LOGIC (Global) --- */
        function openTool(url, title) {
            const modal = document.getElementById('toolModal');
            const frame = document.getElementById('toolFrame');
            const titleEl = document.getElementById('modalTitle');

            if (modal && frame && titleEl) {
                frame.src = url;
                titleEl.textContent = title || 'Tool';
                modal.classList.add('active');
            } else {
                window.open(url, '_blank'); // Fallback
            }
        }

        function closeTool() {
            const modal = document.getElementById('toolModal');
            const frame = document.getElementById('toolFrame');

            if (modal) modal.classList.remove('active');
            if (frame) frame.src = '';
        }
    </script>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>My Space | Soulamore</title>
    <link
        href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;600;700&family=Plus+Jakarta+Sans:wght@300;400;500;600&display=swap"
        rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="../assets/css/global.css">
    <link rel="stylesheet" href="../assets/css/dashboard-sidebar.css">
    <!-- Removed dashboard-shell.css to prevent layout conflicts -->
    <link rel="stylesheet" href="../assets/css/dashboard-themes.css">
    <link rel="icon" href="../assets/images/favicon_symbol.png" type="image/x-icon">
    <!-- FORCE COLOR OVERRIDE: Resolve Black Screen Issue -->
    <style>
        /* COLOR FIXES (Dark Mode Only) */
        :root:not(.light-mode) {
            --bg-deep: #131B2E !important;
            --bg-sidebar: #131B2E !important;
        }

        body:not(.light-mode),
        body:not(.light-mode) .dashboard-layout,
        body:not(.light-mode) .sidebar {
            background-color: #131B2E !important;
            background: #131B2E !important;
        }

        .main-content {
            margin-left: 280px !important;
            /* Matches --sidebar-width */
            width: auto !important;

            /* VERTICAL ALIGNMENT FIX */
            padding-top: 110px !important;
            /* Top Boundary (Sidebar Header) */
            padding-bottom: 90px !important;
            /* Bottom Boundary (Sidebar Footer) */
            padding-left: 40px !important;
            padding-right: 40px !important;

            /* ABSOLUTE LAYOUT CONTAINER */
            position: relative !important;
            height: 100vh !important;
            overflow: hidden !important;
            /* Clip anything outside */
            display: block !important;
            /* Block model for absolute children */

            box-sizing: border-box !important;
            max-width: none !important;
        }

        /* TOOL MODAL STYLES (HARDENED) */
        .tool-modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            background-color: #000000;
            opacity: 0.8;
            z-index: 99999;
            display: none;
            align-items: center;
            justify-content: center;
        }

        .tool-modal-overlay.active {
            display: flex !important;
        }

        .tool-modal-content {
            width: 90%;
            max-width: 1000px;
            height: 85vh;
            background-color: #1e293b !important;
            border-radius: 16px;
            overflow: hidden;
            display: flex;
            flex-direction: column;
            border: 1px solid rgba(255, 255, 255, 0.1);
            box-shadow: 0 50px 100px -20px rgba(0, 0, 0, 0.7);
            position: relative;
            z-index: 100000;
        }

        .tool-modal-header {
            padding: 15px 20px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: #0f172a;
        }

        .tool-modal-title {
            font-family: var(--font-head);
            font-size: 1.2rem;
            color: var(--text-main);
        }

        .tool-close-btn {
            background: transparent;
            border: none;
            color: var(--text-muted);
            font-size: 1.2rem;
            cursor: pointer;
            transition: 0.2s;
        }

        .tool-close-btn:hover {
            color: var(--text-main);
            transform: rotate(90deg);
        }

        .tool-frame {
            flex: 1;
            border: none;
            width: 100%;
            height: 100%;
            background: var(--bg-deep);
        }

        @keyframes pulse-glow {
            0% {
                box-shadow: 0 0 20px rgba(45, 212, 191, 0.4);
            }

            50% {
                box-shadow: 0 0 35px rgba(45, 212, 191, 0.8), 0 0 10px rgba(45, 212, 191, 0.5);
            }

            100% {
                box-shadow: 0 0 20px rgba(45, 212, 191, 0.4);
            }
        }

        /* VIEW SECTION: Relative Flow */
        .view-section {
            position: relative;
            display: none;
            flex-direction: column;
            width: 100%;
            margin: 0 auto;
            padding: 40px;
            pointer-events: none;
            /* FIX 4: Prevent phantom clicks */
            border: none;
            background: transparent;
        }

        /* CONTAINMENT FIX */
        .main-content {
            margin-left: 280px !important;
            /* FIX 2 */
            width: calc(100% - 280px) !important;
            /* FIX 2 */
            position: relative;
            z-index: 1;
            /* FIX 2 */
            min-height: 100vh;
            height: auto !important;
            overflow-y: auto !important;
        }

        /* ACTIVE VIEW */
        .view-section.active {
            display: flex;
            z-index: 10;
            pointer-events: auto;
            /* FIX 4 */
        }

        /* SCROLL FIX */
        body {
            overflow: hidden !important;
            /* Keep body fixed, main scrolls */
        }
    </style>
</head>

<body>
    <!-- TOOL FRAME MODAL (Existing) -->
    <div id="toolModal" class="tool-modal-overlay">
        <div class="tool-modal-content">
            <div class="tool-modal-header">
                <div class="tool-modal-title" id="modalTitle">Tool Name</div><button class="tool-close-btn"
                    onclick="closeTool()"><i class="fas fa-times"></i></button>
            </div><iframe id="toolFrame" class="tool-frame" src=""></iframe>
        </div>
    </div>
    <!-- QUICK TOOLS MODAL (New 2x2 Grid) -->
    <div id="quickToolsModal" class="tool-modal-overlay" onclick="closeToolsModal(event)">
        <div class="tool-modal-content" style="max-width: 500px; height: auto; min-height: auto; padding-bottom: 30px;"
            onclick="event.stopPropagation()">
            <div class="tool-modal-header">
                <div class="tool-modal-title">Quick Relief</div><button class="tool-close-btn"
                    onclick="closeToolsModal()"><i class="fas fa-times"></i></button>
            </div>
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; padding: 20px;">
                <!-- Vent Box -->
                <div class="dash-card link-hover" onclick="window.location.href='../tools/vent-box.html'"
                    style="margin:0; text-align:center; padding:25px; cursor:pointer; background:rgba(239, 68, 68, 0.1); border-color:rgba(239, 68, 68, 0.2);">
                    <i class="fas fa-fire" style="font-size:2rem; color:#ef4444; margin-bottom:10px;"></i>
                    <div style="font-weight:700;">Vent Box</div>
                </div>
                <!-- Confessing -->
                <div class="dash-card link-hover" onclick="window.location.href='../tools/confession-box/index.html'"
                    style="margin:0; text-align:center; padding:25px; cursor:pointer; background:rgba(255, 255, 255, 0.05);">
                    <i class="fas fa-ghost" style="font-size:2rem; color:#e2e8f0; margin-bottom:10px;"></i>
                    <div style="font-weight:700;">Confessing</div>
                </div>
                <!-- Drop It -->
                <div class="dash-card link-hover" onclick="window.location.href='../tools/drop-it.html'"
                    style="margin:0; text-align:center; padding:25px; cursor:pointer; background:rgba(56, 189, 248, 0.1); border-color:rgba(56, 189, 248, 0.2);">
                    <i class="fas fa-hand-holding-water" style="font-size:2rem; color:#38bdf8; margin-bottom:10px;"></i>
                    <div style="font-weight:700;">Drop It</div>
                </div>
                <!-- Play -->
                <div class="dash-card link-hover" onclick="window.location.href='../tools/playground.html'"
                    style="margin:0; text-align:center; padding:25px; cursor:pointer; background:rgba(250, 176, 5, 0.1); border-color:rgba(250, 176, 5, 0.2);">
                    <i class="fas fa-shapes" style="font-size:2rem; color:#fab005; margin-bottom:10px;"></i>
                    <div style="font-weight:700;">Play</div>
                </div>
            </div>
        </div>
    </div>
    <!-- MOBILE TOGGLE --><button class="mobile-toggle" onclick="toggleSidebar()"><i class="fas fa-bars"></i></button>

    <!-- SoulBot FAB -->
    <button onclick="openTool('../tools/soulbot-chat.html', 'SoulBot AI Support')"
        style="position:fixed; bottom:30px; right:30px; width:56px; height:56px; border-radius:50%; background:#2dd4bf; border:none; cursor:pointer; box-shadow:0 0 25px #2dd4bf, 0 0 45px rgba(45, 212, 191, 0.6); display:flex; align-items:center; justify-content:center; z-index:900; transition:all 0.3s ease; animation: pulse-glow 2s infinite;">
        <i class="fas fa-robot" style="font-size:1.4rem; color:#0f172a;"></i>
    </button>
    <div class="dashboard-layout">
        <!-- SIDEBAR -->
        <nav class="sidebar" id="sidebar">
            <div class="sidebar-header">
                <div class="user-avatar-lg"><i class="fas fa-user-astronaut"></i></div>
                <div class="user-info-text">
                    <div class="name" id="sidebar-name">Loading...</div>
                    <div class="role" id="sidebar-role">Member</div>
                </div>
            </div>
            <div class="sidebar-nav"><a href="#" class="side-link active" onclick="switchView('home', this)"
                    data-view="home"><i class="fas fa-home"></i><span>Home</span></a><a href="#" class="side-link"
                    onclick="switchView('journal', this)" data-view="journal"><i class="fas fa-book"></i><span>My
                        Journal</span></a><a href="#" class="side-link" onclick="switchView('bookings', this)"
                    data-view="bookings"><i class="fas fa-calendar-alt"></i><span>My Sessions</span></a><a href="#"
                    class="side-link" onclick="switchView('peer-guidelines', this)" data-view="peer-guidelines"><i
                        class="fas fa-hands-helping"></i><span>Peer Guidelines</span></a><a href="#" class="side-link"
                    onclick="switchView('soulbot', this)" data-view="soulbot"><i class="fas fa-robot"></i><span>SoulBot
                        AI</span></a><a href="#" onclick="switchView('messages', this)" data-view="messages"
                    class="side-link"><i class="fas fa-envelope"></i><span>Messages</span></a><a href="#"
                    onclick="switchView('saved', this)" class="side-link"><i
                        class="fas fa-bookmark"></i><span>Saved</span></a><a href="#" class="side-link"
                    onclick="switchView('wallet', this)" data-view="wallet"><i class="fas fa-wallet"></i><span>My
                        Wallet</span></a>
                <hr style="border:0; border-top:1px solid rgba(255,255,255,0.05); margin:10px 0;"><a href="#"
                    class="side-link" onclick="switchView('profile', this)" data-view="profile"><i
                        class="fas fa-user-circle"></i><span>My Profile</span></a><a href="#" class="side-link"
                    onclick="switchView('settings', this)" data-view="settings"><i
                        class="fas fa-cog"></i><span>Settings</span></a>
            </div>
            <div class="sidebar-footer"><button class="logout-btn" onclick="handleLogout()"><i
                        class="fas fa-sign-out-alt"></i>Log Out</button></div>
        </nav>
        <!-- MAIN CONTENT -->
        <main class="main-content">
            <!-- VIEW: SETTINGS (Appearance & Preferences) -->
            <!-- VIEW: SETTINGS (Appearance & Preferences) -->
            <div id="view-settings" class="view-section no-scroll" style="display:none;">
                <!-- Standardized Header -->
                <div class="workspace-header">
                    <div
                        style="width:40px; height:40px; background:rgba(255,255,255,0.05); border-radius:50%; display:flex; align-items:center; justify-content:center; color:var(--text-main);">
                        <i class="fas fa-cog"></i>
                    </div>
                    <div>
                        <h2 style="font-family:'Outfit'; font-weight:700; font-size:1.1rem; margin:0;">Settings</h2>
                        <div style="font-size:0.8rem; opacity:0.7;">Customize your space</div>
                    </div>
                </div>
                <!-- Scrollable Content -->
                <div style="flex:1; overflow-y:auto; padding-right:10px;">
                    <div style="padding:20px;">
                        <div class="dashboard-grid" style="grid-template-columns: 1fr;">
                            <!-- APPEARANCE CARD -->
                            <div class="dash-card">
                                <h3 style="margin-bottom:20px;">Appearance & Atmosphere</h3>
                                <!-- Mode (Light/Dark) -->
                                <div style="margin-bottom:30px;"><label
                                        style="display:block; margin-bottom:15px; font-weight:600; opacity:0.9;">Lighting
                                        Mode</label>
                                    <div style="display:flex; gap:15px;"><button onclick="setThemeMode('dark')"
                                            class="theme-btn active" id="btn-mode-dark"><i class="fas fa-moon"></i>Dark
                                        </button><button onclick="setThemeMode('light')" class="theme-btn"
                                            id="btn-mode-light"><i class="fas fa-sun"></i>Light </button></div>
                                </div>
                                <style>
                                    .theme-btn:hover {
                                        transform: translateY(-2px);
                                        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
                                    }
                                </style>
                                <!-- Emotional Theme (HIDDEN FOR NOW) -->
                                <div style="margin-bottom:30px; display:none;"><label
                                        style="display:block; margin-bottom:15px; font-weight:600; opacity:0.9;">Emotional
                                        Theme</label>
                                    <div style="display:flex; flex-wrap:wrap; gap:10px;"><button
                                            onclick="setEmotionalTheme('calm')" class="theme-tag active"
                                            id="btn-theme-calm">üåä
                                            Calm
                                            (Default)</button><button onclick="setEmotionalTheme('library-fog')"
                                            class="theme-tag" id="btn-theme-library-fog">üå´ Library fog</button><button
                                            onclick="setEmotionalTheme('earth-weight')" class="theme-tag"
                                            id="btn-theme-earth-weight">üå±
                                            Earth weight</button><button onclick="setEmotionalTheme('evening-lamp')"
                                            class="theme-tag" id="btn-theme-evening-lamp">‚òÄÔ∏è Evening
                                            lamp</button><button onclick="setEmotionalTheme('desk-light')"
                                            class="theme-tag" id="btn-theme-desk-light">üéØ Desk light</button></div>
                                    <p style="font-size:0.85rem; opacity:0.6; margin-top:15px;">*
                                        Calm: Night, quiet, safe | Library fog: UI disappears |
                                        Earth weight: Physical stability | Evening lamp: Human presence | Desk light:
                                        Mental
                                        clarity
                                    </p>
                                </div>
                            </div>
                            <!-- Profile Card Content -->
                            <div class="dash-card">
                                <h3 style="margin-bottom:20px;">Personal Information</h3>
                                <!-- Personal Details -->
                                <div
                                    style="display:grid; grid-template-columns: 1fr 1fr; gap:20px; margin-bottom:20px;">
                                    <div><label
                                            style="display:block; font-size:0.85rem; opacity:0.7; margin-bottom:8px;">Full
                                            Name</label><input type="text" id="profile-name" value="Loading..."
                                            style="width:100%; padding:12px; background:var(--bg-primary); border:1px solid var(--border-soft); border-radius:10px; color:var(--text-primary); outline:none;">
                                    </div>
                                    <div><label
                                            style="display:block; font-size:0.85rem; opacity:0.7; margin-bottom:8px;">Phone
                                            Number</label><input type="tel" id="profile-phone" value=""
                                            placeholder="Add phone number"
                                            style="width:100%; padding:12px; background:var(--bg-primary); border:1px solid var(--border-soft); border-radius:10px; color:var(--text-primary); outline:none;">
                                    </div>
                                </div>
                                <!-- Login Info (Read Only) -->
                                <div style="margin-bottom:25px;"><label
                                        style="display:block; font-size:0.85rem; opacity:0.7; margin-bottom:8px;">Login
                                        Method</label>
                                    <div
                                        style="display:flex; align-items:center; gap:10px; padding:12px; background:rgba(255,255,255,0.03); border:1px solid var(--border-soft); border-radius:10px;">
                                        <i class="fab fa-google" style="color:var(--text-secondary);"></i><span
                                            id="profile-email"
                                            style="flex:1; color:var(--text-secondary); opacity:0.8;">loading...</span><span
                                            id="profile-verified" class="verified-badge">Verified</span>
                                    </div>
                                </div>
                                <!-- Actions -->
                                <div
                                    style="display:flex; gap:15px; border-top:1px solid var(--border-soft); padding-top:20px;">
                                    <button class="btn-dash-primary" style="padding:10px 25px; font-size:0.95rem;">Save
                                        Changes</button><button class="btn-dash-secondary"
                                        onclick="alert('Password reset link sent to email.')">Change
                                        Password</button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <!-- VIEW: PROFILE -->
            <div id="view-profile" class="view-section no-scroll" style="display:none;">
                <!-- Standardized Header -->
                <div class="workspace-header">
                    <div
                        style="width:40px; height:40px; background:rgba(255,255,255,0.05); border-radius:50%; display:flex; align-items:center; justify-content:center; color:var(--text-main);">
                        <i class="fas fa-user-circle"></i>
                    </div>
                    <div>
                        <h2 style="font-family:'Outfit'; font-weight:700; font-size:1.1rem; margin:0;">My Profile
                        </h2>
                        <div style="font-size:0.8rem; opacity:0.7;">Manage your personal details</div>
                    </div>
                </div>
                <div style="flex:1; overflow-y:auto; padding-right:10px;">
                    <div class="dash-card" style="margin-bottom:20px;">
                        <h3 style="margin-bottom:20px;">Personal Information</h3>
                        <div style="display:grid; grid-template-columns: 1fr 1fr; gap:20px; margin-bottom:20px;">
                            <div><label style="display:block; font-size:0.85rem; opacity:0.7; margin-bottom:8px;">Full
                                    Name</label><input type="text" id="profile-name2" value="Loading..."
                                    style="width:100%; padding:12px; background:rgba(0,0,0,0.3); border:1px solid var(--border-subtle); border-radius:10px; color:var(--text-main); outline:none;">
                            </div>
                            <div><label style="display:block; font-size:0.85rem; opacity:0.7; margin-bottom:8px;">Phone
                                    Number</label><input type="tel" id="profile-phone2" placeholder="Add phone"
                                    style="width:100%; padding:12px; background:rgba(0,0,0,0.3); border:1px solid var(--border-subtle); border-radius:10px; color:var(--text-main); outline:none;">
                            </div>
                        </div>
                        <div style="margin-bottom:20px;"><label
                                style="display:block; font-size:0.85rem; opacity:0.7; margin-bottom:8px;">Email</label>
                            <div
                                style="padding:12px; background:rgba(0,0,0,0.3); border:1px solid var(--border-subtle); border-radius:10px; display:flex; align-items:center; gap:10px;">
                                <i class="fab fa-google" style="color:var(--peach-glow);"></i><span id="profile-email2"
                                    style="flex:1;">loading...</span><span class="verified-badge">Verified</span>
                            </div>
                        </div>
                        <div
                            style="display:flex; gap:10px; padding-top:15px; border-top:1px solid var(--border-subtle);">
                            <button class="btn-dash-primary">Save Changes</button>
                            <button class="btn-dash-secondary">Change Password</button>
                        </div>
                    </div>
                    <div class="dash-card" style="margin-bottom:20px;">
                        <h3 style="margin-bottom:15px; display:flex; align-items:center; gap:10px;"><i
                                class="fas fa-ghost" style="color:#8b5cf6;"></i>My Confessions</h3>
                        <div style="text-align:center; padding:40px; opacity:0.5;">
                            <i class="fas fa-ghost" style="font-size:2.5rem; margin-bottom:15px; display:block;"></i>
                            <p style="margin:0;">No confessions yet</p>
                        </div>
                    </div>
                    <div class="dash-card" style="margin-bottom:20px;">
                        <h3 style="margin-bottom:15px; display:flex; align-items:center; gap:10px;"><i
                                class="fas fa-bookmark" style="color:var(--teal-accent);"></i>Saved Content</h3>
                        <div style="text-align:center; padding:40px; opacity:0.5;">
                            <i class="fas fa-bookmark" style="font-size:2.5rem; margin-bottom:15px; display:block;"></i>
                            <p style="margin:0;">No saved items yet</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- VIEW: SOULBOT CHAT -->
            <div id="view-soulbot" class="view-section no-scroll" style="display:none;">
                <!-- Standardized Header -->
                <div class="workspace-header">
                    <div
                        style="width:40px; height:40px; background:rgba(255,255,255,0.05); border-radius:50%; display:flex; align-items:center; justify-content:center; color:var(--text-main);">
                        <i class="fas fa-robot"></i>
                    </div>
                    <div>
                        <h2 style="font-family:'Outfit'; font-weight:700; font-size:1.1rem; margin:0;">SoulBot AI
                        </h2>
                        <div style="font-size:0.8rem; opacity:0.7;">Your 24/7 empathetic companion</div>
                    </div>
                </div>
                <div class="soulbot-layout"
                    style="display:grid; grid-template-columns: 1fr 300px; gap:20px; flex:1; min-height:0; padding-bottom:20px;">
                    <!-- CHAT AREA -->
                    <div class="dash-card link-hover"
                        style="display:flex; flex-direction:column; padding:0; overflow:hidden;">
                        <!-- Header -->
                        <div
                            style="padding:20px; border-bottom:1px solid rgba(255,255,255,0.05); display:flex; justify-content:space-between; align-items:center; background:rgba(0,0,0,0.2);">
                            <div style="display:flex; gap:15px; align-items:center;">
                                <div
                                    style="width:40px; height:40px; background:var(--teal-glow); border-radius:50%; display:flex; align-items:center; justify-content:center; color:#0f172a; font-size:1.2rem;">
                                    <i class="fas fa-robot"></i>
                                </div>
                                <div>
                                    <div style="font-family:'Outfit'; font-weight:700; font-size:1.1rem;">
                                        SoulBot AI </div>
                                    <div
                                        style="font-size:0.8rem; opacity:0.7; color:#22c55e; display:flex; align-items:center; gap:6px;">
                                        <i class="fas fa-circle" style="font-size:0.5rem;"></i>
                                        <span>Online & Ready to Listen</span>
                                    </div>
                                </div>
                            </div><button onclick="clearChat()"
                                style="background:transparent; border:1px solid rgba(255,255,255,0.1); color:white; padding:5px 15px; border-radius:20px; font-size:0.8rem; cursor:pointer; opacity:0.7;"><i
                                    class="fas fa-trash-alt"></i>Clear Chat </button>
                        </div>
                        <!-- Messages -->
                        <div id="soulbot-messages"
                            style="flex:1; padding:20px; overflow-y:auto; display:flex; flex-direction:column; gap:15px;">
                            <!-- Welcome Msg -->
                            <div class="chat-bubble bot">Hi there. I'm SoulBot. I' m
                                not a therapist,
                                but I'm here to listen without judgment.
                                What's on your mind today?
                            </div>
                        </div>
                        <!-- Input -->
                        <div
                            style="padding:20px; background:rgba(0,0,0,0.2); border-top:1px solid rgba(255,255,255,0.05); display:flex; gap:10px;">
                            <input type="text" id="soulbot-input" placeholder="Type your message..."
                                style="flex:1; background:rgba(255,255,255,0.05); border:1px solid rgba(255,255,255,0.1); padding:12px 15px; border-radius:12px; color:white; outline:none;"><button
                                onclick="sendMessage()"
                                style="background:var(--teal-glow); color:#0f172a; border:none; width:45px; height:45px; border-radius:12px; font-size:1.1rem; cursor:pointer;"><i
                                    class="fas fa-paper-plane"></i></button>
                        </div>
                    </div>
                    <!-- HISTORY SIDEBAR -->
                    <div style="display:flex; flex-direction:column; gap:20px;">
                        <div class="dash-card" style="flex:1; display:flex; flex-direction:column;">
                            <h3 style="margin-bottom:15px; font-size:1.1rem;">Past
                                Conversations</h3>
                            <div style="flex:1; overflow-y:auto; display:flex; flex-direction:column; gap:10px;">
                                <div
                                    style="padding:10px; background:rgba(255,255,255,0.05); border-radius:8px; cursor:pointer; border-left:2px solid var(--teal-glow);">
                                    <div style="font-size:0.9rem; font-weight:600;">Anxiety
                                        about exams</div>
                                    <div style="font-size:0.8rem; opacity:0.6;">Yesterday
                                    </div>
                                </div>
                                <div
                                    style="padding:10px; background:transparent; border:1px solid rgba(255,255,255,0.05); border-radius:8px; cursor:pointer; opacity:0.7;">
                                    <div style="font-size:0.9rem; font-weight:600;">Feeling
                                        lonely</div>
                                    <div style="font-size:0.8rem; opacity:0.6;">3 days ago
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <!-- VIEW: PEER GUIDELINES (User Version) -->
            <div id="view-peer-guidelines" class="view-section" style="display:none; height:100%;">
                <!-- Standardized Header (OUTSIDE CARD) -->
                <div
                    style="padding:20px 0; border-bottom:1px solid rgba(255,255,255,0.05); display:flex; align-items:center; gap:15px; margin-bottom:20px; text-align:left; flex-shrink: 0;">
                    <div
                        style="width:40px; height:40px; background:rgba(255,255,255,0.05); border-radius:50%; display:flex; align-items:center; justify-content:center; color:var(--text-main);">
                        <i class="fas fa-hands-helping"></i>
                    </div>
                    <div>
                        <h2 style="font-family:'Outfit'; font-weight:700; font-size:1.1rem; margin:0;">Peer
                            Support
                            Guidelines</h2>
                        <div style="font-size:0.8rem; opacity:0.7;">How to connect and support safely</div>
                    </div>
                </div>

                <!-- Engagement Dashboard Section -->
                <div
                    style="padding:0 20px 20px; display:grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap:15px;">
                    <!-- Quick Stats -->
                    <div class="dash-card" style="padding:20px; text-align:center;">
                        <i class="fas fa-chart-line"
                            style="font-size:1.8rem; color:var(--teal-accent); margin-bottom:10px;"></i>
                        <h3 style="font-size:2rem; margin:5px 0; color:var(--text-main);">0</h3>
                        <p style="font-size:0.85rem; opacity:0.7; margin:0;">Peer Sessions</p>
                    </div>

                    <!-- Mood Tracker Widget -->
                    <div class="dash-card" style="padding:20px;">
                        <div style="display:flex; align-items:center; gap:10px; margin-bottom:12px;">
                            <i class="fas fa-smile" style="color:var(--peach-glow); font-size:1.2rem;"></i>
                            <h4 style="margin:0; font-size:0.95rem;">Today's Mood</h4>
                        </div>
                        <div style="display:flex; gap:8px; justify-content:center;">
                            <button
                                style="background:transparent; border:1px solid var(--border-subtle); color:var(--text-main); width:36px; height:36px; border-radius:50%; cursor:pointer; font-size:1.1rem;">üòî</button>
                            <button
                                style="background:transparent; border:1px solid var(--border-subtle); color:var(--text-main); width:36px; height:36px; border-radius:50%; cursor:pointer; font-size:1.1rem;">üòê</button>
                            <button
                                style="background:transparent; border:1px solid var(--border-subtle); color:var(--text-main); width:36px; height:36px; border-radius:50%; cursor:pointer; font-size:1.1rem;">üôÇ</button>
                            <button
                                style="background:transparent; border:1px solid var(--border-subtle); color:var(--text-main); width:36px; height:36px; border-radius:50%; cursor:pointer; font-size:1.1rem;">üòä</button>
                        </div>
                    </div>

                    <!-- Upcoming Session -->
                    <div class="dash-card" style="padding:20px;">
                        <div style="display:flex; align-items:center; gap:10px; margin-bottom:12px;">
                            <i class="fas fa-calendar-check" style="color:var(--teal-accent); font-size:1.2rem;"></i>
                            <h4 style="margin:0; font-size:0.95rem;">Next Session</h4>
                        </div>
                        <p style="opacity:0.5; font-size:0.85rem; margin:0; text-align:center; padding:10px 0;">No
                            upcoming sessions</p>
                    </div>
                </div>

                <!-- Motivational Quote -->
                <div style="padding:0 20px 25px;">
                    <div
                        style="background:rgba(251, 146, 60, 0.05); border-left:3px solid var(--peach-glow); padding:20px; border-radius:0 12px 12px 0;">
                        <p
                            style="font-style:italic; font-size:0.95rem; color:var(--text-main); opacity:0.85; margin:0; line-height:1.6;">
                            "Peer support is about walking alongside someone, not ahead of them."
                        </p>
                    </div>
                </div>

                <!-- Scrollable Content Area -->
                <div style="flex:1; overflow-y:auto; padding-right:10px;">
                    <!-- 1. Confidentiality -->
                    <div
                        style="background:rgba(255, 255, 255, 0.03); border:1px solid var(--border-subtle); border-radius:12px; padding:25px;">
                        <h3
                            style="color:var(--teal-accent); font-family:'Outfit'; margin-bottom:10px; font-size:1.2rem;">
                            Confidentiality</h3>
                        <p style="font-size:0.95rem; opacity:0.8; line-height:1.6;">Respect the privacy of
                            others.
                            Refrain
                            from sharing personal information disclosed during the session with outside parties.
                        </p>
                    </div>

                    <!-- 2. Active Participation -->
                    <div
                        style="background:rgba(255, 255, 255, 0.03); border:1px solid var(--border-subtle); border-radius:12px; padding:25px;">
                        <h3
                            style="color:var(--teal-accent); font-family:'Outfit'; margin-bottom:10px; font-size:1.2rem;">
                            Active Participation</h3>
                        <p style="font-size:0.95rem; opacity:0.8; line-height:1.6;">Engage actively by sharing
                            openly. Take
                            advantage of this safe space to express your emotions.</p>
                    </div>

                    <!-- 3. Respectful Communication -->
                    <div
                        style="background:rgba(255, 255, 255, 0.03); border:1px solid var(--border-subtle); border-radius:12px; padding:25px;">
                        <h3
                            style="color:var(--teal-accent); font-family:'Outfit'; margin-bottom:10px; font-size:1.2rem;">
                            Respectful Communication</h3>
                        <p style="font-size:0.95rem; opacity:0.8; line-height:1.6;">Listen attentively. Validate
                            feelings
                            and offer support without judgment. Practice empathy.</p>
                    </div>

                    <!-- 4. Boundaries -->
                    <div
                        style="background:rgba(255, 255, 255, 0.03); border:1px solid var(--border-subtle); border-radius:12px; padding:25px;">
                        <h3
                            style="color:var(--teal-accent); font-family:'Outfit'; margin-bottom:10px; font-size:1.2rem;">
                            Boundaries</h3>
                        <p style="font-size:0.95rem; opacity:0.8; line-height:1.6;">Respect comfort levels.
                            Avoid
                            pressuring
                            others to share more than they wish. Refrain from unsolicited advice.</p>
                    </div>

                    <!-- 5. Non-Judgmental Attitude -->
                    <div
                        style="background:rgba(255, 255, 255, 0.03); border:1px solid var(--border-subtle); border-radius:12px; padding:25px;">
                        <h3
                            style="color:var(--teal-accent); font-family:'Outfit'; margin-bottom:10px; font-size:1.2rem;">
                            Non-Judgmental</h3>
                        <p style="font-size:0.95rem; opacity:0.8; line-height:1.6;">Recognize that everyone's
                            experiences
                            are valid. Refrain from criticizing or invalidating others.</p>
                    </div>

                    <!-- 6. Mutual Support -->
                    <div
                        style="background:rgba(255, 255, 255, 0.03); border:1px solid var(--border-subtle); border-radius:12px; padding:25px;">
                        <h3
                            style="color:var(--teal-accent); font-family:'Outfit'; margin-bottom:10px; font-size:1.2rem;">
                            Mutual Support</h3>
                        <p style="font-size:0.95rem; opacity:0.8; line-height:1.6;">Offer encouragement and
                            validation. Be
                            receptive to receiving support from others in return.</p>
                    </div>

                    <!-- 7. Self-Care -->
                    <div
                        style="background:rgba(255, 255, 255, 0.03); border:1px solid var(--border-subtle); border-radius:12px; padding:25px;">
                        <h3
                            style="color:var(--teal-accent); font-family:'Outfit'; margin-bottom:10px; font-size:1.2rem;">
                            Self-Care</h3>
                        <p style="font-size:0.95rem; opacity:0.8; line-height:1.6;">Prioritize your well-being.
                            Take
                            breaks
                            if needed. Seek additional support if sessions become challenging.</p>
                    </div>

                    <!-- 8. Respect for Diversity -->
                    <div
                        style="background:rgba(255, 255, 255, 0.03); border:1px solid var(--border-subtle); border-radius:12px; padding:25px;">
                        <h3
                            style="color:var(--teal-accent); font-family:'Outfit'; margin-bottom:10px; font-size:1.2rem;">
                            Respect for Diversity</h3>
                        <p style="font-size:0.95rem; opacity:0.8; line-height:1.6;">Embrace differences. Be
                            respectful of
                            differing perspectives and backgrounds. Create an inclusive environment.</p>
                    </div>



                    <!-- Closing Quote -->
                    <div
                        style="background:rgba(45, 212, 191, 0.05); border-left:4px solid var(--teal-accent); padding:25px; border-radius:0 8px 8px 0; margin-bottom:40px;">
                        <p
                            style="font-style:italic; font-size:1.1rem; color:var(--text-main); line-height:1.8; margin-bottom:15px;">
                            "By following these guidelines, you contribute to a positive environment where everyone
                            feels
                            valued, respected, and empowered. Thank you for supporting your peers on their journey
                            toward
                            healing."
                        </p>
                        <div
                            style="font-weight:700; color:var(--teal-accent); letter-spacing:1px; text-transform:uppercase; font-size:0.9rem;">
                            ‚Äî Team Soulamore
                        </div>
                    </div>

                    <!-- Actions -->
                    <div style="text-align:center; padding-top:20px; border-top:1px solid var(--border-subtle);">
                        <button class="btn-dash-primary" onclick="window.location.href='../our-peers/profile.html'">Book
                            a
                            Session</button>
                    </div>
                </div>
            </div>

            <!-- VIEW: HOME (Default) -->
            <div id="view-home" class="view-section active">
                <!-- Standardized Header -->
                <div class="workspace-header">
                    <div
                        style="width:40px; height:40px; background:rgba(255,255,255,0.05); border-radius:50%; display:flex; align-items:center; justify-content:center; color:var(--text-main);">
                        <i class="fas fa-home"></i>
                    </div>
                    <div>
                        <h2 style="font-family:'Outfit'; font-weight:700; font-size:1.1rem; margin:0;">Home</h2>
                        <div style="font-size:0.8rem; opacity:0.7;">Welcome back. Take a deep breath.</div>
                    </div>
                </div>

                <!-- Scrollable Content -->
                <div style="flex:1; overflow-y:auto; padding-right:10px; padding-bottom: 40px;">
                    <!-- LAYER 1: GROUNDING & PRIMARY ACTION -->
                    <div style="text-align:center; padding:10px 0 20px;">
                        <!-- 1. SOULBOT HERO (Compact) -->
                        <div class="dash-card soulbot-hero"
                            style="background:var(--bg-card); border:1px solid var(--border-subtle); padding:30px 20px !important; text-align:center; margin:0 0 20px 0; min-height:auto;">
                            <i class="fas fa-robot"
                                style="font-size:3rem; color:var(--teal-accent); margin-bottom:15px; filter:drop-shadow(0 0 15px var(--teal-dim));"></i>
                            <h2
                                style="font-family:'Outfit'; font-size:1.5rem; letter-spacing:-0.5px; color:var(--text-main); margin-bottom:8px;">
                                SoulBot is here with you. </h2>
                            <p style="color:var(--text-muted); font-size:0.9rem; margin-bottom:20px; opacity:0.8;">
                                Start where you are. We'll figure out the rest
                                together.
                            </p><button onclick="switchView('soulbot', this)" class="btn-dash-primary"
                                style="padding:12px 30px; font-size:0.95rem; box-shadow:0 0 15px var(--teal-dim);">Continue
                                with SoulBot </button>
                        </div>
                        <!-- 2. YOUR JOURNAL (Compact Strip) -->
                        <div class="dash-card"
                            style="display:flex; justify-content:space-between; align-items:center; padding:20px 30px; margin:0 0 20px 0;">
                            <div style="text-align:left;">
                                <h3 style="font-size:1.1rem; margin-bottom:4px; color:var(--text-main);">
                                    Your Journal</h3>
                                <p style="margin:0; color:var(--text-muted); opacity:0.7; font-size:0.85rem;">
                                    Write or continue your reflection.</p>
                            </div><button onclick="switchView('journal', this)"
                                style="background:transparent; border:1px solid var(--border-subtle); color:var(--text-main); padding:8px 20px; border-radius:50px; cursor:pointer; font-weight:600; font-size:0.9rem; transition:0.2s;">Open
                                Journal </button>
                        </div>
                        <!-- 3. SUPPORT SECTION (Split - Compact) -->
                        <div
                            style="margin-top:20px; margin-bottom:15px; text-align:center; opacity:0.5; font-size:0.75rem; letter-spacing:1px; font-weight:700; text-transform:uppercase; color:var(--text-muted);">
                            When you want to talk to someone </div>
                        <div class="dashboard-grid" style="grid-template-columns: 1fr 1fr; gap:15px; margin:0 auto;">
                            <!-- PEER TALK -->
                            <div class="dash-card link-hover" onclick="window.location.href='../our-peers/profile.html'"
                                style="text-align:center; padding:20px 15px; cursor:pointer; min-height:160px; display:flex; flex-direction:column; align-items:center; justify-content:center; background:var(--peach-bg); border:1px solid var(--peach-border); border-radius:16px; transition:all 0.3s ease;">
                                <i class="fas fa-hands-helping"
                                    style="font-size:1.6rem; margin-bottom:15px; color:var(--peach-glow);"></i>
                                <h3
                                    style="font-size:1.1rem; margin-bottom:5px; color:var(--peach-glow); font-weight:600;">
                                    Talk to a Peer</h3>
                                <p style="font-size:0.85rem; color:var(--text-muted); opacity:0.8; margin:0;">
                                    Someone sitting beside you.</p>
                            </div>
                            <!-- PROFESSIONAL HELP -->
                            <div class="dash-card link-hover"
                                onclick="window.location.href='../our-psychologists/about.html'"
                                style="text-align:center; padding:20px 15px; cursor:pointer; min-height:160px; display:flex; flex-direction:column; align-items:center; justify-content:center; background:var(--teal-dim); border:1px solid var(--teal-border); border-radius:16px; transition:all 0.3s ease;">
                                <i class="fas fa-user-md"
                                    style="font-size:1.6rem; margin-bottom:15px; color:var(--teal-accent);"></i>
                                <h3
                                    style="font-size:1.1rem; margin-bottom:5px; color:var(--teal-accent); font-weight:600;">
                                    Professional Guidance</h3>
                                <p style="font-size:0.85rem; color:var(--text-muted); opacity:0.8; margin:0;">
                                    Structured care and support.</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <!-- VIEW: BOOKINGS (Enhanced) -->
            <!-- VIEW: BOOKINGS (Enhanced - Compact) -->
            <div id="view-bookings" class="view-section" style="display:none; padding-top:0;">
                <!-- Header matching SoulBot style -->
                <div
                    style="padding:20px; border-bottom:1px solid rgba(255,255,255,0.05); display:flex; align-items:center; gap:15px; margin-bottom:20px;">
                    <div
                        style="width:40px; height:40px; background:var(--teal-dim); border-radius:50%; display:flex; align-items:center; justify-content:center; color:var(--teal-accent);">
                        <i class="fas fa-calendar-alt"></i>
                    </div>
                    <div>
                        <h2 style="font-family:'Outfit'; font-weight:700; font-size:1.1rem; margin:0;">My
                            Sessions
                        </h2>
                        <div style="font-size:0.8rem; opacity:0.7;">Manage your appointments</div>
                    </div>
                </div>
                <!-- TABS -->
                <div
                    style="display:flex; gap:20px; border-bottom:1px solid var(--border-soft); margin-bottom:20px; padding-bottom:5px;">
                    <div
                        style="font-weight:700; color:var(--teal-accent); border-bottom:2px solid var(--teal-accent); padding-bottom:5px; cursor:pointer;">
                        Upcoming</div>
                    <div style="opacity:0.6; cursor:pointer;">History</div>
                    <div style="opacity:0.6; cursor:pointer;">Feedback</div>
                </div>
                <div class="dashboard-grid" style="gap:20px;">
                    <!-- MAIN LIST -->
                    <div class="dash-card" style="grid-column: span 1; padding:20px;">
                        <h3 style="margin-bottom:15px; font-size:1.2rem;">
                            Upcoming Sessions</h3>
                        <!-- Empty State Placeholder -->
                        <div
                            style="text-align:center; padding:20px; background:var(--bg-deep); border-radius:12px; border:1px dashed var(--border-subtle);">
                            <i class="fas fa-calendar-check"
                                style="font-size:1.5rem; opacity:0.3; margin-bottom:10px;"></i>
                            <p style="opacity:0.7; font-size:0.9rem; margin-bottom:10px;">
                                No upcoming sessions scheduled.</p><button
                                onclick="window.location.href='../our-peers/about.html'" class="btn-dash-primary"
                                style="font-size:0.85rem; padding:8px 20px;">Book
                                a Session</button>
                        </div>
                    </div>
                    <!-- SIDEBAR: FIND HELP -->
                    <div style="display:flex; flex-direction:column; gap:15px;">
                        <!-- Book New -->
                        <div class="dash-card" style="padding:20px;">
                            <h4 style="margin-bottom:10px; font-size:1.1rem;">
                                Find Support</h4>
                            <div onclick="openTool('../our-peers/index.html', 'Browse Peers')" class="action-row peach"
                                style="margin-bottom:10px;">
                                <div
                                    style="width:30px; height:30px; background:rgba(244, 159, 117, 0.1); border-radius:50%; display:flex; align-items:center; justify-content:center; color:var(--peach-glow);">
                                    <i class="fas fa-hands-helping" style="font-size:0.9rem;"></i>
                                </div>
                                <div style="font-size:0.85rem;">Browse
                                    Peer Listeners</div>
                            </div>
                            <div onclick="openTool('../our-psychologists/psychologists.html', 'Browse Psychologists')"
                                class="action-row" style="margin-bottom:10px;">
                                <div
                                    style="width:30px; height:30px; background:rgba(78, 205, 196, 0.1); border-radius:50%; display:flex; align-items:center; justify-content:center; color:var(--teal-accent);">
                                    <i class="fas fa-user-md" style="font-size:0.9rem;"></i>
                                </div>
                                <div style="font-size:0.85rem;">Find a
                                    Psychologist</div>
                            </div>
                            <div onclick="window.open('https://www.supersaas.com/', '_blank')" class="action-row">
                                <div
                                    style="width:30px; height:30px; background:rgba(255,255,255,0.05); border-radius:50%; display:flex; align-items:center; justify-content:center;">
                                    <i class="fas fa-calendar-alt" style="font-size:0.9rem;"></i>
                                </div>
                                <div style="font-size:0.85rem;">
                                    SuperSaaS Calendar</div>
                            </div>
                        </div>
                        <!-- Credits -->
                        <div class="dash-card" style="position:relative; overflow:hidden; padding:20px;">
                            <h4 style="margin-bottom:5px; font-size:1.1rem;">
                                Wallet</h4>
                            <div style="font-size:1.8rem; font-weight:700; color:var(--text-main);">
                                $0.00</div>
                            <div style="font-size:0.8rem; opacity:0.6; margin-bottom:10px;">
                                Available Credits</div><button
                                style="width:100%; padding:8px; background:var(--bg-deep); border:1px solid var(--border-subtle); color:var(--text-main); border-radius:8px; cursor:pointer; font-size:0.9rem;">Add
                                Funds</button>
                        </div>
                    </div>
                </div>
            </div>
            <!-- VIEW: JOURNAL (Enhanced) -->
            <div id="view-journal" class="view-section no-scroll" style="display:none;">
                <!-- Standardized Header -->
                <div class="workspace-header">
                    <div
                        style="width:40px; height:40px; background:rgba(255,255,255,0.05); border-radius:50%; display:flex; align-items:center; justify-content:center; color:var(--text-main);">
                        <i class="fas fa-book"></i>
                    </div>
                    <div>
                        <h2 style="font-family:'Outfit'; font-weight:700; font-size:1.1rem; margin:0;">My
                            Journal
                        </h2>
                        <div style="font-size:0.8rem; opacity:0.7;">Your personal space for reflection</div>
                    </div>
                </div>
                <!-- Fixed Height Container -->
                <div
                    style="display:grid; grid-template-columns: 240px 1fr; gap:20px; flex:1; min-height:0; padding-bottom: 20px;">
                    <!-- Maximized Height -->
                    <!-- Sidebar -->
                    <div class="dash-card" style="padding:15px; display:flex; flex-direction:column;">
                        <button
                            style="width:100%; padding:10px; background:var(--teal-accent); color:#0f172a; border:none; border-radius:8px; font-weight:700; cursor:pointer; margin-bottom:15px; font-size:0.9rem;"><i
                                class="fas fa-plus"></i>New Entry</button>
                        <div
                            style="font-size:0.75rem; opacity:0.6; text-transform:uppercase; margin-bottom:10px; font-weight:700;">
                            Recent</div>
                        <!-- DYNAMIC LIST CONTAINER -->
                        <div id="journal-list"
                            style="flex:1; overflow-y:auto; display:flex; flex-direction:column; gap:3px;">
                            <!-- Injected via JS -->
                        </div>
                        <!-- EMPTY STATE -->
                        <div id="journal-empty" style="text-align:center; padding:20px; opacity:0.6; display:none;">
                            <i class="fas fa-pen-fancy" style="margin-bottom:10px;"></i>
                            <div style="font-size:0.8rem;">No
                                entries yet.</div>
                        </div>
                    </div>
                    <!-- Editor -->
                    <div class="dash-card" style="display:flex; flex-direction:column; padding:25px;">
                        <div
                            style="display:flex; justify-content:space-between; align-items:center; margin-bottom:15px;">
                            <input type="text" value="Morning Thoughts"
                                style="background:transparent; border:none; font-size:1.4rem; font-family:var(--font-head); color:var(--text-main); flex:1; outline:none;">
                            <div style="opacity:0.5; font-size:0.85rem; white-space:nowrap; margin-left:15px;">
                                Saved</div>
                        </div><textarea
                            style="flex:1; background:transparent; border:none; resize:none; font-family:var(--font-body); font-size:1rem; line-height:1.6; color:var(--text-muted); outline:none;"
                            placeholder="Start writing..."></textarea>
                    </div>
                </div>
            </div>
            <!-- VIEW: SAVED CONTENT -->
            <div id="view-saved" class="view-section" style="display:none; padding-top:0;">
                <!-- Header matching SoulBot style -->
                <div
                    style="padding:20px; border-bottom:1px solid rgba(255,255,255,0.05); display:flex; align-items:center; gap:15px; margin-bottom:20px;">
                    <div
                        style="width:40px; height:40px; background:rgba(255,255,255,0.05); border-radius:50%; display:flex; align-items:center; justify-content:center; color:var(--text-main);">
                        <i class="fas fa-bookmark"></i>
                    </div>
                    <div>
                        <h2 style="font-family:'Outfit'; font-weight:700; font-size:1.1rem; margin:0;">Saved for
                            Later
                        </h2>
                        <div style="font-size:0.8rem; opacity:0.7;">Your bookmarked content</div>
                    </div>
                </div>
                <div class="dash-card">
                    <div style="display:flex; gap:10px; margin-bottom:20px;">
                        <button
                            style="padding:8px 15px; background:white; color:#0f172a; border-radius:30px; border:none; font-weight:700;">All</button><button
                            style="padding:8px 15px; background:rgba(255,255,255,0.05); color:white; border-radius:30px; border:none;">Articles</button><button
                            style="padding:8px 15px; background:rgba(255,255,255,0.05); color:white; border-radius:30px; border:none;">Forum
                            Posts</button>
                    </div>
                    <div style="display:flex; flex-direction:column; gap:15px;">
                        <div
                            style="background:rgba(255,255,255,0.03); padding:20px; border-radius:12px; display:flex; justify-content:space-between; align-items:center;">
                            <div>
                                <div style="font-weight:700; margin-bottom:5px;">
                                    Understanding Anxiety Triggers</div>
                                <div style="font-size:0.8rem; opacity:0.6;">
                                    Saved 2 days ago ‚Ä¢ Blog</div>
                            </div><button
                                style="background:transparent; border:1px solid rgba(255,255,255,0.1); color:white; padding:5px 15px; border-radius:4px;">Read</button>
                        </div>
                        <div
                            style="background:rgba(255,255,255,0.03); padding:20px; border-radius:12px; display:flex; justify-content:space-between; align-items:center;">
                            <div>
                                <div style="font-weight:700; margin-bottom:5px;">
                                    "How do you handle exam stress?" </div>
                                <div style="font-size:0.8rem; opacity:0.6;">
                                    Saved 5 hours ago ‚Ä¢ Forum ‚Ä¢ 12 new replies
                                </div>
                            </div><button
                                style="background:transparent; border:1px solid rgba(255,255,255,0.1); color:white; padding:5px 15px; border-radius:4px;">View
                                Thread</button>
                        </div>
                    </div>
                </div>
            </div>
            <!-- VIEW: MESSAGES (Integrated) -->
            <div id="view-messages" class="view-section" style="display:none; height:100%; padding-top:0;">
                <!-- Standardized Header -->
                <div
                    style="padding:20px 0; border-bottom:1px solid rgba(255,255,255,0.05); display:flex; align-items:center; gap:15px; margin-bottom:20px; text-align:left;">
                    <div
                        style="width:40px; height:40px; background:rgba(255,255,255,0.05); border-radius:50%; display:flex; align-items:center; justify-content:center; color:var(--text-main);">
                        <i class="fas fa-envelope"></i>
                    </div>
                    <div>
                        <h2 style="font-family:'Outfit'; font-weight:700; font-size:1.1rem; margin:0;">Messages
                        </h2>
                        <div style="font-size:0.8rem; opacity:0.7;">Secure conversations with your peers and
                            pros
                        </div>
                    </div>
                </div>
                <div
                    style="display:grid; grid-template-columns: 320px 1fr; gap:20px; flex:1; min-height:0; padding-bottom:10px;">
                    <!-- THREADS -->
                    <div class="dash-card" style="display:flex; flex-direction:column; padding:0; overflow:hidden;">
                        <div
                            style="padding:15px 20px; border-bottom:1px solid var(--border-subtle); font-size:0.8rem; text-transform:uppercase; letter-spacing:1px; opacity:0.6; font-weight:700;">
                            Active Threads</div>
                        <div class="thread-item active"
                            style="padding:15px 20px; border-bottom:1px solid var(--border-subtle); display:flex; gap:10px; cursor:pointer; background:rgba(255,255,255,0.05); border-left:3px solid var(--teal-accent);">
                            <div
                                style="width:40px; height:40px; background:var(--teal-accent); border-radius:50%; color:#0f172a; display:flex; align-items:center; justify-content:center;">
                                <i class="fas fa-user-md"></i>
                            </div>
                            <div style="flex:1;">
                                <div style="font-weight:600;">Dr. Emily Stone</div>
                                <div style="font-size:0.8rem; opacity:0.7;">Reflection Task</div>
                            </div>
                        </div>
                        <div class="thread-item"
                            style="padding:15px 20px; border-bottom:1px solid var(--border-subtle); display:flex; gap:10px; cursor:pointer; background:rgba(255,255,255,0.05); border-left:3px solid var(--peach-glow); opacity:0.85;">
                            <div
                                style="width:40px; height:40px; background:var(--peach-glow); border-radius:50%; color:#0f172a; display:flex; align-items:center; justify-content:center;">
                                <i class="fas fa-hands-helping"></i>
                            </div>
                            <div style="flex:1;">
                                <div style="font-weight:600;">Peer Sarah</div>
                                <div style="font-size:0.8rem; opacity:0.7;">Checking in...</div>
                            </div>
                        </div>
                    </div>
                    <!-- CHAT AREA -->
                    <div class="dash-card" style="display:flex; flex-direction:column; padding:0; overflow:hidden;">
                        <div
                            style="padding:15px 20px; border-bottom:1px solid var(--border-subtle); display:flex; justify-content:space-between; align-items:center;">
                            <div style="display:flex; gap:10px; align-items:center;">
                                <div
                                    style="width:35px; height:35px; background:var(--teal-accent); color:#0f172a; border-radius:50%; display:flex; align-items:center; justify-content:center;">
                                    <i class="fas fa-user-md"></i>
                                </div>
                                <div>
                                    <div style="font-weight:700;">Dr. Emily Stone</div>
                                    <div style="font-size:0.8rem; opacity:0.6;">Clinical Psychologist
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div
                            style="flex:1; padding:15px; overflow-y:auto; display:flex; flex-direction:column; gap:12px; min-height:0;">
                            <div class="chat-bubble received"
                                style="background:rgba(255,255,255,0.05); align-self:flex-start; max-width:75%; padding:12px; border-radius:12px; border-bottom-left-radius:2px;">
                                Hi there. Following up on our session yesterday. Here is the reflection
                                task. <div
                                    style="margin-top:10px; background:rgba(0,0,0,0.2); padding:10px; border-radius:8px; border:1px solid var(--teal-accent);">
                                    <div style="font-weight:700; color:var(--teal-accent); margin-bottom:5px;">
                                        <i class="fas fa-pen"></i>Task: Anxiety
                                    </div>
                                    <p style="font-size:0.85rem; margin-bottom:5px;">List 3 situations
                                        this week.</p>
                                </div>
                            </div>
                            <div class="chat-bubble sent"
                                style="background:var(--teal-dim); border:1px solid var(--teal-accent); color:var(--teal-accent); align-self:flex-end; max-width:75%; padding:12px; border-radius:12px; border-bottom-right-radius:2px;">
                                Thanks Dr. Stone. I'll work on this tonight.
                            </div>
                        </div>
                        <div style="padding:15px; border-top:1px solid var(--border-subtle); display:flex; gap:10px;">
                            <input type="text" placeholder="Type a message..."
                                style="flex:1; background:rgba(0,0,0,0.2); border:1px solid var(--border-subtle); color:white; padding:10px; border-radius:8px;"><button
                                style="background:var(--teal-accent); color:#0f172a; width:40px; border-radius:8px; border:none; cursor:pointer;"><i
                                    class="fas fa-paper-plane"></i></button>
                        </div>
                    </div>
                </div>
            </div>
            <!-- VIEW: WALLET -->
            <div id="view-wallet" class="view-section" style="display:none; padding-top:0;">
                <div style="padding:20px; border-bottom:1px solid rgba(255,255,255,0.05); margin-bottom:20px;">
                    <h1 style="margin:0; font-size:1.8rem;">My Wallet</h1>
                    <p style="margin:5px 0 0; opacity:0.6; font-size:0.9rem;">Manage funds and payment methods.</p>
                </div>

                <div class="dashboard-grid">
                    <!-- Balance Card -->
                    <div class="dash-card"
                        style="background: linear-gradient(135deg, rgba(45, 212, 191, 0.2), rgba(15, 23, 42, 0.8)); border:1px solid var(--teal-accent);">
                        <h4 style="margin-bottom:10px; opacity:0.8;">Current Balance</h4>
                        <div style="font-size:3.5rem; font-weight:700; color:var(--teal-accent); font-family:'Outfit';"
                            id="wallet-balance">$0.00</div>
                        <div style="margin-top:20px; display:flex; gap:10px;">
                            <button class="btn-dash-primary" onclick="triggerAddFunds()">+ Add Funds</button>
                        </div>
                    </div>

                    <!-- Payment Methods (Placeholder) -->
                    <div class="dash-card">
                        <h4 style="margin-bottom:15px; opacity:0.8;">Payment Methods</h4>
                        <div
                            style="padding:15px; background:rgba(255,255,255,0.05); border-radius:10px; display:flex; align-items:center; gap:15px; margin-bottom:10px;">
                            <i class="fab fa-cc-visa" style="font-size:1.5rem; color:#fff;"></i>
                            <div style="flex:1;">
                                <div style="font-weight:600;">Visa ending in 4242</div>
                                <div style="font-size:0.8rem; opacity:0.6;">Expires 12/28</div>
                            </div>
                            <span
                                style="font-size:0.7rem; background:rgba(45,212,191,0.2); color:#2dd4bf; padding:3px 8px; border-radius:4px;">Default</span>
                        </div>
                        <button class="btn-action-sm"
                            style="width:100%; border:1px dashed rgba(255,255,255,0.2); padding:10px;">+ Add Payment
                            Method</button>
                    </div>
                </div>
            </div>
            <!-- SCRIPTS -->
            <script src="../assets/js/components.js?v=3"
                onerror="console.error('Failed to load components.js')"></script>
            <script>function toggleSidebar() {
                    document.getElementById('sidebar').classList.toggle('open');
                }

                function handleLogout() {
                    sessionStorage.clear();
                    localStorage.removeItem('soulamore_session');
                    window.location.href = 'login.html';
                }

                // --- VIEW SWITCHING ---
                // Replaced by Module Import below


                // Initial view load function to check URL parameters or default
                document.addEventListener('DOMContentLoaded', () => {
                    // Check if there is a 'view' query param, otherwise default to home
                    // For now just defaulting to home, but logic is easy to extend
                    // Also restore selected theme
                    switchView('home');
                });

                // --- MODAL LOGIC ---
                function openTool(url, title) {
                    document.getElementById('modalTitle').innerText = title;
                    document.getElementById('toolFrame').src = url;
                    document.getElementById('toolModal').classList.add('open');
                }

                function closeTool() {
                    document.getElementById('toolModal').classList.remove('open');

                    // Reset src to stop videos/audio
                    setTimeout(() => {
                        document.getElementById('toolFrame').src = '';
                    }

                        , 300);
                }

                // --- MOOD LOGIC ---
                function logMood(mood) {
                    alert(`Mood tracked: ${mood
                        }

                . This would be saved to your private journal.`);
                }

                // Initialize View
                document.addEventListener('DOMContentLoaded', () => {
                    // Just default to home, theme is handled by components.js
                    switchView('home');
                });


                /* SOULBOT CHAT LOGIC - Deprecated (Handled by Module below) */
                // kept empty to avoid reference errors if any onclicks linger, 
                // though module overwrites window.sendMessage.


                // Allow Enter Key
                document.getElementById("soulbot-input").addEventListener("keypress", function (e) {
                    if (e.key === "Enter") sendMessage();
                });

                // Initialize View with Deep Linking
                document.addEventListener('DOMContentLoaded', () => {
                    // 1. Check for URL Param ?view=xxx
                    const urlParams = new URLSearchParams(window.location.search);
                    const viewParam = urlParams.get('view');

                    if (viewParam) {
                        switchView(viewParam);
                    }

                    else {
                        switchView('home');
                    }

                    // --- JOURNAL LOGIC (Added for Empty State Demo) ---
                    renderJournalSidebar();
                });

                function renderJournalSidebar() {
                    const list = document.getElementById('journal-list');
                    const empty = document.getElementById('journal-empty');
                    // Mock Data or LocalStorage
                    const stored = localStorage.getItem('my_journal_entries');

                    // Default demo data if nothing stored, to show UI
                    const entries = stored ? JSON.parse(stored) : [{
                        title: "Morning Thoughts", date: "Today"
                    }

                        ,
                    {
                        title: "Weekly Reflection", date: "3 days ago"
                    }

                    ];

                    // To test empty state, uncomment:
                    // const entries = [];

                    if (!entries || entries.length === 0) {
                        list.style.display = 'none';
                        empty.style.display = 'block';
                    }

                    else {
                        list.style.display = 'flex';
                        empty.style.display = 'none';
                        list.innerHTML = '';

                        entries.forEach(e => {
                            const div = document.createElement('div');
                            div.style.cssText = "padding:10px; background:rgba(255,255,255,0.05); border-radius:6px; font-size:0.9rem; cursor:pointer; margin-bottom:5px;";

                            div.innerHTML = `${e.title
                                }

                    <br><span style="font-size:0.7em; opacity:0.5;" >${e.date
                                }

                    </span>`;
                            list.appendChild(div);
                        });
                    }
                }

                // --- THEME LOGIC (Moved here for reliability) ---
                window.setThemeMode = function (mode) {
                    // Target BOTH body and html to override global styles
                    document.body.classList.remove('light-mode');
                    document.documentElement.classList.remove('light-mode');

                    if (mode === 'light') {
                        document.body.classList.add('light-mode');
                        document.documentElement.classList.add('light-mode');
                    }

                    // Update Buttons
                    document.querySelectorAll('.theme-btn').forEach(b => b.classList.remove('active'));
                    const btn = document.getElementById('btn-mode-' + mode);
                    if (btn) btn.classList.add('active');

                    // Persist
                    localStorage.setItem('soul_theme_mode', mode);
                }

                    ;

                window.setEmotionalTheme = function (theme) {
                    // Target BOTH body and html
                    document.body.setAttribute('data-theme', theme);
                    document.documentElement.setAttribute('data-theme', theme);

                    // Update Buttons
                    document.querySelectorAll('.theme-tag').forEach(b => b.classList.remove('active'));
                    const btn = document.getElementById('btn-theme-' + theme);
                    if (btn) btn.classList.add('active');

                    // Persist
                    localStorage.setItem('soul_theme_emotion', theme);
                }

                    ;

                // --- TOOL MODAL LOGIC (Moved here for reliability) ---
                window.openToolsModal = function () {
                    document.getElementById('quickToolsModal').classList.add('open');
                }

                window.closeToolsModal = function (e) {
                    if (e && e.target !== document.getElementById('quickToolsModal') && !e.target.classList.contains('tool-close-btn')) return;
                    document.getElementById('quickToolsModal').classList.remove('open');
                }

                // Init Themes
                function initThemes() {
                    const savedMode = localStorage.getItem('soul_theme_mode') || 'dark';
                    const savedTheme = localStorage.getItem('soul_theme_emotion') || 'calm';
                    setThemeMode(savedMode);
                    setEmotionalTheme(savedTheme);
                }

                // Run Init
                initThemes();

            </script>
            <script type="module">import {
                    createConversation,
                    addMessageToConversation,
                    subscribeToConversation
                }

                    from "../assets/js/soulbot-handler.js";

                let currentConversationId = localStorage.getItem('soulbot_conversation_id');
                let unsubscribe = null;
                const msgContainer = document.getElementById('soulbot-messages');
                const inputField = document.getElementById('soulbot-input');

                // --- INITIALIZATION ---
                async function initSoulBotChat() {
                    if (!currentConversationId) {
                        // Create new conversation
                        // TODO: Pass actual userId if logged in
                        currentConversationId = await createConversation("anonymous_user");

                        if (currentConversationId) {
                            localStorage.setItem('soulbot_conversation_id', currentConversationId);
                        }
                    }

                    // Subscribe to updates
                    if (currentConversationId) {
                        if (unsubscribe) unsubscribe(); // Clear old sub if any
                        unsubscribe = subscribeToConversation(currentConversationId, renderMessages);
                    }
                }

                // --- RENDER LOGIC ---
                function renderMessages(conversationData) {
                    if (!conversationData || !conversationData.messages) return;

                    // Clear current (simple re-render for MVP)
                    msgContainer.innerHTML = '';

                    // Add Welcome Message Always
                    if (conversationData.messages.length === 0) {
                        msgContainer.innerHTML = ` <div class="chat-bubble bot">Hi there. I'm SoulBot. I' m not a therapist,
                but I'm here to listen without judgment.
 What's on your mind today?
 </div>`;
                    }

                    conversationData.messages.forEach(msg => {
                        const div = document.createElement('div');

                        div.className = `chat-bubble ${msg.role === 'user' ? 'user' : 'bot'
                            }

                    `;
                        // Simple text rendering (could add markdown support later)
                        div.innerText = msg.text;
                        msgContainer.appendChild(div);
                    });

                    // Scroll to bottom
                    msgContainer.scrollTop = msgContainer.scrollHeight;
                }

                // --- GLOBAL ACTIONS (Expose to window for onclick) ---
                window.sendMessage = async function () {
                    const text = inputField.value.trim();
                    if (!text) return;

                    // UI: Clear immediately for responsiveness
                    inputField.value = '';

                    // Core: Send to Backend
                    if (currentConversationId) {
                        await addMessageToConversation(currentConversationId, 'user', text);

                        // Mock Bot Reply (Temporary until Cloud Function/Backend Service is active)
                        // In a real app, a Cloud Function triggers on Firestore write.
                        // Here we simulate it locally for demonstration if needed, 
                        // BUT the robust way is backend. 
                        // For now, let's let the user know if no backend is responding.
                        // setTimeout(() => addMessageToConversation(currentConversationId, 'bot', "I hear you. (AI Backend Integration required for full reply)"), 1000);
                    }
                }

                    ;

                window.clearChat = function () {
                    if (confirm("Start a new conversation?")) {
                        localStorage.removeItem('soulbot_conversation_id');
                        currentConversationId = null;
                        initSoulBotChat();
                    }
                }

                    ;

                // Start
                initSoulBotChat();

            </script>
            <!-- DASHBOARD HYDRATION SCRIPT -->
            <script type="module">
                import { onAuthChange } from "../assets/js/auth-service.js";
                import { getUserProfile, createOrUpdateUserProfile } from "../assets/js/profile-handler.js";

                // Hydrate dashboard UI whenever auth state changes
                onAuthChange(async (user) => {
                    if (!user) {
                        console.log("Dashboard: no authenticated user.");
                        return;
                    }

                    try {
                        console.log("Dashboard: user detected", user.uid);

                        // 1. Get Profile
                        let profile = await getUserProfile(user.uid);

                        // 2. If no profile, try to create one (recovery)
                        if (!profile) {
                            console.info("Profile missing in dashboard, attempting recovery...");
                            await createOrUpdateUserProfile(user);
                            profile = await getUserProfile(user.uid);
                        }

                        if (!profile) {
                            console.warn("Dashboard: profile still missing after recovery.");
                            return;
                        }

                        // 3. Compute display values
                        const name = profile.displayName || user.displayName || 'Friend';
                        const email = profile.email || user.email || '';
                        const phone = profile.phone || user.phoneNumber || '';

                        // Personal Greeting
                        const greetingEl = document.getElementById('welcome-greeting');
                        if (greetingEl) {
                            greetingEl.innerHTML = `Welcome back, <span style="color:var(--teal-accent);">${name}</span>.`;
                        }

                        // Sidebar
                        const sbName = document.getElementById('sidebar-name');
                        if (sbName) sbName.innerText = name;

                        const sbRole = document.getElementById('sidebar-role');
                        if (sbRole) sbRole.innerText = (profile.role || 'Member');

                        // Primary profile card
                        const inName = document.getElementById('profile-name');
                        if (inName) inName.value = name;

                        const inPhone = document.getElementById('profile-phone');
                        if (inPhone) inPhone.value = phone;

                        const elEmail = document.getElementById('profile-email');
                        if (elEmail) elEmail.innerText = email;

                        // Secondary "Profile" view (detailed tab)
                        const inName2 = document.getElementById('profile-name2');
                        if (inName2) inName2.value = name;

                        const inPhone2 = document.getElementById('profile-phone2');
                        if (inPhone2) inPhone2.value = phone;

                        const elEmail2 = document.getElementById('profile-email2');
                        if (elEmail2) elEmail2.innerText = email;

                    } catch (error) {
                        console.error("Dashboard hydration error:", error);
                    }
                });
            </script>


            <!-- FLOATING TOOLS BUTTON & MENU -->
            <button id="tools-fab" onclick="toggleToolsMenu()"
                style="position:fixed; bottom:30px; right:30px; width:56px; height:56px; border-radius:50%; background:var(--peach-glow); border:none; cursor:pointer; box-shadow:0 4px 12px rgba(244,159,117,0.4); display:flex; align-items:center; justify-content:center; z-index:1000; transition:all 0.3s ease;">
                <i class="fas fa-toolbox" style="font-size:1.4rem; color:#0f172a;"></i>
            </button>

            <!-- TOOLS SLIDE-OUT MENU -->
            <div id="tools-menu"
                style="position:fixed; top:0; right:-350px; width:350px; height:100vh; background:var(--bg-card); border-left:1px solid var(--border-subtle); z-index:999; transition:right 0.3s ease; display:flex; flex-direction:column; box-shadow:-4px 0 20px rgba(0,0,0,0.3);">
                <!-- Header -->
                <div
                    style="padding:20px; border-bottom:1px solid var(--border-subtle); display:flex; justify-content:space-between; align-items:center; background:rgba(0,0,0,0.2);">
                    <div>
                        <h3 style="margin:0; font-family:'Outfit'; font-size:1.2rem;">Self-Help Tools</h3>
                        <p style="margin:5px 0 0 0; font-size:0.8rem; opacity:0.7;">Quick access to all tools</p>
                    </div>
                    <button onclick="toggleToolsMenu()"
                        style="background:transparent; border:none; color:var(--text-main); cursor:pointer; font-size:1.5rem; opacity:0.7; padding:5px;">
                        <i class="fas fa-times"></i>
                    </button>
                </div>

                <!-- Tools List -->
                <div style="flex:1; overflow-y:auto; padding:15px;">
                    <!-- Vent Box -->
                    <div onclick="window.open('../tools/vent-box.html', '_blank')" class="tool-item"
                        style="padding:15px; background:rgba(239,68,68,0.1); border:1px solid rgba(239,68,68,0.3); border-radius:12px; margin-bottom:12px; cursor:pointer; transition:all 0.2s;">
                        <div style="display:flex; align-items:center; gap:12px;">
                            <div
                                style="width:40px; height:40px; background:rgba(239,68,68,0.2); border-radius:50%; display:flex; align-items:center; justify-content:center;">
                                <i class="fas fa-fire" style="color:#ef4444; font-size:1.1rem;"></i>
                            </div>
                            <div style="flex:1;">
                                <h4 style="margin:0; font-size:1rem; color:#ef4444;">Vent Box</h4>
                                <p style="margin:3px 0 0 0; font-size:0.75rem; opacity:0.7;">Release frustration safely
                                </p>
                            </div>
                            <i class="fas fa-external-link-alt" style="opacity:0.5; font-size:0.9rem;"></i>
                        </div>
                    </div>

                    <!-- Confession Box -->
                    <div onclick="window.open('../tools/confession-box/index.html', '_blank')" class="tool-item"
                        style="padding:15px; background:rgba(139,92,246,0.1); border:1px solid rgba(139,92,246,0.3); border-radius:12px; margin-bottom:12px; cursor:pointer; transition:all 0.2s;">
                        <div style="display:flex; align-items:center; gap:12px;">
                            <div
                                style="width:40px; height:40px; background:rgba(139,92,246,0.2); border-radius:50%; display:flex; align-items:center; justify-content:center;">
                                <i class="fas fa-ghost" style="color:#8b5cf6; font-size:1.1rem;"></i>
                            </div>
                            <div style="flex:1;">
                                <h4 style="margin:0; font-size:1rem; color:#8b5cf6;">Confession Box</h4>
                                <p style="margin:3px 0 0 0; font-size:0.75rem; opacity:0.7;">Share anonymously</p>
                            </div>
                            <i class="fas fa-external-link-alt" style="opacity:0.5; font-size:0.9rem;"></i>
                        </div>
                    </div>

                    <!-- Drop It -->
                    <div onclick="window.open('../tools/drop-it.html', '_blank')" class="tool-item"
                        style="padding:15px; background:rgba(56,189,248,0.1); border:1px solid rgba(56,189,248,0.3); border-radius:12px; margin-bottom:12px; cursor:pointer; transition:all 0.2s;">
                        <div style="display:flex; align-items:center; gap:12px;">
                            <div
                                style="width:40px; height:40px; background:rgba(56,189,248,0.2); border-radius:50%; display:flex; align-items:center; justify-content:center;">
                                <i class="fas fa-hand-holding-water" style="color:#38bdf8; font-size:1.1rem;"></i>
                            </div>
                            <div style="flex:1;">
                                <h4 style="margin:0; font-size:1rem; color:#38bdf8;">Drop It</h4>
                                <p style="margin:3px 0 0 0; font-size:0.75rem; opacity:0.7;">Let go of worries</p>
                            </div>
                            <i class="fas fa-external-link-alt" style="opacity:0.5; font-size:0.9rem;"></i>
                        </div>
                    </div>

                    <!-- Playground -->
                    <div onclick="window.open('../tools/playground.html', '_blank')" class="tool-item"
                        style="padding:15px; background:rgba(250,176,5,0.1); border:1px solid rgba(250,176,5,0.3); border-radius:12px; margin-bottom:12px; cursor:pointer; transition:all 0.2s;">
                        <div style="display:flex; align-items:center; gap:12px;">
                            <div
                                style="width:40px; height:40px; background:rgba(250,176,5,0.2); border-radius:50%; display:flex; align-items:center; justify-content:center;">
                                <i class="fas fa-shapes" style="color:#fab005; font-size:1.1rem;"></i>
                            </div>
                            <div style="flex:1;">
                                <h4 style="margin:0; font-size:1rem; color:#fab005;">Playground</h4>
                                <p style="margin:3px 0 0 0; font-size:0.75rem; opacity:0.7;">Creative relief</p>
                            </div>
                            <i class="fas fa-external-link-alt" style="opacity:0.5; font-size:0.9rem;"></i>
                        </div>
                    </div>

                    <!-- Breathing Exercise -->
                    <div onclick="window.open('../tools/breathing.html', '_blank')" class="tool-item"
                        style="padding:15px; background:rgba(45,212,191,0.1); border:1px solid rgba(45,212,191,0.3); border-radius:12px; margin-bottom:12px; cursor:pointer; transition:all 0.2s;">
                        <div style="display:flex; align-items:center; gap:12px;">
                            <div
                                style="width:40px; height:40px; background:rgba(45,212,191,0.2); border-radius:50%; display:flex; align-items:center; justify-content:center;">
                                <i class="fas fa-wind" style="color:var(--teal-accent); font-size:1.1rem;"></i>
                            </div>
                            <div style="flex:1;">
                                <h4 style="margin:0; font-size:1rem; color:var(--teal-accent);">Breathing</h4>
                                <p style="margin:3px 0 0 0; font-size:0.75rem; opacity:0.7;">Calm your mind</p>
                            </div>
                            <i class="fas fa-external-link-alt" style="opacity:0.5; font-size:0.9rem;"></i>
                        </div>
                    </div>

                    <!-- Reset Tool -->
                    <div onclick="window.open('../tools/5-step-reset.html', '_blank')" class="tool-item"
                        style="padding:15px; background:rgba(255,255,255,0.05); border:1px solid var(--border-subtle); border-radius:12px; margin-bottom:12px; cursor:pointer; transition:all 0.2s;">
                        <div style="display:flex; align-items:center; gap:12px;">
                            <div
                                style="width:40px; height:40px; background:rgba(255,255,255,0.1); border-radius:50%; display:flex; align-items:center; justify-content:center;">
                                <i class="fas fa-redo-alt" style="color:var(--text-main); font-size:1.1rem;"></i>
                            </div>
                            <div style="flex:1;">
                                <h4 style="margin:0; font-size:1rem;">Reset</h4>
                                <p style="margin:3px 0 0 0; font-size:0.75rem; opacity:0.7;">Start fresh</p>
                            </div>
                            <i class="fas fa-external-link-alt" style="opacity:0.5; font-size:0.9rem;"></i>
                        </div>
                    </div>
                </div>
            </div>

            <style>
                .tool-item:hover {
                    transform: translateX(-5px);
                    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
                }

                #tools-fab:hover {
                    transform: scale(1.1);
                    box-shadow: 0 6px 20px rgba(244, 159, 117, 0.6);
                }
            </style>

            <script>
                function toggleToolsMenu() {
                    const menu = document.getElementById('tools-menu');
                    const fab = document.getElementById('tools-fab');
                    const isOpen = menu.style.right === '0px';

                    if (isOpen) {
                        menu.style.right = '-350px';
                        fab.style.transform = 'rotate(0deg)';
                    } else {
                        menu.style.right = '0px';
                        fab.style.transform = 'rotate(180deg)';
                    }
                }

                // Close menu when clicking outside
                document.addEventListener('click', function (event) {
                    const menu = document.getElementById('tools-menu');
                    const fab = document.getElementById('tools-fab');
                    if (menu && fab && !menu.contains(event.target) && !fab.contains(event.target) && menu.style.right === '0px') {
                        toggleToolsMenu();
                    }
                });
            </script>

            <!-- PHOTO UPLOAD MODAL -->
            <div id="photo-upload-modal"
                style="display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(15, 23, 42, 0.8); backdrop-filter:blur(8px); z-index:2000; align-items:center; justify-content:center;">
                <div class="dash-card"
                    style="max-width:550px; width:90%; animation: slideUp 0.3s ease; border:1px solid var(--border-subtle);">

                    <div style="text-align:center; margin-bottom:30px;">
                        <h2 style="font-family:'Outfit'; margin-bottom:15px; color:var(--text-main);">Profile Photo</h2>
                        <div
                            style="font-size:0.95rem; line-height:1.6; color:var(--text-muted); font-style:italic; border-left:3px solid var(--teal-accent); padding-left:20px; text-align:left; margin:0 auto; max-width:400px; padding:20px; background:rgba(255,255,255,0.02); border-radius:0 12px 12px 0;">
                            <p style="margin-bottom:10px;">Choose a photo where your face is visible and you feel like
                                yourself.
                            </p>
                            <p style="margin-bottom:10px;">Natural light is enough.<br>A simple background is
                                enough.<br>A quiet
                                smile, or even a calm, neutral expression, is enough.</p>
                            <p style="margin-bottom:10px;">This photo isn‚Äôt about looking perfect.<br>It‚Äôs about letting
                                someone
                                see the person behind the name.</p>
                        </div>
                    </div>

                    <!-- Drag & Drop Zone -->
                    <div id="drop-zone" onclick="document.getElementById('file-input').click()"
                        ondrop="handleDrop(event)" ondragover="event.preventDefault()"
                        style="border:2px dashed var(--border-subtle); border-radius:12px; padding:40px; text-align:center; cursor:pointer; transition:all 0.2s; background:rgba(255,255,255,0.01);">

                        <input type="file" id="file-input" hidden accept="image/*" onchange="previewPhoto(this)">

                        <div style="font-size:3rem; color:var(--teal-accent); margin-bottom:15px; opacity:0.8;">
                            <i class="fas fa-cloud-upload-alt"></i>
                        </div>
                        <h4 style="margin-bottom:5px; font-family:'Outfit';">Click or Drag & Drop</h4>
                        <p style="font-size:0.9rem; opacity:0.5;">Supports JPG, PNG (Max 5MB)</p>
                    </div>

                    <div style="margin-top:25px; text-align:right;">
                        <button class="btn-dash-secondary" onclick="togglePhotoModal(false)"
                            style="margin-right:10px;">Cancel</button>
                    </div>
                </div>
            </div>

            <!-- UI UTILITY SCRIPTS (Restored) -->
            <script>
                // --- PHOTO UPLOAD FUNCTIONS ---
                function triggerPhotoUpload() {
                    togglePhotoModal(true);
                }

                function togglePhotoModal(show) {
                    const modal = document.getElementById('photo-upload-modal');
                    if (modal) modal.style.display = show ? 'flex' : 'none';
                }

                function handleDrop(e) {
                    e.preventDefault();
                    if (e.dataTransfer.files && e.dataTransfer.files[0]) {
                        previewPhoto({ files: e.dataTransfer.files });
                    }
                }

                function previewPhoto(input) {
                    if (input.files && input.files[0]) {
                        const reader = new FileReader();
                        reader.onload = function (e) {
                            // Update all avatar instances
                            const avatars = document.querySelectorAll('.profile-avatar-img');
                            avatars.forEach(img => {
                                img.src = e.target.result;
                                img.style.display = 'block';
                            });
                            // Hide text avatars
                            const textAvatars = document.querySelectorAll('.profile-avatar-text');
                            textAvatars.forEach(el => el.style.display = 'none');

                            togglePhotoModal(false);
                        }
                        reader.readAsDataURL(input.files[0]);
                    }
                }
            </script>
            <!-- SAFETY INIT: Prevent Black Screen -->
            <script>
                document.addEventListener('DOMContentLoaded', () => {
                    setTimeout(() => {
                        const views = document.querySelectorAll('.view-section');
                        let visible = false;
                        views.forEach(v => {
                            if (v.classList.contains('active')) visible = true;
                        });

                        if (!visible) {
                            console.warn("‚ö†Ô∏è No view active. Forcing Home View.");
                            const home = document.getElementById('view-home');
                            if (home) home.classList.add('active');
                        }
                    }, 500); // 500ms safety delay
                });
            </script>

        </main>
    </div>

    <!-- CORE UTILITIES (Global Script) -->
    <script src="../assets/js/dashboard-utils.js"></script>

    <script type="module">
        // No import needed. switchView is global.
        const baseSwitchView = window.switchView;

        // Global Wrapper
        window.switchView = function (viewName, clickedLink) {
            if (baseSwitchView) baseSwitchView(viewName, clickedLink);
            // Link to Journal/Blog logic depending on view if needed
        };
    </script>

    <!-- SCRIPT LOGIC -->
    <script type="module">
        import { initWalletListener, addFundsMock } from '../assets/js/billing-logic.js';
        import { auth } from '../assets/js/firebase-config.js';

        // Initialize Wallet on Auth
        auth.onAuthStateChanged(user => {
            if (user) {
                initWalletListener(user.uid, (data) => {
                    const el = document.getElementById('wallet-balance');
                    if (el) el.textContent = '$' + (data.balance || 0).toFixed(2);
                });
            }
        });

        window.triggerAddFunds = async function () {
            if (confirm("Simulate adding $50 via Stripe?")) {
                const btn = document.querySelector('#view-wallet .btn-dash-primary');
                const originalText = btn.textContent;
                btn.textContent = "Processing...";
                btn.disabled = true;

                try {
                    const res = await addFundsMock(50);
                    if (res.success) alert(res.message);
                } catch (e) {
                    alert("Error: " + e.message);
                } finally {
                    btn.textContent = originalText;
                    btn.disabled = false;
                }
            }
        };
    </script>
</body>

</html>