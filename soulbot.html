<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SoulBot | Soulamore</title>
    <link
        href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;600;700&family=Plus+Jakarta+Sans:wght@300;400;500;600&display=swap"
        rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <style>
        /* --- THEME: MIDNIGHT VEGITO (AI Edition) --- */
        :root {
            --deep-space: #0f172a;
            --navy-glass: rgba(30, 41, 59, 0.8);
            --starlight: #e2e8f0;
            --peach-glow: #F49F75;
            --teal-glow: #4ECDC4;
            --gold-glow: #fbbf24;
            --alert-red: #ef4444;
            --border-glass: rgba(255, 255, 255, 0.1);
            --bot-bubble: rgba(255, 255, 255, 0.05);
            --user-bubble: linear-gradient(135deg, var(--teal-glow) 0%, #2a9d8f 100%);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Plus Jakarta Sans', sans-serif;
            background-color: var(--deep-space);
            color: var(--starlight);
            line-height: 1.6;
            overflow: hidden;
            height: 100vh;
            display: flex;
            flex-direction: column;
        }

        h1,
        h2,
        h3 {
            font-family: 'Outfit', sans-serif;
        }

        /* --- BACKGROUND --- */
        #particles {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 0;
        }

        .particle {
            position: absolute;
            background: white;
            border-radius: 50%;
            opacity: 0.2;
            animation: float linear infinite;
        }

        @keyframes float {
            from {
                transform: translateY(100vh);
            }

            to {
                transform: translateY(-10vh);
            }
        }

        /* --- VIEW MANAGER --- */
        .view-section {
            display: none;
            height: 100%;
            width: 100%;
            overflow-y: auto;
            scroll-behavior: smooth;
            position: relative;
            z-index: 10;
        }

        .view-section.active {
            display: block;
            animation: fadeIn 0.5s ease-out;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(20px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* --- NAV --- */
        nav {
            padding: 20px 30px;
            border-bottom: 1px solid var(--border-glass);
            background: rgba(15, 23, 42, 0.95);
            backdrop-filter: blur(10px);
            position: sticky;
            top: 0;
            z-index: 100;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .logo {
            font-size: 1.5rem;
            font-weight: 700;
            color: white;
            display: flex;
            align-items: center;
            gap: 10px;
            cursor: pointer;
        }

        .back-btn {
            color: rgba(255, 255, 255, 0.6);
            cursor: pointer;
            transition: 0.3s;
            font-size: 0.9rem;
        }

        .back-btn:hover {
            color: var(--teal-glow);
        }

        /* ================= PAGE 1: EXPLANATION ================= */
        .container {
            max-width: 900px;
            margin: 0 auto;
            padding: 60px 24px;
            text-align: center;
        }

        /* NEURAL ORB ANIMATION */
        .neural-orb-container {
            width: 200px;
            height: 200px;
            margin: 0 auto 40px;
            position: relative;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .neural-orb {
            width: 140px;
            height: 140px;
            border-radius: 50%;
            background: radial-gradient(circle at 30% 30%, #4ECDC4, #0f172a);
            box-shadow: 0 0 60px rgba(78, 205, 196, 0.6), inset 0 0 20px rgba(255, 255, 255, 0.5);
            position: relative;
            z-index: 2;
            animation: breathe 4s ease-in-out infinite;
        }

        .neural-wave {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 100%;
            height: 100%;
            border-radius: 50%;
            border: 2px solid rgba(78, 205, 196, 0.3);
            animation: ripple 3s linear infinite;
            z-index: 1;
        }

        .neural-wave:nth-child(2) {
            animation-delay: 1s;
        }

        .neural-wave:nth-child(3) {
            animation-delay: 2s;
        }

        @keyframes breathe {

            0%,
            100% {
                transform: scale(1);
                box-shadow: 0 0 60px rgba(78, 205, 196, 0.6);
            }

            50% {
                transform: scale(1.05);
                box-shadow: 0 0 80px rgba(78, 205, 196, 0.8);
            }
        }

        @keyframes ripple {
            0% {
                width: 140px;
                height: 140px;
                opacity: 1;
                border-width: 3px;
            }

            100% {
                width: 280px;
                height: 280px;
                opacity: 0;
                border-width: 0px;
            }
        }

        .hero h1 {
            font-size: 3.5rem;
            margin-bottom: 15px;
            background: linear-gradient(to right, #fff, #94a3b8);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .hero p {
            font-size: 1.2rem;
            opacity: 0.8;
            max-width: 600px;
            margin: 0 auto 40px;
        }

        .cta-btn {
            background: var(--teal-glow);
            color: #0f172a;
            padding: 15px 40px;
            border-radius: 50px;
            font-weight: 700;
            border: none;
            cursor: pointer;
            font-size: 1.1rem;
            transition: transform 0.2s, box-shadow 0.2s;
            box-shadow: 0 0 30px rgba(78, 205, 196, 0.4);
        }

        .cta-btn:hover {
            transform: scale(1.05);
            box-shadow: 0 0 50px rgba(78, 205, 196, 0.6);
        }

        .glass-card {
            background: var(--navy-glass);
            border: 1px solid var(--border-glass);
            padding: 40px;
            border-radius: 24px;
            text-align: left;
            margin-bottom: 30px;
            backdrop-filter: blur(10px);
            transition: 0.3s;
        }

        .glass-card:hover {
            transform: translateY(-5px);
            border-color: rgba(255, 255, 255, 0.2);
        }

        .grid-2 {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
        }

        .feature-list li {
            margin-bottom: 15px;
            display: flex;
            gap: 15px;
            align-items: flex-start;
            opacity: 0.9;
            font-size: 1.05rem;
        }

        .feature-list i {
            color: var(--teal-glow);
            margin-top: 5px;
        }

        .feature-list i.fa-times {
            color: var(--alert-red);
        }

        .section-title {
            font-size: 2rem;
            margin-bottom: 20px;
            color: white;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        /* ================= PAGE 2: CHAT INTERFACE ================= */
        .chat-layout {
            display: flex;
            flex-direction: column;
            height: 100%;
            max-width: 800px;
            margin: 0 auto;
            background: radial-gradient(circle at center, rgba(15, 23, 42, 0), #0f172a 100%);
        }

        .chat-window {
            flex: 1;
            overflow-y: auto;
            padding: 20px;
            display: flex;
            flex-direction: column;
            gap: 20px;
            scroll-behavior: smooth;
        }

        .message {
            max-width: 80%;
            padding: 15px 24px;
            border-radius: 24px;
            font-size: 1.05rem;
            line-height: 1.6;
            position: relative;
            animation: msgFade 0.6s ease-out;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
        }

        @keyframes msgFade {
            from {
                opacity: 0;
                transform: translateY(10px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .msg-bot {
            background: rgba(30, 41, 59, 0.6);
            border-bottom-left-radius: 4px;
            color: #e2e8f0;
            border: 1px solid rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(5px);
        }

        .msg-user {
            background: linear-gradient(135deg, #2dd4bf 0%, #0f766e 100%);
            border-bottom-right-radius: 4px;
            color: #fff;
            font-weight: 500;
            align-self: flex-end;
            box-shadow: 0 4px 20px rgba(45, 212, 191, 0.2);
        }

        /* Cards Injected by Bot */
        .suggestion-card {
            background: rgba(15, 23, 42, 0.8);
            border: 1px solid var(--teal-glow);
            padding: 15px;
            border-radius: 12px;
            margin-top: 10px;
            cursor: pointer;
            transition: 0.2s;
            display: flex;
            align-items: center;
            gap: 15px;
            max-width: 300px;
        }

        .suggestion-card:hover {
            background: rgba(78, 205, 196, 0.1);
            transform: translateX(5px);
        }

        .card-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: var(--starlight);
            color: #000;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
        }

        .crisis-alert {
            background: rgba(239, 68, 68, 0.1);
            border: 1px solid var(--alert-red);
            color: #fca5a5;
            padding: 24px;
            border-radius: 16px;
            text-align: center;
            margin-top: 10px;
            box-shadow: 0 0 30px rgba(239, 68, 68, 0.2);
        }

        /* Input Area */
        .input-area {
            padding: 24px;
            background: rgba(15, 23, 42, 0.95);
            border-top: 1px solid var(--border-glass);
            display: flex;
            gap: 15px;
            align-items: flex-end;
        }

        .chat-input {
            flex: 1;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid var(--border-glass);
            padding: 16px 20px;
            border-radius: 24px;
            color: white;
            outline: none;
            font-family: inherit;
            font-size: 1rem;
            resize: none;
            max-height: 120px;
            min-height: 56px;
            transition: 0.3s;
        }

        .chat-input:focus {
            border-color: var(--teal-glow);
            background: rgba(255, 255, 255, 0.08);
        }

        .send-btn {
            width: 56px;
            height: 56px;
            border-radius: 50%;
            background: var(--teal-glow);
            border: none;
            color: #0f172a;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: 0.2s;
            font-size: 1.2rem;
            box-shadow: 0 0 20px rgba(78, 205, 196, 0.3);
        }

        .send-btn:hover {
            transform: scale(1.1);
            box-shadow: 0 0 30px rgba(78, 205, 196, 0.5);
        }

        .typing-indicator {
            font-size: 0.9rem;
            color: var(--teal-glow);
            padding-left: 24px;
            margin-bottom: 10px;
            display: none;
            font-weight: 500;
            letter-spacing: 0.5px;
        }

        @media(max-width: 768px) {
            .grid-2 {
                grid-template-columns: 1fr;
            }

            .hero h1 {
                font-size: 2.5rem;
            }

            .neural-orb-container {
                width: 160px;
                height: 160px;
            }

            .neural-orb {
                width: 100px;
                height: 100px;
            }
        }
    </style>
</head>

<body>
    <!-- BACKGROUND PARTICLES -->
    <canvas id="particles"></canvas>

    <!-- HEADER (Injected) -->
    <!-- components.js handles injection -->

    <div id="view-landing" class="view-section active">
        <div class="container main-content">
            <!-- HERO SECTION -->
            <section class="hero">
                <div class="neural-orb-container">
                    <h1>SoulBot</h1>
                    <p>A calm AI companion that listens, understands, and gently guides.<br>When thoughts feel tangled,
                        SoulBot sits with you.</p>
                    <div style="display:flex; gap:15px; justify-content:center; flex-wrap:wrap;">
                        <button class="cta-btn" onclick="switchView('chat')">Talk to SoulBot</button>
                        <button class="cta-btn"
                            style="background:transparent; border:1px solid var(--teal-glow); color:var(--teal-glow); box-shadow:none;"
                            onclick="document.getElementById('about-section').scrollIntoView({behavior:'smooth'})">Learn
                            More</button>
                    </div>
            </section>

            <div id="about-section" style="margin-top:80px;"></div>

            <div class="grid-2">
                <div class="glass-card">
                    <h3 class="section-title"><i class="fas fa-check-circle" style="color:var(--teal-glow);"></i> What
                        SoulBot Is</h3>
                    <ul class="feature-list">
                        <li><i class="fas fa-check"></i> A non-judgmental reflection companion</li>
                        <li><i class="fas fa-check"></i> A thought organizer for when you're stuck</li>
                        <li><i class="fas fa-check"></i> A safe space to vent incomplete thoughts</li>
                        <li><i class="fas fa-check"></i> A gentle bridge to human support</li>
                    </ul>
                </div>
                <div class="glass-card" style="border-color: rgba(239, 68, 68, 0.3);">
                    <h3 class="section-title"><i class="fas fa-times-circle" style="color:var(--alert-red);"></i> What
                        It Is Not</h3>
                    <ul class="feature-list">
                        <li><i class="fas fa-times"></i> A therapist, psychologist, or doctor</li>
                        <li><i class="fas fa-times"></i> A crisis intervention service</li>
                        <li><i class="fas fa-times"></i> A motivational speaker or preacher</li>
                        <li><i class="fas fa-times"></i> A replacement for human connection</li>
                    </ul>
                </div>
            </div>

            <div class="glass-card" style="text-align:left;">
                <h3 class="section-title"><i class="fas fa-shield-alt"></i> Safety & Ethics</h3>
                <p style="opacity:0.9; margin-bottom:15px; font-size:1.1rem;">
                    SoulBot does not diagnose mental health conditions. It operates on a strict safety protocol.
                </p>
                <p style="opacity:0.8;">
                    It exists to listen, reflect, and guide you towards clarity. If you express thoughts of severe harm,
                    SoulBot will stop the conversation and provide immediate crisis resources. It is trained to be
                    gentle, non-alarmist, but firm on safety.
                </p>
            </div>
        </div>
    </div>

    <!-- VIEW 2: CHAT INTERFACE -->
    <div id="view-chat" class="view-section">
        <div class="chat-layout">
            <div class="chat-window" id="chatBox">
                <!-- Messages go here -->
            </div>

            <div class="typing-indicator" id="typingInd">
                <i class="fas fa-circle-notch fa-spin"></i> SoulBot is listening...
            </div>

            <div class="input-area">
                <textarea id="userInput" class="chat-input"
                    placeholder="You can start anywhere. Even with 'I don't know'." rows="1" oninput="autoResize(this)"
                    onkeydown="handleEnter(event)"></textarea>
                <button class="send-btn" onclick="sendMessage()"><i class="fas fa-paper-plane"></i></button>
            </div>
        </div>
    </div>

    <script type="module">
        import { GoogleGenerativeAI } from "https://esm.run/@google/generative-ai";

        // --- CONFIGURATION ---
        const API_KEY = "AIzaSyB9kvOpy4Aam-quPhOOfrlUuZDzSeD-BCE";
        const genAI = new GoogleGenerativeAI(API_KEY);
        const model = genAI.getGenerativeModel({ model: "gemini-1.5-flash" });

        // --- INTERNAL DATABASE (FOR MATCHING) ---
        const peers = [
            { name: "Aditya", tags: ["anxiety", "stress", "work", "overthinking"], role: "Peer Listener" },
            { name: "Lakshit", tags: ["expat", "lonely", "moving", "abroad", "home"], role: "Expat Peer" },
            { name: "Renu", tags: ["body", "pain", "health", "yoga", "breathing"], role: "Yoga Instructor" }
        ];

        const psychs = [
            { name: "Dr. Sharma", tags: ["depression", "trauma", "deep", "therapy"], role: "Clinical Psychologist" }
        ];

        // --- SYSTEM PROMPT ---
        const SYSTEM_INSTRUCTION = `
            You are SoulBot, a calm, emotionally intelligent reflection companion by Soulamore.
            
            TONE:
            - A calm friend at 2:14 AM.
            - Never alarmist, never preachy, never "You should".
            - Reflective, curious, optional.
            - Short, gentle responses. Max 2-3 sentences usually.

            GOAL:
            - Help the user slow down and untangle thoughts.
            - "Let's separate what happened from what it made you feel."
            - If they are stuck, gently suggest resources (Peers/Psychs) but don't push.

            PROTOCOL (R.E.S.T):
            1. REFLECT: Mirror their emotion gently.
            2. EXPAND: Ask ONE simple, open question. 
            3. SLOW: Keep it breathable.
            4. TRANSITION: If repeated distress, suggest human support.

            CRISIS HANDLING:
            - If user mentions suicide, self-harm, or killing themselves, reply ONLY with: "CRISIS_ALERT". Do not say anything else.
        `;

        // --- STATE ---
        let chatHistory = [];

        // --- UI FUNCTIONS ---
        window.switchView = function (viewId) {
            document.querySelectorAll('.view-section').forEach(el => el.classList.remove('active'));
            document.getElementById('view-' + viewId).classList.add('active');
            if (viewId === 'chat' && chatHistory.length === 0) {
                setTimeout(() => addBotMessage("You don‚Äôt have to explain everything perfectly. Just start where you are."), 600);
            }
        };

        function scrollToBottom() {
            const box = document.getElementById('chatBox');
            box.scrollTop = box.scrollHeight;
        }

        function addBotMessage(text) {
            const div = document.createElement('div');
            div.className = 'message msg-bot';
            div.innerHTML = text.replace(/\n/g, '<br>');
            document.getElementById('chatBox').appendChild(div);
            scrollToBottom();
            chatHistory.push({ role: "model", parts: [{ text: text }] });
        }

        function addUserMessage(text) {
            const div = document.createElement('div');
            div.className = 'message msg-user';
            div.innerText = text;
            document.getElementById('chatBox').appendChild(div);
            scrollToBottom();
            chatHistory.push({ role: "user", parts: [{ text: text }] });
        }

        function showTyping(show) {
            document.getElementById('typingInd').style.display = show ? 'block' : 'none';
            scrollToBottom();
        }

        window.autoResize = function (el) {
            el.style.height = 'auto'; el.style.height = el.scrollHeight + 'px';
        };

        window.handleEnter = function (e) {
            if (e.key === 'Enter' && !e.shiftKey) {
                e.preventDefault();
                sendMessage();
            }
        };

        // --- INTELLIGENCE ENGINE ---
        window.sendMessage = async function () {
            const input = document.getElementById('userInput');
            const text = input.value.trim();
            if (!text) return;

            input.value = "";
            input.style.height = 'auto';
            addUserMessage(text);

            // 1. SAFETY CHECK (Client Side First Line of Defense)
            const crisisKeywords = ['suicide', 'kill myself', 'die', 'end it all', 'self harm'];
            if (crisisKeywords.some(w => text.toLowerCase().includes(w))) {
                renderCrisisCard();
                return;
            }

            // 2. CONTEXT MATCHING (Internal Ecosystem)
            const lowerText = text.toLowerCase();
            let resourceCard = null;

            // Check Peers
            const matchedPeer = peers.find(p => p.tags.some(tag => lowerText.includes(tag)));
            if (matchedPeer) {
                resourceCard = createCard(matchedPeer.name, matchedPeer.role, `/peer/${matchedPeer.name.toLowerCase()}`);
            }

            // Check Psych
            if (lowerText.includes("therapy") || lowerText.includes("psychologist") || lowerText.includes("depression")) {
                resourceCard = createCard("Dr. Sharma", "Clinical Psychologist", "/join-psychologist");
            }

            // 3. API CALL
            showTyping(true);
            try {
                const chat = model.startChat({
                    history: [
                        { role: "user", parts: [{ text: SYSTEM_INSTRUCTION }] },
                        { role: "model", parts: [{ text: "Understood. I am ready." }] },
                        ...chatHistory
                    ]
                });

                const result = await chat.sendMessage(text);
                const response = result.response.text();

                showTyping(false);

                if (response.includes("CRISIS_ALERT")) {
                    renderCrisisCard();
                } else {
                    addBotMessage(response);
                    if (resourceCard) document.getElementById('chatBox').appendChild(resourceCard);
                }

            } catch (error) {
                showTyping(false);
                addBotMessage("I'm having trouble connecting to the cloud. But I'm still here listening.");
                console.error(error);
            }
        };

        // --- COMPONENT RENDERERS ---
        function renderCrisisCard() {
            const div = document.createElement('div');
            div.className = 'crisis-alert';
            div.innerHTML = `
                <div style="font-size:1.5rem; margin-bottom:10px;">‚ù§Ô∏è</div>
                <strong>I hear how much pain you are in.</strong><br>
                Please, let's keep you safe.<br><br>
                <a href="tel:14416" style="display:inline-block; background:var(--alert-red); color:white; padding:10px 20px; border-radius:30px; text-decoration:none; font-weight:700;">üìû Call Tele-MANAS (14416)</a>
            `;
            document.getElementById('chatBox').appendChild(div);
            scrollToBottom();
        }

        function createCard(name, role, link) {
            const div = document.createElement('div');
            div.className = 'suggestion-card';
            div.innerHTML = `
                <div class="card-avatar">${name[0]}</div>
                <div>
                    <div style="font-weight:700; color:white;">${name}</div>
                    <div style="font-size:0.8rem; opacity:0.7;">${role}</div>
                </div>
                <i class="fas fa-chevron-right" style="margin-left:auto; opacity:0.5;"></i>
            `;
            div.onclick = () => alert(`Redirecting to ${name}'s profile...`); // In real app, use window.location
            return div;
        }

        // --- PARTICLES ---
        const pContainer = document.getElementById('particles');
        for (let i = 0; i < 30; i++) {
            let p = document.createElement('div'); p.classList.add('particle');
            p.style.left = Math.random() * 100 + 'vw'; p.style.width = Math.random() * 4 + 'px';
            p.style.height = p.style.width; p.style.animationDuration = Math.random() * 20 + 10 + 's';
            p.style.opacity = Math.random() * 0.3; pContainer.appendChild(p);
        }
    </script>
</body>

</html>