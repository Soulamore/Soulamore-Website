<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Soulamore Blog Post">
    <title>Soulamore Stories</title>

    <!-- Open Graph / Facebook -->
    <meta property="og:type" content="article">
    <meta property="og:site_name" content="Soulamore">

    <!-- Fonts -->
    <link
        href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;600;700&family=Lora:ital,wght@0,400;0,500;0,600;1,400&family=Plus+Jakarta+Sans:wght@400;500;600;700&display=swap"
        rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="../assets/css/global.css">

    <style>
        * {
            box-sizing: border-box;
        }

        html,
        body {
            overflow-x: hidden;
            /* Prevent horizontal scrolling on mobile */
        }

        body {
            background-color: #0f172a;
        }

        .post-container {
            width: 100%;
            max-width: 800px;
            margin: 0 auto;
            padding: 40px 20px 80px;
            /* Reduced from 140px */
            position: relative;
            z-index: 10;
        }

        /* --- POST HERO --- */
        .post-header {
            text-align: center;
            margin-bottom: 40px;
        }

        .post-meta {
            font-family: 'Plus Jakarta Sans', sans-serif;
            font-size: 0.9rem;
            color: #94a3b8;
            margin-bottom: 20px;
            text-transform: uppercase;
            letter-spacing: 1px;
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 10px;
        }

        .post-tag {
            background: rgba(78, 205, 196, 0.1);
            color: var(--teal-glow);
            padding: 4px 10px;
            border-radius: 4px;
            font-weight: 600;
        }

        .post-title {
            font-family: 'Outfit', sans-serif;
            font-size: 3rem;
            line-height: 1.2;
            margin-bottom: 30px;
            background: linear-gradient(to right, #fff, #fbbf24);
            background-clip: text;
            /* Standard */
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .hero-image {
            width: 100%;
            height: 400px;
            border-radius: 20px;
            overflow: hidden;
            border: 1px solid rgba(255, 255, 255, 0.1);
            margin-bottom: 50px;
            box-shadow: 0 20px 50px rgba(0, 0, 0, 0.4);
        }

        .hero-image img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        /* --- CONTENT BODY --- */
        .post-body {
            font-family: 'Lora', serif;
            font-size: 1.2rem;
            line-height: 1.8;
            color: #cbd5e1;
            /* Almost white for readability */
        }

        .post-body p {
            margin-bottom: 25px;
        }

        .post-body h2,
        .post-body h3 {
            font-family: 'Outfit', sans-serif;
            color: #fff;
            margin-top: 40px;
            margin-bottom: 20px;
        }

        .post-body h2 {
            font-size: 2rem;
        }

        .post-body h3 {
            font-size: 1.6rem;
            color: var(--peach-glow);
        }

        .post-body blockquote {
            border-left: 4px solid var(--teal-glow);
            padding-left: 20px;
            margin: 40px 0;
            font-style: italic;
            font-size: 1.4rem;
            color: var(--teal-glow);
            background: rgba(78, 205, 196, 0.05);
            padding: 20px 20px 20px 30px;
            border-radius: 0 10px 10px 0;
        }

        .post-body ul,
        .post-body ol {
            margin-bottom: 25px;
            padding-left: 20px;
        }

        .post-body li {
            margin-bottom: 10px;
        }

        .post-body strong {
            color: #fff;
            font-weight: 600;
        }

        /* --- ENGAGEMENT BAR (STICKY) --- */
        .engagement-bar {
            position: fixed;
            left: calc(50% - 520px);
            top: 250px;
            display: flex;
            flex-direction: column;
            gap: 20px;
            background: rgba(30, 41, 59, 0.8);
            backdrop-filter: blur(12px);
            padding: 15px;
            border-radius: 50px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            transition: 0.3s;
            opacity: 0;
            transform: translateX(-20px);
            animation: slideInLeft 0.5s 0.5s ease-out forwards;
            z-index: 1000;
        }

        @keyframes slideInLeft {
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }

        .engage-btn {
            width: 45px;
            height: 45px;
            border-radius: 50%;
            background: transparent;
            border: 1px solid rgba(255, 255, 255, 0.1);
            color: #94a3b8;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: 0.2s;
            font-size: 1.1rem;
            position: relative;
        }

        .engage-btn:hover {
            color: var(--teal-glow);
            border-color: var(--teal-glow);
            background: rgba(78, 205, 196, 0.1);
            transform: scale(1.1);
        }

        .engage-btn.like-btn.active {
            color: #ef4444;
            border-color: #ef4444;
            background: rgba(239, 68, 68, 0.1);
        }

        .engage-count {
            position: absolute;
            top: -5px;
            right: -10px;
            font-size: 0.7rem;
            background: var(--teal-glow);
            color: var(--deep-space);
            font-weight: 700;
            padding: 2px 7px;
            border-radius: 10px;
        }

        /* --- AUTHOR CARD --- */
        .author-box {
            background: rgba(30, 41, 59, 0.6);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 16px;
            padding: 30px;
            margin-top: 80px;
            display: flex;
            align-items: center;
            gap: 20px;
        }

        .author-avatar {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            background: #334155;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2rem;
            color: rgba(255, 255, 255, 0.5);
            flex-shrink: 0;
        }

        .author-info h4 {
            font-size: 1.3rem;
            margin-bottom: 5px;
            color: #fff;
        }

        .author-role {
            color: var(--teal-glow);
            font-size: 0.9rem;
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-bottom: 10px;
            display: block;
        }

        .author-bio {
            color: #94a3b8;
            font-size: 0.95rem;
            line-height: 1.5;
        }

        /* --- MOBILE --- */
        @media (max-width: 1100px) {
            .engagement-bar {
                position: fixed;
                top: auto;
                bottom: 30px;
                left: 50%;
                transform: translateX(-50%) !important;
                flex-direction: row;
                width: auto;
                z-index: 1000;
                box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
                border-color: var(--teal-glow);
            }

            .post-title {
                font-size: 2.2rem;
            }

            .hero-image {
                height: 250px;
            }
        }

        /* --- SMARTPHONE SPECIFIC --- */
        @media (max-width: 768px) {
            .post-container {
                padding: 30px 20px 80px;
            }

            .post-body {
                font-size: 1.1rem;
                overflow-wrap: break-word;
                /* Ensure long words break instead of overflowing */
                word-wrap: break-word;
            }

            .post-body blockquote {
                padding: 15px 15px 15px 20px;
                /* Reduce padding on mobile */
                margin: 30px 0;
                font-size: 1.2rem;
                /* Reduce font size slightly */
            }

            .author-box {
                flex-direction: column;
                text-align: center;
                padding: 20px;
            }

            .author-box a {
                margin: 15px auto 0 !important;
            }
        }
    </style>
    <link rel="icon" href="../assets/images/favicon_symbol.png" type="image/x-icon">
</head>

<body>
    <div id="app-shell">
        <div id="shell-fixed">
            <header></header>
        </div>

        <!-- PARTICLES -->
        <div id="particles"
            style="position:fixed; top:0; left:0; width:100%; height:100%; pointer-events:none; z-index:-1;"></div>

        <main id="shell-content">
            <!-- MAIN CONTENT -->
            <div class="post-container fade-in" id="mainContent">
                <!-- Content injected by JS -->
                <div style="height: 60vh; display:flex; align-items:center; justify-content:center;">
                    <p>Loading post...</p>
                </div>
            </div>

            <!-- STICKY SIDEBAR (Engagement) -->
            <aside class="engagement-bar" id="engageBar" style="display:none;">
                <button class="engage-btn like-btn" onclick="toggleLike(this)">
                    <i class="fas fa-heart"></i>
                    <span class="engage-count" id="likeCount">0</span>
                </button>
                <button class="engage-btn" onclick="copyLink()">
                    <i class="fas fa-link"></i>
                </button>
                <button class="engage-btn" onclick="shareTwitter()">
                    <i class="fab fa-twitter"></i>
                </button>
                <button class="engage-btn" onclick="scrollToComments()">
                    <i class="fas fa-comment"></i>
                </button>
            </aside>
        </main>

        <!-- FOOTER -->
        <footer></footer>
    </div>

    <script src="../assets/js/components.js"></script>
    <script type="module">
        import { getPostById } from '../assets/js/blog-data.js';
        import { db, doc, getDoc, setDoc, updateDoc, increment } from '../assets/js/firebase-config.js';

        // 1. Get ID from URL
        const params = new URLSearchParams(window.location.search);
        const postId = params.get('id');
        const container = document.getElementById('mainContent');
        const engageBar = document.getElementById('engageBar');

        let isLikeUpdating = false;

        async function initPost() {
            if (!postId) {
                container.innerHTML = `<div style="text-align:center;"><h2>Post not found</h2><a href="blogs.html" style="color:var(--teal-glow);">Back to Stories</a></div>`;
                return;
            }

            const post = getPostById(postId);

            if (post) {
                // UPDATE METADATA
                document.title = `${post.title} | Soulamore Stories`;

                // RENDER (Author portion is already correctly updated in preceding chunks, but we re-render here)
                container.innerHTML = `
                    <div class="post-header">
                        <div class="post-meta">
                            <span class="post-tag">${post.topic}</span>
                            <span>•</span>
                            <span>${post.readTime} Read</span>
                            <span>•</span>
                            <span>${post.date}</span>
                        </div>
                        <h1 class="post-title">${post.title}</h1>
                    </div>

                    <div class="hero-image">
                        <img src="${post.image}" alt="${post.title}">
                    </div>

                    <article class="post-body">
                        ${post.content}
                    </article>

                    <div class="author-box">
                        ${post.authorImage ? '<img src="' + post.authorImage + '" alt="' + post.author + '" style="width: 80px; height: 80px; border-radius: 50%; object-fit: cover; flex-shrink: 0;">' : '<div class="author-avatar"><i class="fas ' + (post.type === 'Psychologist' ? 'fa-user-md' : 'fa-user') + '"></i></div>'}
                        <div class="author-info">
                            <span class="author-role">${post.authorRole}</span>
                            <h4>${post.author}</h4>
                            <p class="author-bio">${post.authorBio}</p>
                        </div>
                        ${post.authorLinkedin ? '<a href="' + post.authorLinkedin + '" target="_blank" style="margin-left: auto; color: var(--teal-glow); text-decoration: none; font-size: 1rem; font-weight: 500; display: flex; align-items: center; gap: 8px; padding: 10px 24px; border: 1px solid var(--teal-glow); border-radius: 50px; transition: 0.3s;"><i class="fab fa-linkedin" style="font-size: 1.1rem;"></i> Connect</a>' : ''}
                    </div>
                `;

                // Show Engagement Bar
                engageBar.style.display = 'flex';

                // Fetch dynamic likes
                try {
                    const postRef = doc(db, 'blogs', postId);
                    const docSnap = await getDoc(postRef);
                    if (docSnap.exists()) {
                        document.getElementById('likeCount').innerText = docSnap.data().likes || post.likes || 0;
                    } else {
                        // Initialize it in DB on first load
                        await setDoc(postRef, { likes: post.likes || 0 });
                        document.getElementById('likeCount').innerText = post.likes || 0;
                    }
                } catch (err) {
                    console.error("Firebase error loading likes:", err);
                    document.getElementById('likeCount').innerText = post.likes || 0; // fallback
                }

            } else {
                container.innerHTML = `<div style="text-align:center;"><h2>Post not found</h2><a href="blogs.html" style="color:var(--teal-glow);">Back to Stories</a></div>`;
            }
        }

        initPost();

        // ENGAGEMENT FUNCTIONS
        window.toggleLike = async (btn) => {
            if (isLikeUpdating) return;
            isLikeUpdating = true;

            btn.classList.toggle('active');
            const countEl = document.getElementById('likeCount');
            let count = parseInt(countEl.innerText);

            try {
                const postRef = doc(db, 'blogs', postId);
                if (btn.classList.contains('active')) {
                    count++;
                    countEl.innerText = count; // Optimistic update
                    await updateDoc(postRef, { likes: increment(1) });
                } else {
                    count--;
                    countEl.innerText = count; // Optimistic update
                    await updateDoc(postRef, { likes: increment(-1) });
                }
            } catch (err) {
                console.error("Failed to update likes:", err);
                // Revert optimistic update nicely
                btn.classList.toggle('active');
                if (btn.classList.contains('active')) countEl.innerText = count + 1;
                else countEl.innerText = count - 1;
            } finally {
                isLikeUpdating = false;
            }
        }

        window.copyLink = () => {
            navigator.clipboard.writeText(window.location.href);
            alert('Link copied to clipboard!');
        }

        window.shareTwitter = () => {
            const url = encodeURIComponent(window.location.href);
            const text = encodeURIComponent(document.title);
            window.open(`https://twitter.com/intent/tweet?url=${url}&text=${text}`, '_blank');
        }

        window.scrollToComments = () => {
            alert('Comments section coming soon!');
        }
    </script>
</body>

</html>