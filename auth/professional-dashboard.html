<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Professional Hub | Soulamore</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <link
        href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;500;600;700&family=Plus+Jakarta+Sans:wght@400;500;600;700&display=swap"
        rel="stylesheet">
    <!-- Premium Blog Fonts -->
    <link
        href="https://fonts.googleapis.com/css2?family=Playfair+Display:ital,wght@0,400;0,700;1,400&family=Lora:ital,wght@0,400;0,600;1,400&family=Patrick+Hand&family=Inter:wght@400;600&display=swap"
        rel="stylesheet">
    <!-- Quill Text Editor -->
    <link href="https://cdn.quilljs.com/1.3.6/quill.snow.css" rel="stylesheet">
    <script src="https://cdn.quilljs.com/1.3.6/quill.js"></script>
    <link rel="stylesheet" href="../assets/css/global.css">

    <style>
        /* --- THEME: CLINICAL CALM (Professional) --- */
        :root {
            --deep-space: #0f172a;
            --navy-glass: rgba(15, 23, 42, 0.95);
            --starlight: #f8fafc;
            --clinical-blue: #0ea5e9;
            --soft-teal: #2dd4bf;
            --border-glass: rgba(255, 255, 255, 0.1);
        }

        body {
            font-family: 'Plus Jakarta Sans', sans-serif;
            background-color: var(--deep-space);
            color: var(--starlight);
            margin: 0;
            overflow: hidden;
        }

        #dashboard-container {
            display: flex;
            height: 100vh;
        }

        /* --- SIDEBAR --- */
        .sidebar {
            width: 280px;
            background: rgba(15, 23, 42, 0.98);
            border-right: 1px solid var(--border-glass);
            display: flex;
            flex-direction: column;
            padding: 30px 20px;
            z-index: 10;
        }

        .logo-area {
            margin-bottom: 40px;
            display: flex;
            align-items: center;
        }

        .logo-img {
            height: 35px;
            width: auto;
        }

        .nav-item {
            padding: 14px 15px;
            margin-bottom: 8px;
            border-radius: 8px;
            color: #94a3b8;
            cursor: pointer;
            transition: 0.3s;
            display: flex;
            align-items: center;
            gap: 12px;
            font-size: 0.95rem;
            text-decoration: none;
            font-weight: 500;
        }

        .nav-item:hover,
        .nav-item.active {
            background: rgba(14, 165, 233, 0.1);
            color: var(--clinical-blue);
        }

        .user-mini {
            margin-top: auto;
            border-top: 1px solid var(--border-glass);
            padding-top: 20px;
            display: flex;
            align-items: center;
            gap: 12px;
        }

        /* --- MAIN CONTENT --- */
        .main-content {
            flex: 1;
            padding: 40px;
            overflow-y: auto;
            background: radial-gradient(circle at top right, rgba(14, 165, 233, 0.1), transparent 40%);
        }

        .page-title {
            font-family: 'Outfit', sans-serif;
            font-size: 2rem;
            margin-bottom: 30px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        /* --- FORMS & CARDS --- */
        .pro-card {
            background: rgba(30, 41, 59, 0.6);
            border: 1px solid var(--border-glass);
            border-radius: 16px;
            padding: 30px;
            margin-bottom: 30px;
        }

        .form-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 20px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-label {
            display: block;
            margin-bottom: 8px;
            font-size: 0.9rem;
            color: #cbd5e1;
            font-weight: 600;
        }

        .form-input,
        .form-select,
        textarea {
            width: 100%;
            padding: 12px;
            background: rgba(15, 23, 42, 0.8);
            border: 1px solid var(--border-glass);
            border-radius: 8px;
            color: white;
            font-family: inherit;
        }

        .form-input:focus {
            outline: none;
            border-color: var(--clinical-blue);
        }

        .btn-primary {
            background: var(--clinical-blue);
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: 0.3s;
        }

        .btn-primary:hover {
            background: #0284c7;
        }

        /* --- SMART PROFILE PIC WIDGET --- */
        .pic-upload-area {
            border: 2px dashed var(--border-glass);
            border-radius: 12px;
            padding: 30px;
            text-align: center;
            cursor: pointer;
            transition: 0.3s;
            position: relative;
            overflow: hidden;
            background: rgba(0, 0, 0, 0.2);
        }

        .pic-upload-area:hover {
            border-color: var(--clinical-blue);
            background: rgba(14, 165, 233, 0.05);
        }

        .preview-img {
            max-width: 150px;
            border-radius: 50%;
            border: 4px solid var(--clinical-blue);
            margin: 10px auto;
            display: none;
            box-shadow: 0 0 20px rgba(14, 165, 233, 0.3);
        }

        .processing-overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(15, 23, 42, 0.9);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            display: none;
        }

        /* --- TABS --- */
        .tab-content {
            display: none;
            animation: fadeIn 0.4s ease-out;
        }

        .tab-content.active {
            display: block;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* --- BLOG WIDGET --- */
        .blog-list-item {
            display: flex;
            justify-content: space-between;
            padding: 15px;
            border-bottom: 1px solid var(--border-glass);
            align-items: center;
        }

        .status-badge {
            padding: 4px 10px;
            border-radius: 50px;
            font-size: 0.75rem;
            background: rgba(16, 185, 129, 0.2);
            color: #34d399;
            border: 1px solid rgba(16, 185, 129, 0.3);
        }

        /* --- BLOG WRITER PREMIUM STYLES --- */
        .blog-sidebar {
            background: rgba(15, 23, 42, 0.6);
            border-right: 1px solid rgba(255, 255, 255, 0.05);
            padding: 25px;
            display: flex;
            flex-direction: column;
            backdrop-filter: blur(10px);
        }

        .blog-list-item {
            padding: 15px;
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-bottom: 8px;
            border: 1px solid transparent;
        }

        .blog-list-item:hover {
            background: rgba(255, 255, 255, 0.03);
            transform: translateX(5px);
        }

        .blog-list-item.active {
            background: linear-gradient(90deg, rgba(45, 212, 191, 0.1) 0%, transparent 100%);
            border-left: 3px solid var(--teal-glow);
        }

        /* Quill Dark Mode Overrides - CRITICAL FIX */
        .ql-snow .ql-stroke {
            stroke: var(--starlight) !important;
        }

        .ql-snow .ql-fill,
        .ql-snow .ql-stroke.ql-fill {
            fill: var(--starlight) !important;
        }

        .ql-picker {
            color: var(--starlight) !important;
        }

        .ql-picker-options {
            background-color: #1e293b !important;
            border: 1px solid rgba(255, 255, 255, 0.1) !important;
        }

        .ql-picker-item {
            color: var(--starlight) !important;
        }

        /* Editor Canvas - PAPER MODE DEFAULT */
        .editor-wrapper {
            background: #ffffff;
            border-radius: 4px;
            display: flex;
            flex-direction: column;
            min-height: 800px;
            /* A4-ish height */
            position: relative;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.3);
            transition: all 0.3s ease;
            max-width: 850px;
            /* Standard readable width */
            margin: 0 auto;
        }

        /* Dark Mode Override Class */
        .editor-wrapper.dark-mode-canvas {
            background: #1e1e1e;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.5);
        }

        .editor-wrapper.dark-mode-canvas #editor {
            color: #e2e8f0;
        }

        .editor-wrapper.dark-mode-canvas .ql-picker {
            color: #e2e8f0 !important;
        }

        .editor-wrapper.dark-mode-canvas .ql-stroke {
            stroke: #e2e8f0 !important;
        }

        /* Light Mode Text Colors (Default) */
        #editor {
            border: none !important;
            font-size: 1.15rem;
            line-height: 1.9;
            color: #1e293b;
            /* Dark text on white paper */
            padding: 60px 40px !important;
            /* More breathing room */
        }

        /* Toolbar adjustments for Light Paper */
        #toolbar-container {
            border-bottom: 1px solid rgba(0, 0, 0, 0.05) !important;
            opacity: 0.4;
        }

        #toolbar-container:hover {
            opacity: 1;
        }

        .ql-snow .ql-stroke {
            stroke: #64748b !important;
        }

        /* Slate stroke for light mode */
        .ql-snow .ql-fill {
            fill: #64748b !important;
        }

        .ql-picker {
            color: #64748b !important;
        }

        /* Typography Presets */
        .font-serif {
            font-family: 'Lora', serif !important;
        }

        .font-display {
            font-family: 'Playfair Display', serif !important;
        }

        .font-sans {
            font-family: 'Inter', sans-serif !important;
        }

        /* --- CLEAN BLOGGER EDITOR STYLES --- */
        :root {
            --editor-bg: #f3f4f6;
            --paper-bg: #ffffff;
            --sidebar-bg: #ffffff;
            --border-color: #e5e7eb;
            --accent-orange: #f97316;
            /* Blogger orange-ish */
            --text-main: #1f2937;
        }

        /* Hub Styles */
        .hub-card {
            background: white;
            border: 1px solid var(--border-color);
            border-radius: 8px;
            padding: 15px;
            display: flex;
            align-items: center;
            margin-bottom: 10px;
            transition: 0.2s;
            cursor: pointer;
        }

        .hub-card:hover {
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05);
            border-color: #d1d5db;
        }

        /* Editor Layout Grid */
        .editor-layout {
            display: grid;
            grid-template-rows: 60px 40px 1fr;
            /* Header, Toolbar, Content */
            height: 100vh;
            background: var(--editor-bg);
            color: var(--text-main);
        }

        /* 1. Global Header */
        .editor-header {
            background: white;
            border-bottom: 1px solid var(--border-color);
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0 20px;
            z-index: 20;
        }

        .editor-title-input {
            font-size: 1.2rem;
            font-weight: 600;
            border: none;
            outline: none;
            color: var(--text-main);
            width: 300px;
            font-family: 'Outfit', sans-serif;
        }

        .editor-title-input:hover {
            background: #f9fafb;
        }

        /* 2. Fixed Toolbar */
        .editor-toolbar-area {
            background: white;
            border-bottom: 1px solid var(--border-color);
            display: flex;
            align-items: center;
            padding: 0 20px;
            z-index: 10;
        }

        /* Override Quill Toolbar borders to blend in */
        .ql-toolbar.ql-snow {
            border: none !important;
            padding: 8px 0 !important;
        }

        /* 3. Main Content Area (3 Columns) */
        .editor-main {
            display: grid;
            grid-template-columns: 250px 1fr 300px;
            /* Nav | Paper | Settings */
            overflow: hidden;
            height: 100%;
        }

        /* Left Sidebar (Nav) */
        .editor-left-sidebar {
            background: var(--sidebar-bg);
            border-right: 1px solid var(--border-color);
            padding: 20px;
            overflow-y: auto;
        }

        /* Center Canvas (The Paper) */
        .editor-canvas-area {
            background: var(--editor-bg);
            padding: 40px;
            overflow-y: auto;
            display: flex;
            justify-content: center;
        }

        .paper-sheet {
            background: var(--paper-bg);
            width: 850px;
            /* A4-ish width */
            min-height: 1000px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
            padding: 60px;
            border-radius: 2px;
            color: #1f2937;
        }

        #editor {
            border: none !important;
            font-size: 1.1rem;
            line-height: 1.8;
            padding: 0 !important;
            min-height: 500px;
        }

        /* Right Sidebar (Settings) */
        .editor-right-sidebar {
            background: var(--sidebar-bg);
            border-left: 1px solid var(--border-color);
            display: flex;
            flex-direction: column;
            overflow-y: auto;
        }

        /* Accordion Items in Right Sidebar */
        .settings-item {
            border-bottom: 1px solid var(--border-color);
        }

        .settings-header {
            padding: 15px 20px;
            font-size: 0.9rem;
            font-weight: 600;
            color: #4b5563;
            cursor: pointer;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .settings-header:hover {
            background: #f9fafb;
            color: var(--accent-orange);
        }

        .settings-content {
            padding: 0 20px 20px;
            display: none;
            /* Hidden by default */
        }

        .settings-content.open {
            display: block;
        }

        /* Form elements for settings */
        .setting-input {
            width: 100%;
            padding: 8px;
            border: 1px solid #d1d5db;
            border-radius: 4px;
            font-size: 0.85rem;
            margin-top: 5px;
        }

        /* Buttons */
        .btn-draft {
            background: #e5e7eb;
            color: #374151;
            padding: 8px 16px;
            border-radius: 4px;
            border: none;
            font-weight: 600;
            cursor: pointer;
            margin-right: 10px;
            font-size: 0.85rem;
        }

        .btn-draft:hover {
            background: #d1d5db;
        }

        .btn-publish {
            background: var(--accent-orange);
            color: white;
            padding: 8px 20px;
            border-radius: 4px;
            border: none;
            font-weight: 600;
            cursor: pointer;
            font-size: 0.85rem;
            box-shadow: 0 2px 5px rgba(249, 115, 22, 0.3);
        }

        .btn-publish:hover {
            background: #ea580c;
        }
    </style>
</head>

<body>
    <div id="dashboard-container">
        <!-- SIDEBAR -->
        <div class="sidebar">
            <div class="logo-area">
                <img src="../assets/images/logo.png" alt="Soulamore" class="logo-img">
            </div>

            <div class="nav-item active" onclick="showTab('home')"><i class="fas fa-chart-line"></i> Dashboard</div>
            <div class="nav-item" onclick="showTab('profile')"><i class="fas fa-user-edit"></i> Edit Profile</div>
            <div class="nav-item" onclick="showTab('calendar')"><i class="fas fa-calendar-alt"></i> Calendar Settings
            </div>
            <div class="nav-item" onclick="showTab('blogs')"><i class="fas fa-pen-fancy"></i> Write Blogs</div>
            <div class="nav-item" onclick="showTab('reviews')"><i class="fas fa-heart"></i> Client Love</div>
            <div class="nav-item" onclick="showTab('clients')"><i class="fas fa-users"></i> My Clients</div>
            <div class="nav-item" onclick="showTab('guidelines')"><i class="fas fa-book-open"></i> Session Guidelines
            </div>
            <div class="nav-item" onclick="showTab('journal')"><i class="fas fa-book"></i> Private Journal</div>

            <div class="user-mini">
                <div
                    style="width:35px; height:35px; background:#334155; border-radius:50%; display:flex; align-items:center; justify-content:center;">
                    D</div>
                <div>
                    <div style="font-size:0.9rem; font-weight:600;">Dr. Example</div>
                    <div style="font-size:0.75rem; opacity:0.6; color:#2dd4bf;">Online</div>
                </div>
            </div>
        </div>

        <!-- MAIN -->
        <div class="main-content">

            <!-- BLOG SYSTEM ROOT (Refactored) -->
            <div id="tab-blogs" class="tab-content"
                style="padding:0; height:100vh; overflow:hidden; background:var(--deep-space);">

                <!-- VIEW 1: BLOG HUB (Simplified) -->
                <div id="blog-hub-view"
                    style="padding: 40px; max-width: 1000px; margin: 0 auto; height: 100%; overflow-y: auto;">
                    <div
                        style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 30px;">
                        <h1 style="color: white; font-family: 'Outfit', sans-serif;">Blog Management</h1>
                        <button onclick="createNewDraft()"
                            style="background: var(--teal-glow); color: #0f172a; border: none; padding: 12px 24px; border-radius: 50px; font-weight: 700; cursor: pointer; display: flex; align-items: center; gap: 10px;">
                            <i class="fas fa-plus"></i> Create New Blog
                        </button>
                    </div>

                    <div style="background: white; border-radius: 12px; overflow: hidden; min-height: 400px;">
                        <div style="padding: 20px; border-bottom: 1px solid #e2e8f0; display: flex; gap: 20px;">
                            <span
                                style="font-weight: 600; color: #0f172a; border-bottom: 2px solid var(--teal-glow); padding-bottom: 18px;">All
                                Posts</span>
                            <span style="color: #64748b; cursor: pointer;">Drafts</span>
                            <span style="color: #64748b; cursor: pointer;">Published</span>
                        </div>
                        <div id="hub-post-list" style="padding: 20px;">
                            <!-- Dynamic Content Here -->
                            <div class="hub-card">
                                <div
                                    style="width: 50px; height: 50px; background: #e2e8f0; border-radius: 4px; margin-right: 15px;">
                                </div>
                                <div style="flex: 1;">
                                    <h4 style="margin: 0; color: #1f2937;">Untitled Draft</h4>
                                    <div style="font-size: 0.8rem; color: #6b7280;">Last edited: Just now</div>
                                </div>
                                <span
                                    style="font-size: 0.75rem; background: #f3f4f6; color: #4b5563; padding: 4px 8px; border-radius: 4px;">Draft</span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- VIEW 2: EDITOR (Clean Layout) -->
                <div id="blog-editor-view" style="display:none; height:100%; width:100%;">
                    <div class="editor-layout">

                        <!-- 1. Header -->
                        <div class="editor-header">
                            <div style="display: flex; align-items: center; gap: 20px;">
                                <div onclick="showBlogHub()"
                                    style="cursor: pointer; color: #6b7280; font-size: 1.2rem;"><i
                                        class="fas fa-arrow-left"></i></div>
                                <div
                                    style="width: 40px; height: 40px; background: linear-gradient(135deg, #ff9a7b, #ff8c69); border-radius: 12px; display: flex; align-items: center; justify-content: center; overflow:hidden; box-shadow: 0 4px 12px rgba(255, 140, 105, 0.3);">
                                    <img src="../assets/images/favicon_symbol.png"
                                        style="width:70%; height:70%; object-fit:contain; filter: brightness(0) invert(1);">
                                </div>
                                <input type="text" class="editor-title-input" id="blogTitleInput"
                                    placeholder="Post Title">
                            </div>
                            <div style="display: flex; align-items: center; gap: 10px;">
                                <span id="saveIndicator"
                                    style="font-size: 0.8rem; color: #9ca3af; margin-right: 10px;">Saved</span>
                                <button onclick="saveCurrentDraft()"
                                    style="background:transparent; color:#64748b; border:1px solid #cbd5e1; padding:8px 20px; border-radius:50px; font-weight:600; cursor:pointer; font-size:0.85rem; transition:0.2s;"
                                    onmouseover="this.style.borderColor='#94a3b8'; this.style.color='#475569'"
                                    onmouseout="this.style.borderColor='#cbd5e1'; this.style.color='#64748b'">Save as
                                    Draft</button>
                                <button onclick="publishDraft()"
                                    style="background: linear-gradient(135deg, var(--teal-glow), #2dd4bf); color: #0f172a; padding: 8px 24px; border-radius: 50px; border: none; font-weight: 700; cursor: pointer; font-size: 0.85rem; display: flex; align-items: center; gap: 8px;">
                                    <i class="fas fa-paper-plane"></i> Publish
                                </button>
                                <div
                                    style="width: 35px; height: 35px; background: #e5e7eb; border-radius: 50%; margin-left: 15px; display: flex; align-items: center; justify-content: center; color: #6b7280;">
                                    <img src="../assets/images/google-icon.png"
                                        style="width:100%; opacity:0; /* Placeholder for user avatar */"> A
                                </div>
                            </div>
                        </div>

                        <!-- 2. Toolbar -->
                        <div class="editor-toolbar-area" id="toolbar-container">
                            <!-- Quill Toolbar -->
                            <span class="ql-formats">
                                <select class="ql-header">
                                    <option value="1">Heading</option>
                                    <option value="2">Subheading</option>
                                    <option selected>Normal</option>
                                </select>
                            </span>
                            <span class="ql-formats">
                                <button class="ql-bold"></button>
                                <button class="ql-italic"></button>
                                <button class="ql-underline"></button>
                                <button class="ql-strike"></button>
                            </span>
                            <span class="ql-formats">
                                <button class="ql-blockquote"></button>
                                <button class="ql-code-block"></button>
                            </span>
                            <span class="ql-formats">
                                <button class="ql-list" value="ordered"></button>
                                <button class="ql-list" value="bullet"></button>
                            </span>
                            <span class="ql-formats">
                                <button class="ql-link"></button>
                                <button class="ql-image"></button>
                            </span>
                            <span class="ql-formats">
                                <button class="ql-clean"></button>
                            </span>
                        </div>
                    </div>
                </div>

                <!-- GUIDELINES TAB -->
                <div id="tab-guidelines" class="tab-content">
                    <div class="page-title">Session Guidelines</div>

                    <!-- PEER GUIDELINES -->
                    <div id="peerGuidelines" style="display:none;">
                        <div class="pro-card">
                            <h3 style="color:var(--teal-glow); margin-bottom:20px;">Soulamore Peer Support Standards
                            </h3>
                            <p style="opacity:0.8; margin-bottom:20px;">Peer support sessions are an integral part of
                                the
                                Soulamore community, providing a safe and supportive space. To ensure the effectiveness
                                and
                                integrity of these sessions, please adhere to the following:</p>

                            <div style="display:grid; grid-template-columns:1fr 1fr; gap:20px;">
                                <div style="background:rgba(255,255,255,0.03); padding:20px; border-radius:12px;">
                                    <h4 style="color:var(--starlight); margin-bottom:10px;"><i
                                            class="fas fa-user-shield"></i> Confidentiality</h4>
                                    <p style="font-size:0.9rem; opacity:0.7;">Respect the confidentiality of all
                                        participants. What is shared stays in the session, unless there is an immediate
                                        risk
                                        of harm. Create an environment of trust.</p>
                                </div>
                                <div style="background:rgba(255,255,255,0.03); padding:20px; border-radius:12px;">
                                    <h4 style="color:var(--starlight); margin-bottom:10px;"><i
                                            class="fas fa-ear-listen"></i> Active Listening</h4>
                                    <p style="font-size:0.9rem; opacity:0.7;">Give full attention without interruption.
                                        Validate feelings and refrain from unsolicited advice. Allow participants to
                                        express
                                        themselves fully.</p>
                                </div>
                                <div style="background:rgba(255,255,255,0.03); padding:20px; border-radius:12px;">
                                    <h4 style="color:var(--starlight); margin-bottom:10px;"><i
                                            class="fas fa-hand-holding-heart"></i> Empathy & Compassion</h4>
                                    <p style="font-size:0.9rem; opacity:0.7;">Acknowledge emotions without trying to
                                        "fix"
                                        them. Remember that validation goes a long way in fostering connection.</p>
                                </div>
                                <div style="background:rgba(255,255,255,0.03); padding:20px; border-radius:12px;">
                                    <h4 style="color:var(--starlight); margin-bottom:10px;"><i class="fas fa-ban"></i>
                                        Boundaries</h4>
                                    <p style="font-size:0.9rem; opacity:0.7;">Maintain appropriate boundaries. Avoid
                                        prying
                                        into details participants aren't ready to share. Respect their pace.</p>
                                </div>
                                <div style="background:rgba(255,255,255,0.03); padding:20px; border-radius:12px;">
                                    <h4 style="color:var(--starlight); margin-bottom:10px;"><i
                                            class="fas fa-compass"></i>
                                        Non-Directive Approach</h4>
                                    <p style="font-size:0.9rem; opacity:0.7;">Encourage self-reflection with open-ended
                                        questions. Avoid imposing your own solutions or agendas.</p>
                                </div>
                                <div style="background:rgba(255,255,255,0.03); padding:20px; border-radius:12px;">
                                    <h4 style="color:var(--starlight); margin-bottom:10px;"><i
                                            class="fas fa-exclamation-triangle"></i> Safety & Crisis</h4>
                                    <p style="font-size:0.9rem; opacity:0.7;">Prioritize safety. If there is risk of
                                        self-harm, follow the crisis protocol immediately (Contact emergency
                                        services/Escalate).</p>
                                </div>
                            </div>
                            <div
                                style="margin-top:30px; padding:20px; border:1px solid var(--teal-glow); border-radius:12px; text-align:center;">
                                You are representing Soulamore's commitment to empathy. Your dedication ensures everyone
                                feels heard and valued.
                            </div>
                        </div>
                    </div>

                    <!-- PSYCH GUIDELINES -->
                    <div id="psychGuidelines" style="display:none;">
                        <div class="pro-card" style="border-color:var(--clinical-blue);">
                            <h3 style="color:var(--clinical-blue); margin-bottom:20px;">Clinical Practice Standards</h3>
                            <p style="opacity:0.8; margin-bottom:20px;">As a licensed professional on Soulamore, you
                                uphold
                                the highest standards of clinical ethics while fostering human connection.</p>

                            <div style="display:grid; grid-template-columns:1fr 1fr; gap:20px;">
                                <div style="background:rgba(255,255,255,0.03); padding:20px; border-radius:12px;">
                                    <h4 style="color:var(--starlight); margin-bottom:10px;"><i
                                            class="fas fa-file-medical"></i> Clinical Confidentiality</h4>
                                    <p style="font-size:0.9rem; opacity:0.7;">Strict adherence to mental health
                                        acts/HIPAA.
                                        Maintain professional privilege unless there is a Duty to Warn/Protect.</p>
                                </div>
                                <div style="background:rgba(255,255,255,0.03); padding:20px; border-radius:12px;">
                                    <h4 style="color:var(--starlight); margin-bottom:10px;"><i
                                            class="fas fa-notes-medical"></i> Scope of Practice</h4>
                                    <p style="font-size:0.9rem; opacity:0.7;">Operate strictly within your licensure and
                                        specialization. Refer out cases that require expertise beyond your scope (e.g.,
                                        severe psychiatric episodes).</p>
                                </div>
                                <div style="background:rgba(255,255,255,0.03); padding:20px; border-radius:12px;">
                                    <h4 style="color:var(--starlight); margin-bottom:10px;"><i
                                            class="fas fa-user-md"></i>
                                        Therapeutic Boundaries</h4>
                                    <p style="font-size:0.9rem; opacity:0.7;">Maintain clear professional boundaries.
                                        Dual
                                        relationships are prohibited. Ensure the therapeutic frame is secure and
                                        consistent.
                                    </p>
                                </div>
                                <div style="background:rgba(255,255,255,0.03); padding:20px; border-radius:12px;">
                                    <h4 style="color:var(--starlight); margin-bottom:10px;"><i class="fas fa-brain"></i>
                                        Evidence-Based Care</h4>
                                    <p style="font-size:0.9rem; opacity:0.7;">Utilize validated therapeutic modalities.
                                        While the Soulamore tone is warm, your interventions should be clinically
                                        grounded.
                                    </p>
                                </div>
                                <div style="background:rgba(255,255,255,0.03); padding:20px; border-radius:12px;">
                                    <h4 style="color:var(--starlight); margin-bottom:10px;"><i
                                            class="fas fa-ambulance"></i>
                                        Crisis Management</h4>
                                    <p style="font-size:0.9rem; opacity:0.7;">Immediate intervention required for active
                                        suicidality or homicidality. Follow local emergency protocols and document all
                                        risk
                                        assessments.</p>
                                </div>
                                <div style="background:rgba(255,255,255,0.03); padding:20px; border-radius:12px;">
                                    <h4 style="color:var(--starlight); margin-bottom:10px;"><i
                                            class="fas fa-users-cog"></i>
                                        Cultural Competence</h4>
                                    <p style="font-size:0.9rem; opacity:0.7;">Practice with deep respect for diversity.
                                        Continuously evaluate your own biases and strive for inclusive care.</p>
                                </div>
                            </div>
                        </div>
                    </div>

                </div>

                <!-- HOME TAB -->
                <div id="tab-home" class="tab-content active">
                    <div class="page-title">
                        <span>Performance Overview</span>
                        <button class="btn-primary" style="font-size:0.9rem;">Go Online</button>
                    </div>
                    <div class="form-grid" style="grid-template-columns: repeat(3, 1fr);">
                        <div class="pro-card" style="text-align:center;">
                            <div style="font-size:2rem; font-weight:700; color:var(--clinical-blue);">4.9</div>
                            <div style="font-size:0.9rem; opacity:0.7;">Client Rating</div>
                        </div>
                        <div class="pro-card" style="text-align:center;">
                            <div style="font-size:2rem; font-weight:700; color:var(--soft-teal);">12</div>
                            <div style="font-size:0.9rem; opacity:0.7;">Sessions this Week</div>
                        </div>
                        <div class="pro-card" style="text-align:center;">
                            <div style="font-size:2rem; font-weight:700; color:#fbbf24;">3</div>
                            <div style="font-size:0.9rem; opacity:0.7;">Draft Stories</div>
                        </div>
                    </div>
                </div>

                <!-- CALENDAR CONFIG TAB -->
                <div id="tab-calendar" class="tab-content">
                    <div class="page-title">Calendar Configuration</div>
                    <div class="pro-card">
                        <h3 style="margin-bottom:15px;">SuperSaaS Integration</h3>
                        <p style="opacity:0.7; margin-bottom:20px;">Connect your SuperSaaS schedule here. Use the "Link
                            to
                            this schedule" URL found in your SuperSaaS dashboard.</p>

                        <form onsubmit="saveCalendar(event)">
                            <div class="form-group">
                                <label class="form-label">SuperSaaS Schedule URL</label>
                                <input type="url" class="form-input" id="calUrl"
                                    placeholder="https://www.supersaas.com/schedule/your_account/your_schedule">
                            </div>
                            <button type="submit" class="btn-primary">Save Configuration</button>
                        </form>

                        <div id="calPreview" style="margin-top:30px; display:none;">
                            <label class="form-label">Preview:</label>
                            <iframe id="iframePreview" src="" width="100%" height="400" frameborder="0"
                                style="border-radius:12px; border:1px solid var(--border-glass);"></iframe>
                        </div>
                    </div>
                </div>

                <!-- PROFILE EDITOR TAB -->
                <div id="tab-profile" class="tab-content">
                    <div class="page-title">Edit Public Profile</div>

                    <form onsubmit="saveProfile(event)">
                        <div class="pro-card">
                            <h3 style="margin-bottom:20px;">Basic Details</h3>
                            <div class="form-grid">
                                <div class="form-group">
                                    <label class="form-label">Full Name</label>
                                    <input type="text" class="form-input" id="profName" value="Dr. Example">
                                </div>
                                <div class="form-group">
                                    <label class="form-label">Professional Title</label>
                                    <input type="text" class="form-input" id="profTitle" value="Clinical Psychologist">
                                </div>
                            </div>

                            <div class="form-grid">
                                <div class="form-group">
                                    <label class="form-label">Category</label>
                                    <select class="form-select" id="profCategory">
                                        <option>Mental Wellness</option>
                                        <option>Physical Wellness</option>
                                        <option>Financial Wellness</option>
                                        <option>Academic Wellness</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label class="form-label">Session Price (₹)</label>
                                    <input type="number" class="form-input" id="profPrice" value="1500">
                                </div>
                            </div>

                            <div class="form-group">
                                <div class="form-group">
                                    <label class="form-label">A short note from me</label>
                                    <div class="rich-toolbar">
                                        <button type="button" class="toolbar-btn" onclick="insertFormat('**', '**')"><i
                                                class="fas fa-bold"></i></button>
                                        <button type="button" class="toolbar-btn" onclick="insertFormat('*', '*')"><i
                                                class="fas fa-italic"></i></button>
                                        <button type="button" class="toolbar-btn" onclick="insertFormat('\n• ', '')"><i
                                                class="fas fa-list-ul"></i></button>
                                    </div>
                                    <textarea class="form-input" id="profBio" rows="6"
                                        style="border-top-left-radius:0; border-top-right-radius:0;"
                                        placeholder="Write like you’re welcoming someone into a quiet room..."></textarea>

                                    <!-- Sample Bio Guidance -->
                                    <div
                                        style="background:rgba(255,255,255,0.03); border:1px solid var(--border-glass); border-radius:8px; padding:15px; margin-top:10px;">
                                        <div
                                            style="font-size:0.8rem; text-transform:uppercase; letter-spacing:1px; color:var(--text-dim); margin-bottom:8px;">
                                            Example (Tone Guide)</div>
                                        <p style="font-size:0.9rem; opacity:0.7; font-style:italic; line-height:1.6;">
                                            "I don’t believe people need fixing. Sometimes it helps to speak things out
                                            loud
                                            without being interrupted or analyzed. You don’t have to know where to start
                                            here. We can begin wherever you are."
                                        </p>
                                    </div>
                                </div>

                                <!-- PEER FIELDS -->
                                <div id="peerFields"
                                    style="margin: 20px 0; border-top: 1px solid var(--border-glass); padding-top: 20px; display:none;">
                                    <h4 style="margin-bottom:15px; color:var(--teal-glow);">My Topics</h4>

                                    <div class="form-group">
                                        <label class="form-label">Topics I’m comfortable supporting conversations
                                            around</label>
                                        <div class="tag-cloud" id="peerTagCloud"></div>
                                        <input type="hidden" id="profStyle"> <!-- Stores selected tags -->
                                    </div>

                                    <div class="form-group">
                                        <label class="form-label">This space may feel right if...</label>
                                        <textarea class="form-input" id="profMatch" rows="4"
                                            placeholder="• You're overthinking small things.&#10;• You feel emotionally tired without a clear reason.&#10;• You don't want advice, just someone to listen."></textarea>
                                        <small style="opacity:0.6;">Write in first or second person. No
                                            diagnoses.</small>
                                    </div>
                                </div>

                                <!-- PSYCH FIELDS -->
                                <div id="psychFields"
                                    style="margin: 20px 0; border-top: 1px solid var(--border-glass); padding-top: 20px; display:none;">
                                    <h4 style="margin-bottom:15px; color:#3b82f6;">Clinical Profile</h4>

                                    <div class="form-group">
                                        <label class="form-label">Professional Experience / Degrees</label>
                                        <textarea class="form-input" id="profEdu" rows="3"
                                            placeholder="• Master's in Clinical Psychology&#10;• PG Diploma in Counseling&#10;• PhD in Psychology"></textarea>
                                    </div>

                                    <div class="form-group">
                                        <label class="form-label">Topics I specialize in supporting</label>
                                        <div class="tag-cloud" id="psychTagCloud"></div>
                                        <input type="hidden" id="profTags"> <!-- Stores selected tags -->
                                    </div>

                                    <div class="form-group">
                                        <label class="form-label">Session Format</label>
                                        <select class="form-input" id="profFormat">
                                            <option>Online (G-Meet / Zoom)</option>
                                            <option>In-Person (Clinic)</option>
                                            <option>Hybrid</option>
                                        </select>
                                    </div>

                                    <!-- Match Text for Psych too? (User asked to replicate core shift) -->
                                    <div class="form-group">
                                        <label class="form-label">This space may feel right if...</label>
                                        <textarea class="form-input" id="profMatchPsych" rows="3"
                                            placeholder="• You are looking for clinical diagnosis and treatment plan.&#10;• You need a structured approach to trauma recovery."></textarea>
                                    </div>

                                    <div class="form-group">
                                        <label class="form-label">Crisis Policy</label>
                                        <textarea class="form-input" id="profCrisis" rows="3"
                                            placeholder="I am not available for 24/7 emergency support. If you are in immediate danger, please contact local emergency services."></textarea>
                                    </div>
                                </div>
                            </div>

                            <div class="pro-card">
                                <h3 style="margin-bottom:20px;">Additional Details</h3>
                                <div class="form-grid">
                                    <div class="form-group">
                                        <label class="form-label">Languages</label>
                                        <input type="text" class="form-input" id="profLang" value="English, Hindi">
                                    </div>
                                    <div class="form-group">
                                        <label class="form-label">Years of Experience</label>
                                        <input type="number" class="form-input" id="profExp" value="5">
                                    </div>
                                </div>
                            </div>
                            <p style="font-size:0.9rem; opacity:0.7; margin-bottom:20px;">Upload a photo. We will
                                automatically remove the background and apply the Soulamore accent ring.</p>

                            <div class="pic-upload-area" onclick="document.getElementById('fileInput').click()">
                                <!-- Hidden Input -->
                                <input type="file" id="fileInput" style="display:none;"
                                    onchange="handleImageUpload(this)">

                                <div id="uploadPlaceholder">
                                    <i class="fas fa-cloud-upload-alt" style="font-size:2rem; margin-bottom:10px;"></i>
                                    <div>Click to Upload Image</div>
                                </div>

                                <!-- Processing & Preview -->
                                <div id="procOverlay" class="processing-overlay">
                                    <div style="color:var(--clinical-blue); margin-bottom:10px;"><i
                                            class="fas fa-magic fa-spin"></i> Processing...</div>
                                </div>
                                <img id="previewImg" src="" class="preview-img">
                            </div>
                            <div style="text-align:center; margin-top:10px; font-size:0.8rem; opacity:0.6;">(Simulated
                                AI
                                Background Removal)</div>
                        </div>

                        <button type="submit" class="btn-primary" style="width:100%; margin-bottom:40px;">Save Profile
                            Changes</button>
                    </form>
                </div>
            </div>

            <!-- JOURNAL TAB (Placeholder) -->
            <div id="tab-journal" class="tab-content">
                <div class="pro-card" style="text-align:center; padding:60px;">
                    <i class="fas fa-lock" style="font-size:3rem; margin-bottom:20px; color:#475569;"></i>
                    <h3>Private Journal</h3>
                    <p style="opacity:0.6;">This feature is currently locked for beta testing.</p>
                </div>
            </div>

        </div>
    </div>

    <script>
        // --- TABS LOGIC ---
        function showTab(id) {
            document.querySelectorAll('.tab-content').forEach(el => el.classList.remove('active'));
            document.getElementById('tab-' + id).classList.add('active');

            document.querySelectorAll('.nav-item').forEach(el => el.classList.remove('active'));
            // Simple nav highlight logic
            event.currentTarget.classList.add('active');
        }

        // --- SMART PROFILE PIC SIMULATION ---
        function handleImageUpload(input) {
            if (input.files && input.files[0]) {
                const reader = new FileReader();

                // Show Processing
                const overlay = document.getElementById('procOverlay');

                reader.onload = function (e) {
                    // Simulate API Delay
                    setTimeout(() => {
                        overlay.style.display = 'none';
                        const img = document.getElementById('previewImg');
                        img.src = e.target.result;
                        img.style.display = 'block';
                        document.getElementById('uploadPlaceholder').style.display = 'none';

                        /* In a real scenario, this is where we'd send data to remove.bg */
                        /* Here, we apply CSS border to 'simulate' the result */
                        alert("Image processed! Background removal simulation complete.");
                    }, 2000);
                }
                reader.readAsDataURL(input.files[0]);
            }
        }

        // --- TAG DATA ---
        const PEER_TAGS = [
            "Anxiety", "Loneliness", "Relationship Issues", "Work Stress",
            "Academic Pressure", "Breakup", "Family Drama", "Self-Esteem",
            "Motivation", "Sleep Issues", "General Venting", "Body Image"
        ];

        const PSYCH_TAGS = [
            "Clinical Depression", "Anxiety Disorders", "Trauma / PTSD", "OCD",
            "Bipolar Disorder", "Eating Disorders", "Substance Abuse", "ADHD",
            "Marital Therapy", "Child Psychology", "Grief Counseling", "Personality Disorders"
        ];

        // --- INIT ---
        document.addEventListener('DOMContentLoaded', () => {
            // ... Load other profile stuff ...
            const role = localStorage.getItem('user_role') || "Peer";

            // Toggle Fields based on Role
            if (role === 'Psychologist') {
                document.getElementById('psychFields').style.display = 'block';
                document.getElementById('psychGuidelines').style.display = 'block'; // Show Psych Guidelines
                renderTags('psychTagCloud', PSYCH_TAGS, 'profTags');
            } else {
                document.getElementById('peerFields').style.display = 'block';
                document.getElementById('peerGuidelines').style.display = 'block'; // Show Peer Guidelines
                renderTags('peerTagCloud', PEER_TAGS, 'profStyle');
            }

            initBlogSystem();

            // INIT QUILL EDITOR
            var quill = new Quill('#editor', {
                modules: {
                    toolbar: '#toolbar-container'
                },
                theme: 'snow'
            });

            // AI MAGIC BUTTON
            document.querySelector('.fa-magic').parentNode.onclick = () => {
                alert("AI Magic: Polishing your text for empathy and clarity... (Simulation)");
                // In real app, this sends content to LLM
            };
        });

        let currentDraftId = null;
        let autosaveTimer = null;

        // --- BLOG SYSTEM LOGIC ---
        function initBlogSystem() {
            loadDraftList();

            // Autosave Listener
            quill.on('text-change', function () {
                clearTimeout(autosaveTimer);
                autosaveTimer = setTimeout(saveCurrentDraft, 2000); // Save after 2s of no typing
            });

            // Title Listener
            document.getElementById('blogTitleInput').addEventListener('input', () => {
                clearTimeout(autosaveTimer);
                autosaveTimer = setTimeout(saveCurrentDraft, 2000);
            });
        }

        function createNewDraft() {
            const draft = {
                id: Date.now().toString(),
                title: "",
                content: "",
                category: "",
                lastEdited: Date.now(),
                status: "Draft",
                bg: "#0f172a",
                bgImage: ""
            };
            saveDraftToStorage(draft);
            loadDraft(draft.id);
            loadDraftList();
        }

        function loadDraft(id) {
            const drafts = JSON.parse(localStorage.getItem('peer_blog_drafts') || "[]");
            const draft = drafts.find(d => d.id === id);
            if (!draft) return;

            currentDraftId = id;
            document.getElementById('blogTitleInput').value = draft.title;
            document.getElementById('blogCategoryInput').value = draft.category || "Select Category";
            quill.root.innerHTML = draft.content || "";

            // Restore Styles
            if (draft.bg) {
                setColor(draft.bg);
                document.getElementById('bgColorPicker').value = draft.bg;
            }
            if (draft.bgImage) {
                document.getElementById('editor').style.backgroundImage = `url(${draft.bgImage})`;
            } else {
                document.getElementById('editor').style.backgroundImage = 'none';
            }

            // Update UI
            document.querySelectorAll('.blog-list-item').forEach(el => el.classList.remove('active'));
            const listItem = document.getElementById(`draft-${id}`);
            if (listItem) listItem.classList.add('active');
        }

        function saveCurrentDraft() {
            if (!currentDraftId) return;

            const drafts = JSON.parse(localStorage.getItem('peer_blog_drafts') || "[]");
            const index = drafts.findIndex(d => d.id === currentDraftId);

            if (index !== -1) {
                drafts[index].title = document.getElementById('blogTitleInput').value || "Untitled Draft";
                drafts[index].content = quill.root.innerHTML;
                drafts[index].category = document.getElementById('blogCategoryInput').value;
                drafts[index].lastEdited = Date.now();
                // Note: We don't save bgImage base64 fully here for simplicity, typically you'd upload it. 
                // For local demo, we keep it simple or ignore huge strings.
                drafts[index].bg = document.getElementById('bgColorPicker').value;

                localStorage.setItem('peer_blog_drafts', JSON.stringify(drafts));

                // Update Sidebar Text
                loadDraftList();

                // Show tiny autosave indicator
                const indicator = document.getElementById('saveIndicator');
                if (indicator) {
                    indicator.innerText = "Saved";
                    setTimeout(() => indicator.innerText = "", 2000);
                }
            }
        }

        function saveDraftToStorage(draft) {
            const drafts = JSON.parse(localStorage.getItem('peer_blog_drafts') || "[]");
            drafts.unshift(draft);
            localStorage.setItem('peer_blog_drafts', JSON.stringify(drafts));
        }

        function loadDraftList() {
            const drafts = JSON.parse(localStorage.getItem('peer_blog_drafts') || "[]");
            const container = document.getElementById('draftListContainer');
            if (!container) return;

            if (drafts.length === 0) {
                container.innerHTML = '<div style="font-size:0.8rem; opacity:0.5; font-style:italic;">No drafts yet.</div>';
                return;
            }

            container.innerHTML = '';
            if (drafts.length === 0) {
                container.innerHTML = '<div style="font-size:0.8rem; opacity:0.5; font-style:italic;">No drafts yet.</div>';
                return;
            }

            drafts.forEach(d => {
                const safeId = String(d.id || '').replace(/[^a-zA-Z0-9\-\._]/g, '');

                const item = document.createElement('div');
                item.id = 'draft-' + safeId;
                item.className = 'blog-list-item' + (currentDraftId === d.id ? ' active' : '');
                item.onclick = function () { loadDraft(d.id); };

                const titleDiv = document.createElement('div');
                titleDiv.style.fontWeight = '600';
                titleDiv.style.color = 'white';
                titleDiv.style.whiteSpace = 'nowrap';
                titleDiv.style.overflow = 'hidden';
                titleDiv.style.textOverflow = 'ellipsis';
                titleDiv.textContent = d.title || "Untitled Draft";

                const dateDiv = document.createElement('div');
                dateDiv.style.fontSize = '0.75rem';
                dateDiv.style.opacity = '0.6';
                if (d.lastEdited) {
                    dateDiv.textContent = new Date(d.lastEdited).toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });
                }

                item.appendChild(titleDiv);
                item.appendChild(dateDiv);
                container.appendChild(item);
            });
        }

        function publishDraft() {
            alert("Publishing to 'Our Stories'... (Logic hooked up to Global Feed)");
            // Would move from 'drafts' to 'published' array
        }

        // --- EDITOR FEATURES ---

        function setTheme(mode) {
            const canvas = document.getElementById('mainCanvas');
            if (mode === 'dark') {
                canvas.classList.add('dark-mode-canvas');
                canvas.style.backgroundColor = '#1e1e1e';
            } else {
                canvas.classList.remove('dark-mode-canvas');
                canvas.style.backgroundColor = '#ffffff';
            }
        }

        function setFont(fontClass) {
            const editor = document.getElementById('editor');
            editor.className = ''; // Reset
            editor.classList.add(fontClass);
        }

        function toggleStickers() {
            const popup = document.getElementById('stickerPopup');
            popup.style.display = popup.style.display === 'grid' ? 'none' : 'grid';
        }

        function insertSticker(emoji) {
            const range = quill.getSelection(true);
            quill.insertText(range.index, emoji + ' ', 'user');
            quill.setSelection(range.index + 2);
            toggleStickers();
        }

        // --- VIEW MANAGEMENT ---
        function showBlogHub() {
            document.getElementById('blog-hub-view').style.display = 'block';
            document.getElementById('blog-editor-view').style.display = 'none';
        }

        function createNewDraft() {
            document.getElementById('blog-hub-view').style.display = 'none';
            document.getElementById('blog-editor-view').style.display = 'block';
            // Reset editor
            quill.setText('');
            document.getElementById('blogTitleInput').value = '';
            // New logic: ensure no modal is stuck open
            document.getElementById('elementsModal').style.display = 'none';
            document.getElementById('coverImagePreview').style.display = 'none';
            currentDraftId = Date.now().toString(); // New ID
        }

        function toggleSettingsPanel() {
            const panel = document.getElementById('settingsPanel');
            if (panel.style.transform === 'translateX(0%)') {
                panel.style.transform = 'translateX(100%)';
            } else {
                panel.style.transform = 'translateX(0%)';
            }
        }

        // Accordion Logic for Right Sidebar
        function toggleSetting(header) {
            const content = header.nextElementSibling;
            const icon = header.querySelector('.fa-chevron-down');

            // Toggle current
            if (content.style.display === 'block') {
                content.style.display = 'none';
                icon.style.transform = 'rotate(0deg)';
                header.style.color = '#4b5563';
            } else {
                content.style.display = 'block';
                icon.style.transform = 'rotate(180deg)';
                header.style.color = '#f97316'; // Accent color
            }
        }

        function toggleElementsModal() {
            const modal = document.getElementById('elementsModal');
            modal.style.display = modal.style.display === 'block' ? 'none' : 'block';
        }

        // --- TEMPLATES ---
        const BLOG_TEMPLATES = {
            'listicle': `<h2>5 Ways to [Topic]</h2><p>Introduction: Why this matters...</p><ul><li><strong>1. Point One:</strong> Details here...</li><li><strong>2. Point Two:</strong> Details here...</li><li><strong>3. Point Three:</strong> Details here...</li></ul><p>Conclusion: Wrap it up!</p>`,
            'guide': `<h2>The Ultimate Guide to [Topic]</h2><p><strong>What you will learn:</strong></p><ul><li>Skill 1</li><li>Skill 2</li></ul><h3>Step 1: Getting Started</h3><p>First, you need to...</p><h3>Step 2: The Process</h3><p>Next...</p>`
        };

        function applyTemplate(type) {
            if (confirm("Replace current content with template?")) {
                quill.clipboard.dangerouslyPasteHTML(BLOG_TEMPLATES[type]);
            }
        }

        function toggleTag(el, inputId) {
            el.classList.toggle('selected');
            updateHiddenInput(inputId, el.parentNode);
        }

        function renderTags(containerId, tags, hiddenInputId) {
            const container = document.getElementById(containerId);
            container.innerHTML = '';
            tags.forEach(tag => {
                const pill = document.createElement('div');
                pill.className = 'tag-pill';
                pill.innerText = tag;
                pill.onclick = () => toggleTag(pill, hiddenInputId);
                container.appendChild(pill);
            });
        }

        function updateHiddenInput(inputId, container) {
            const selected = Array.from(container.getElementsByClassName('selected')).map(el => el.innerText);
            document.getElementById(inputId).value = selected.join(', ');
        }

        // --- RICH TEXT HELPER ---
        function insertFormat(start, end) {
            const textarea = document.getElementById('profBio');
            const s = textarea.selectionStart;
            const e = textarea.selectionEnd;
            const val = textarea.value;

            const before = val.substring(0, s);
            const selected = val.substring(s, e);
            const after = val.substring(e);

            textarea.value = before + start + selected + end + after;
            textarea.focus();
            textarea.selectionStart = s + start.length;
            textarea.selectionEnd = e + end.length;
        }

        // --- SAVE PROFILE (Simulate) ---
        function saveProfile(e) {
            e.preventDefault();

            // Note: profStyle and profTags hidden inputs are auto-updated by toggleTag

            const profile = {
                name: document.getElementById('profName').value,
                title: document.getElementById('profTitle').value,
                category: document.getElementById('profCategory').value,
                price: document.getElementById('profPrice').value,
                bio: document.getElementById('profBio').value,

                // PEER FIELDS
                style: document.getElementById('profStyle').value.split(',').filter(t => t), // Topics (Tags)
                matchIndex: document.getElementById('profMatch').value,

                // PSYCH FIELDS
                edu: document.getElementById('profEdu').value,
                format: document.getElementById('profFormat').value,
                crisis: document.getElementById('profCrisis').value,
                // Use psych match text if role is psychologist, else undefined (or shared field)
                matchIndexPsych: document.getElementById('profMatchPsych').value,

                tags: document.getElementById('profTags').value.split(',').filter(t => t), // Psych Tags
                languages: document.getElementById('profLang').value,
                exp: document.getElementById('profExp').value,
                image: document.getElementById('previewImg').src || 'https://randomuser.me/api/portraits/men/32.jpg',
                isVerified: true
            };

            localStorage.setItem('professional_profile', JSON.stringify(profile));
            alert("Profile Updated! Your public profile page has been refreshed.");
        }

        // --- SAVE CALENDAR (Simulate) ---
        function saveCalendar(e) {
            e.preventDefault();
            const url = document.getElementById('calUrl').value;
            if (url) {
                // Save to profile
                let profile = JSON.parse(localStorage.getItem('professional_profile') || "{}");
                profile.calendarUrl = url;
                localStorage.setItem('professional_profile', JSON.stringify(profile));

                // Show Preview
                document.getElementById('calPreview').style.display = 'block';
                document.getElementById('iframePreview').src = url;

                alert("Calendar Configuration Saved!");
            }
        }

        // --- PUBLISH BLOG (Simulate) ---
        function publishBlog(e) {
            e.preventDefault();

            const blog = {
                id: Date.now(),
                title: document.getElementById('blogTitle').value,
                topic: document.getElementById('blogTopic').value,
                image: document.getElementById('blogImg').value,
                body: `<p>${document.getElementById('blogBody').value}</p>`, // Simple wrap
                author: document.getElementById('profName').value,
                type: localStorage.getItem('user_role') || "Peer",
                date: new Date().toLocaleDateString('en-US', { month: 'short', day: 'numeric' }),
                readTime: "3 min",
                excerpt: document.getElementById('blogBody').value.substring(0, 100) + "..."
            };

            // Get existing or init empty array
            let blogs = JSON.parse(localStorage.getItem('community_blogs') || "[]");
            blogs.push(blog);
            localStorage.setItem('community_blogs', JSON.stringify(blogs));

            alert("Story Published! Check 'Stories' page.");
            document.getElementById('blogBody').value = ''; // Reset
        }
    </script>
</body>

</html>
```