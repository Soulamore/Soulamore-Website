:root {
    /* --- FONTS --- */
    --font-heading: 'Outfit', sans-serif;
    --font-body: 'Plus Jakarta Sans', sans-serif;

    /* --- BASE TOKENS (Default: Dark + Calm) --- */
    --bg-primary: #1e293b;
    /* APP BACKGROUND (Level 1) */
    --bg-surface: rgba(255, 255, 255, 0.03);
    /* CARDS (Level 3) */
    --bg-elevated: rgba(255, 255, 255, 0.06);
    /* HOVER/MODALS */

    --text-primary: #f1f5f9;
    /* Warm Off-White */
    --text-secondary: #94a3b8;
    /* Soft Grey-Blue */
    --text-muted: rgba(148, 163, 184, 0.5);

    --accent-primary: #4ECDC4;
    /* TEAL (Safety/Pro) */
    --accent-secondary: #F49F75;
    /* PEACH (Human/Warmth) */
    --accent-error: #ef4444;
    /* Logout/Error */

    --border-soft: rgba(255, 255, 255, 0.05);
    --shadow-soft: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
}

/* =========================================
   THEME ENGINE: EMOTIONAL THEMES
   ========================================= */

/* üåä THEME 1: CALM (Default) - Safety & Slowing Down */
[data-theme='calm'][data-mode='dark'] {
    --bg-primary: linear-gradient(180deg, #334155 0%, #0f172a 100%);
    --bg-surface: rgba(255, 255, 255, 0.03);
    --accent-primary: #4ECDC4;
    /* Teal */
    --text-primary: #f1f5f9;
}

[data-theme='calm'][data-mode='light'] {
    --bg-primary: #f1f5f9;
    /* Slightly darker main background for better card separation */
    --bg-surface: #ffffff;
    --text-primary: #0f172a;
    /* Slate 900 (High Contrast) */
    --text-secondary: #475569;
    /* Slate 600 ( readable) */
    --text-muted: #94a3b8;
    --accent-primary: #0d9488;
    /* Darker Teal for white bg */
    --border-soft: rgba(0, 0, 0, 0.12);
    /* More visible borders */
    --bg-elevated: #ffffff;
    --shadow-soft: 0 4px 15px rgba(0, 0, 0, 0.08);
}

/* üå´ THEME 2: NEUTRAL - Low Stimulation */
[data-theme='neutral'][data-mode='dark'] {
    --bg-primary: #171717;
    /* Darker for better contrast */
    --bg-surface: rgba(255, 255, 255, 0.05);
    --accent-primary: #d4d4d4;
    /* Lighter Grey for better button visibility */
    --accent-secondary: #e5e5e5;
    --text-primary: #ededed;
    --text-secondary: #a3a3a3;
    /* Neutral Grey */
    --border-soft: rgba(255, 255, 255, 0.1);
}

[data-theme='neutral'][data-mode='light'] {
    --bg-primary: #ffffff;
    --bg-surface: #f3f4f6;
    /* Gray 100 */
    --text-primary: #0a0a0a;
    /* Almost Black */
    --text-secondary: #525252;
    /* Neutral 600 */
    --accent-primary: #525252;
    --border-soft: rgba(0, 0, 0, 0.15);
}

/* üå± THEME 3: GROUNDED - Stability */
[data-theme='grounded'][data-mode='dark'] {
    --bg-primary: linear-gradient(180deg, #142a1d 0%, #051a0f 100%);
    /* Slightly deeper forest */
    --bg-surface: rgba(167, 243, 208, 0.05);
    /* Tinted surface */
    --accent-primary: #34d399;
    /* Brighter Green for buttons */
    --text-primary: #ecfdf5;
    --text-secondary: #6ee7b7;
    /* Green-tinted grey */
    --border-soft: rgba(52, 211, 153, 0.15);
}

[data-theme='grounded'][data-mode='light'] {
    --bg-primary: #f0fdf4;
    /* Soft Sage */
    --bg-surface: #ffffff;
    --text-primary: #052e16;
    /* Green 950 */
    --text-secondary: #166534;
    /* Green 700 */
    --accent-primary: #059669;
    --border-soft: rgba(22, 101, 52, 0.15);
    --shadow-soft: 0 4px 15px rgba(22, 101, 52, 0.08);
}

/* ‚òÄÔ∏è THEME 4: WARM - Encouragement */
[data-theme='warm'][data-mode='dark'] {
    --bg-primary: linear-gradient(180deg, #2a2322 0%, #1c1917 100%);
    /* Deep Warm */
    --bg-surface: rgba(255, 255, 255, 0.04);
    --accent-primary: #fbbf24;
    /* Amber */
    --text-primary: #fff7ed;
}

[data-theme='warm'][data-mode='light'] {
    --bg-primary: #fff7ed;
    /* Warm Beige */
    --bg-surface: #ffffff;
    --text-primary: #431407;
    /* Stone 950 */
    --text-secondary: #92400e;
    /* Amber 800 */
    --accent-primary: #d97706;
    /* Darker Amber */
    --border-soft: rgba(67, 20, 7, 0.12);
    --shadow-soft: 0 4px 15px rgba(67, 20, 7, 0.08);
}

/* üéØ THEME 5: FOCUS - Clarity */
[data-theme='focus'][data-mode='dark'] {
    --bg-primary: #020617;
    /* Deepest Blue */
    --bg-surface: rgba(255, 255, 255, 0.08);
    /* Higher Contrast */
    --accent-primary: #3b82f6;
    /* Structured Blue */
    --text-primary: #ffffff;
    /* High Contrast White */
}

[data-theme='focus'][data-mode='light'] {
    --bg-primary: #ffffff;
    --bg-surface: #f0f9ff;
    /* Sky 50 */
    --text-primary: #020617;
    /* Slate 950 */
    --text-secondary: #0f172a;
    /* Slate 900 */
    --accent-primary: #1d4ed8;
    /* Blue 700 */
    --border-soft: rgba(0, 0, 0, 0.2);
    font-weight: 500;
}

/* =========================================
   GLOBAL RESETS & UTILITIES
   ========================================= */
* {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
    font-family: var(--font-body);
}

html,
body {
    background-color: #0f172a;
    /* Default Deep Space */
    background: var(--bg-primary, #0f172a);
    /* Fallback to var if loaded */
    color: var(--text-primary, #f1f5f9);
    transition: background 0.3s ease, color 0.3s ease;
    min-height: 100vh;
    margin: 0;
    overflow-x: hidden;
    /* Prevent white sidebar reveal */
}

/* Explicit Light Mode Override (Used by Problem Wall) */
body.light-mode {
    background-color: #ffffff !important;
    background: #ffffff !important;
    color: #0f172a !important;
}

h1,
h2,
h3,
h4,
h5 {
    font-family: var(--font-heading);
    color: var(--text-primary);
}

p,
span,
li {
    color: var(--text-secondary);
    line-height: 1.6;
}

a {
    text-decoration: none;
    color: inherit;
    cursor: pointer;
}

/* UTILITIES */
.container {
    max-width: 1200px;
    margin: 0 auto;
    padding: 0 20px;
    width: 100%;
}

.dashboard-layout {
    background: var(--bg-primary) !important;
    /* Ensure layout follows theme */
}

/* Buttons (Generic) */
button {
    font-family: var(--font-body);
}

/* Scrollbar */
::-webkit-scrollbar {
    width: 6px;
}

::-webkit-scrollbar-track {
    background: transparent;
}

::-webkit-scrollbar-thumb {
    background: rgba(255, 255, 255, 0.1);
    border-radius: 10px;
}

[data-mode='light'] ::-webkit-scrollbar-thumb {
    background: rgba(0, 0, 0, 0.1);
}

/* FADE IN ANIMATION */
.fade-in {
    animation: fadeIn 0.5s ease-out forwards;
    opacity: 0;
    transform: translateY(10px);
}

@keyframes fadeIn {
    to {
        opacity: 1;
        transform: translateY(0);
    }
}

/* Theme Tags (Settings Page) */
.theme-btn,
.theme-tag {
    padding: 10px 20px;
    border-radius: 20px;
    border: 1px solid var(--border-soft);
    background: var(--bg-surface);
    color: var(--text-primary);
    cursor: pointer;
    transition: 0.2s;
    font-size: 0.9rem;
}

.theme-btn.active,
.theme-tag.active {
    background: var(--accent-primary);
    color: #0f172a;
    /* Always dark text on active accent */
    border-color: var(--accent-primary);
    font-weight: 600;
}

[data-theme='focus'] .theme-btn.active {
    color: white;
}

/* --- CHAT BUBBLES (High Contrast) --- */
.chat-bubble {
    padding: 12px 18px;
    border-radius: 18px;
    font-size: 0.95rem;
    line-height: 1.5;
    max-width: 80%;
    margin-bottom: 10px;
    position: relative;
    word-wrap: break-word;
}

.chat-bubble.bot,
.chat-bubble.received {
    align-self: flex-start;
    background: var(--bg-surface);
    color: var(--text-primary);
    border: 1px solid var(--border-soft);
    border-bottom-left-radius: 4px;
}

.chat-bubble.user,
.chat-bubble.sent {
    align-self: flex-end;
    background: var(--accent-primary);
    /* Pop Color */
    color: #0f172a;
    /* Dark text for contrast against bright bubble */
    font-weight: 500;
    border-bottom-right-radius: 4px;
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
}

/* Specific text color overrides if needed depending on theme brightness */
[data-theme='neutral'] .chat-bubble.user {
    color: #171717;
    background: #e5e5e5;
}

[data-theme='focus'] .chat-bubble.user {
    color: #ffffff;
    background: var(--accent-primary);
}

/* Exception for dark blue accent */